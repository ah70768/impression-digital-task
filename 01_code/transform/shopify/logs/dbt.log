[0m00:39:02.784223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B1AD593B90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B1AB778A70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B1AE15FFE0>]}


============================== 00:39:02.790233 | 3d69a594-6571-4100-aa3b-54c9220894ef ==============================
[0m00:39:02.790233 [info ] [MainThread]: Running with dbt=1.9.1
[0m00:39:02.793395 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m00:39:02.838276 [info ] [MainThread]: dbt version: 1.9.1
[0m00:39:02.839268 [info ] [MainThread]: python version: 3.12.4
[0m00:39:02.840461 [info ] [MainThread]: python path: C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\venv\Scripts\python.exe
[0m00:39:02.841467 [info ] [MainThread]: os info: Windows-10-10.0.19045-SP0
[0m00:39:05.686972 [info ] [MainThread]: Using profiles dir at C:\Users\amarh\.dbt
[0m00:39:05.689426 [info ] [MainThread]: Using profiles.yml file at C:\Users\amarh\.dbt\profiles.yml
[0m00:39:05.691068 [info ] [MainThread]: Using dbt_project.yml file at C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\dbt_project.yml
[0m00:39:05.696259 [info ] [MainThread]: adapter type: bigquery
[0m00:39:05.699182 [info ] [MainThread]: adapter version: 1.9.0
[0m00:39:05.901298 [info ] [MainThread]: Configuration:
[0m00:39:05.908013 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m00:39:05.909419 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m00:39:05.912421 [info ] [MainThread]: Required dependencies:
[0m00:39:05.915284 [debug] [MainThread]: Executing "git --help"
[0m00:39:05.998259 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone      Clone a repository into a new directory\n   init       Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add        Add file contents to the index\n   mv         Move or rename a file, a directory, or a symlink\n   restore    Restore working tree files\n   rm         Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect     Use binary search to find the commit that introduced a bug\n   diff       Show changes between commits, commit and working tree, etc\n   grep       Print lines matching a pattern\n   log        Show commit logs\n   show       Show various types of objects\n   status     Show the working tree status\n\ngrow, mark and tweak your common history\n   backfill   Download missing objects in a partial clone\n   branch     List, create, or delete branches\n   commit     Record changes to the repository\n   merge      Join two or more development histories together\n   rebase     Reapply commits on top of another base tip\n   reset      Reset current HEAD to the specified state\n   switch     Switch branches\n   tag        Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch      Download objects and refs from another repository\n   pull       Fetch from and integrate with another repository or a local branch\n   push       Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m00:39:05.999262 [debug] [MainThread]: STDERR: "b''"
[0m00:39:06.000440 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m00:39:06.003890 [info ] [MainThread]: Connection:
[0m00:39:06.006212 [info ] [MainThread]:   method: service-account
[0m00:39:06.008870 [info ] [MainThread]:   database: impression-digital
[0m00:39:06.012050 [info ] [MainThread]:   execution_project: impression-digital
[0m00:39:06.015063 [info ] [MainThread]:   schema: raw
[0m00:39:06.019199 [info ] [MainThread]:   location: EU
[0m00:39:06.023282 [info ] [MainThread]:   priority: interactive
[0m00:39:06.026601 [info ] [MainThread]:   maximum_bytes_billed: None
[0m00:39:06.032451 [info ] [MainThread]:   impersonate_service_account: None
[0m00:39:06.036423 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m00:39:06.039611 [info ] [MainThread]:   job_retries: 1
[0m00:39:06.041738 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m00:39:06.043736 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m00:39:06.048389 [info ] [MainThread]:   timeout_seconds: 300
[0m00:39:06.051062 [info ] [MainThread]:   client_id: None
[0m00:39:06.053134 [info ] [MainThread]:   token_uri: None
[0m00:39:06.055604 [info ] [MainThread]:   dataproc_region: None
[0m00:39:06.057605 [info ] [MainThread]:   dataproc_cluster_name: None
[0m00:39:06.066673 [info ] [MainThread]:   gcs_bucket: None
[0m00:39:06.070001 [info ] [MainThread]:   dataproc_batch: None
[0m00:39:06.072150 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m00:39:06.943768 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m00:39:06.946703 [debug] [MainThread]: On debug: select 1 as id
[0m00:39:06.949899 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:39:07.529597 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:cb890bac-aaaf-497c-ab20-cd611400526d&page=queryresults
[0m00:39:08.263490 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m00:39:08.268163 [info ] [MainThread]: [32mAll checks passed![0m
[0m00:39:08.280936 [debug] [MainThread]: Command `dbt debug` succeeded at 00:39:08.279931 after 5.89 seconds
[0m00:39:08.285517 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m00:39:08.289361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B1AE08C800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B1B87DEBA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B1B8894A40>]}
[0m00:39:08.299839 [debug] [MainThread]: Flushing usage events
[0m00:39:08.712254 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:51:21.231963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016E7581AEA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016E75C81D30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016E758E2960>]}


============================== 00:51:21.243004 | 2a8e898f-546c-4712-a6de-0e8e1844d056 ==============================
[0m00:51:21.243004 [info ] [MainThread]: Running with dbt=1.9.1
[0m00:51:21.245799 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:51:21.307510 [info ] [MainThread]: dbt version: 1.9.1
[0m00:51:21.310239 [info ] [MainThread]: python version: 3.12.4
[0m00:51:21.313240 [info ] [MainThread]: python path: C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\venv\Scripts\python.exe
[0m00:51:21.316241 [info ] [MainThread]: os info: Windows-10-10.0.19045-SP0
[0m00:51:24.955531 [info ] [MainThread]: Using profiles dir at C:\Users\amarh\.dbt
[0m00:51:24.960133 [info ] [MainThread]: Using profiles.yml file at C:\Users\amarh\.dbt\profiles.yml
[0m00:51:24.961512 [info ] [MainThread]: Using dbt_project.yml file at C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\dbt_project.yml
[0m00:51:24.962944 [info ] [MainThread]: adapter type: bigquery
[0m00:51:24.965060 [info ] [MainThread]: adapter version: 1.9.0
[0m00:51:25.172843 [info ] [MainThread]: Configuration:
[0m00:51:25.177297 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m00:51:25.179117 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m00:51:25.180726 [info ] [MainThread]: Required dependencies:
[0m00:51:25.183217 [debug] [MainThread]: Executing "git --help"
[0m00:51:25.305879 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone      Clone a repository into a new directory\n   init       Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add        Add file contents to the index\n   mv         Move or rename a file, a directory, or a symlink\n   restore    Restore working tree files\n   rm         Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect     Use binary search to find the commit that introduced a bug\n   diff       Show changes between commits, commit and working tree, etc\n   grep       Print lines matching a pattern\n   log        Show commit logs\n   show       Show various types of objects\n   status     Show the working tree status\n\ngrow, mark and tweak your common history\n   backfill   Download missing objects in a partial clone\n   branch     List, create, or delete branches\n   commit     Record changes to the repository\n   merge      Join two or more development histories together\n   rebase     Reapply commits on top of another base tip\n   reset      Reset current HEAD to the specified state\n   switch     Switch branches\n   tag        Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch      Download objects and refs from another repository\n   pull       Fetch from and integrate with another repository or a local branch\n   push       Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m00:51:25.307483 [debug] [MainThread]: STDERR: "b''"
[0m00:51:25.309711 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m00:51:25.311928 [info ] [MainThread]: Connection:
[0m00:51:25.316058 [info ] [MainThread]:   method: service-account
[0m00:51:25.318606 [info ] [MainThread]:   database: impression-digital
[0m00:51:25.321024 [info ] [MainThread]:   execution_project: impression-digital
[0m00:51:25.322563 [info ] [MainThread]:   schema: raw
[0m00:51:25.325717 [info ] [MainThread]:   location: EU
[0m00:51:25.328235 [info ] [MainThread]:   priority: interactive
[0m00:51:25.330555 [info ] [MainThread]:   maximum_bytes_billed: None
[0m00:51:25.342833 [info ] [MainThread]:   impersonate_service_account: None
[0m00:51:25.347368 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m00:51:25.350886 [info ] [MainThread]:   job_retries: 1
[0m00:51:25.359344 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m00:51:25.365231 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m00:51:25.368214 [info ] [MainThread]:   timeout_seconds: 300
[0m00:51:25.372487 [info ] [MainThread]:   client_id: None
[0m00:51:25.375115 [info ] [MainThread]:   token_uri: None
[0m00:51:25.378251 [info ] [MainThread]:   dataproc_region: None
[0m00:51:25.380814 [info ] [MainThread]:   dataproc_cluster_name: None
[0m00:51:25.382308 [info ] [MainThread]:   gcs_bucket: None
[0m00:51:25.395610 [info ] [MainThread]:   dataproc_batch: None
[0m00:51:25.413864 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m00:51:26.205608 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m00:51:26.205608 [debug] [MainThread]: On debug: select 1 as id
[0m00:51:26.205608 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:51:27.174617 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:fe524a99-df40-4e26-b040-01371e104d97&page=queryresults
[0m00:51:27.782527 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m00:51:27.797065 [info ] [MainThread]: [32mAll checks passed![0m
[0m00:51:27.809209 [debug] [MainThread]: Command `dbt debug` succeeded at 00:51:27.808219 after 6.90 seconds
[0m00:51:27.809209 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m00:51:27.815844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016E7581AEA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016E727F2C00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000016E75C20A40>]}
[0m00:51:27.820578 [debug] [MainThread]: Flushing usage events
[0m00:51:28.229532 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:52:27.678272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D1FFF1D90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D1FFF1D30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D1FFF1C10>]}


============================== 00:52:27.687849 | f1be81fa-2bc1-4b63-92c5-65b1fd2d7811 ==============================
[0m00:52:27.687849 [info ] [MainThread]: Running with dbt=1.9.1
[0m00:52:27.689559 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select staging.customer', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:52:30.820313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f1be81fa-2bc1-4b63-92c5-65b1fd2d7811', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D2870FBF0>]}
[0m00:52:30.967746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f1be81fa-2bc1-4b63-92c5-65b1fd2d7811', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D287E4080>]}
[0m00:52:30.971103 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m00:52:31.742152 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m00:52:31.752853 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m00:52:31.754813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'f1be81fa-2bc1-4b63-92c5-65b1fd2d7811', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D28D61CA0>]}
[0m00:52:34.060985 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m00:52:34.080791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f1be81fa-2bc1-4b63-92c5-65b1fd2d7811', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D2A799F70>]}
[0m00:52:34.381657 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m00:52:34.398065 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m00:52:34.489184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f1be81fa-2bc1-4b63-92c5-65b1fd2d7811', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D2A798170>]}
[0m00:52:34.493357 [info ] [MainThread]: Found 1 model, 489 macros
[0m00:52:34.498512 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f1be81fa-2bc1-4b63-92c5-65b1fd2d7811', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D2A7A6420>]}
[0m00:52:34.505930 [info ] [MainThread]: 
[0m00:52:34.507646 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:52:34.510281 [info ] [MainThread]: 
[0m00:52:34.515150 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:52:34.519494 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m00:52:34.521384 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:52:34.994862 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_impression-digital, now create_impression-digital_raw_staging)
[0m00:52:34.997682 [debug] [ThreadPool]: Creating schema "database: "impression-digital"
schema: "raw_staging"
"
[0m00:52:35.030174 [debug] [ThreadPool]: On create_impression-digital_raw_staging: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "connection_name": "create_impression-digital_raw_staging"} */
create schema if not exists `impression-digital`.`raw_staging`
  
[0m00:52:35.031229 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:52:35.773552 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:56df8ab6-26b7-4aa8-a3c0-c14abf4dc856&page=queryresults
[0m00:52:37.771909 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_raw_staging'
[0m00:52:37.771909 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:52:38.219996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f1be81fa-2bc1-4b63-92c5-65b1fd2d7811', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D28D61670>]}
[0m00:52:38.220991 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:52:38.245509 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m00:52:38.246094 [info ] [Thread-1 (]: 1 of 1 START sql table model raw_staging.customer .............................. [RUN]
[0m00:52:38.254011 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m00:52:38.259566 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m00:52:38.329433 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m00:52:38.336962 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m00:52:38.434544 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m00:52:38.438987 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`raw_staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,CONCAT(first_name, ' ', last_name) AS customer_name
  ,email
  ,phone
FROM 'impression-digital.raw.Customer'

)

SELECT *
FROM raw_cust
    );
  
[0m00:52:38.438987 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m00:52:38.702869 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:b6219283-7bc6-485c-8acb-bfef0f6e78cc&page=queryresults
[0m00:52:38.702869 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:b6219283-7bc6-485c-8acb-bfef0f6e78cc&page=queryresults
[0m00:52:38.785064 [debug] [Thread-1 (]: Database Error in model customer (models\staging\customer.sql)
  Syntax error: Unexpected string literal 'impression-digital.raw.Customer' at [22:6]
  compiled code at target\run\shopify\models\staging\customer.sql
[0m00:52:38.785064 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f1be81fa-2bc1-4b63-92c5-65b1fd2d7811', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D2A7D9EB0>]}
[0m00:52:38.792202 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model raw_staging.customer ..................... [[31mERROR[0m in 0.53s]
[0m00:52:38.795110 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m00:52:38.797596 [debug] [Thread-4 (]: Marking all children of 'model.shopify.customer' to be skipped because of status 'error'.  Reason: Database Error in model customer (models\staging\customer.sql)
  Syntax error: Unexpected string literal 'impression-digital.raw.Customer' at [22:6]
  compiled code at target\run\shopify\models\staging\customer.sql.
[0m00:52:38.803656 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:52:38.808651 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:52:38.811715 [debug] [MainThread]: Connection 'create_impression-digital_raw_staging' was properly closed.
[0m00:52:38.815798 [debug] [MainThread]: Connection 'list_impression-digital_raw_staging' was properly closed.
[0m00:52:38.817634 [debug] [MainThread]: Connection 'model.shopify.customer' was properly closed.
[0m00:52:38.819292 [info ] [MainThread]: 
[0m00:52:38.822174 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.31 seconds (4.31s).
[0m00:52:38.825225 [debug] [MainThread]: Command end result
[0m00:52:38.915083 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m00:52:38.924525 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m00:52:38.971848 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m00:52:38.973849 [info ] [MainThread]: 
[0m00:52:38.999617 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m00:52:39.011258 [info ] [MainThread]: 
[0m00:52:39.040266 [error] [MainThread]:   Database Error in model customer (models\staging\customer.sql)
  Syntax error: Unexpected string literal 'impression-digital.raw.Customer' at [22:6]
  compiled code at target\run\shopify\models\staging\customer.sql
[0m00:52:39.070684 [info ] [MainThread]: 
[0m00:52:39.079922 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m00:52:39.089115 [debug] [MainThread]: Command `dbt run` failed at 00:52:39.087046 after 11.70 seconds
[0m00:52:39.092009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D2A372030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D2A2B1A90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D1FFF00B0>]}
[0m00:52:39.098968 [debug] [MainThread]: Flushing usage events
[0m00:52:39.515781 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:52:59.624376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000139CA3A5DC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000139CA5B5760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000139CD26BFB0>]}


============================== 00:52:59.630050 | df70f553-f1d5-42bd-9de2-8e3144e920bb ==============================
[0m00:52:59.630050 [info ] [MainThread]: Running with dbt=1.9.1
[0m00:52:59.633995 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select staging.customer', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m00:53:02.659477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'df70f553-f1d5-42bd-9de2-8e3144e920bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000139D7E1B710>]}
[0m00:53:02.759619 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'df70f553-f1d5-42bd-9de2-8e3144e920bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000139CDBB29F0>]}
[0m00:53:02.768861 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m00:53:03.650499 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m00:53:03.924448 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:53:03.932559 [debug] [MainThread]: Partial parsing: updated file: shopify://models\staging\customer.sql
[0m00:53:04.382917 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m00:53:04.390674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'df70f553-f1d5-42bd-9de2-8e3144e920bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000139D84A4F50>]}
[0m00:53:04.537750 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m00:53:04.552046 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m00:53:04.608118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'df70f553-f1d5-42bd-9de2-8e3144e920bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000139D825C110>]}
[0m00:53:04.610455 [info ] [MainThread]: Found 1 model, 489 macros
[0m00:53:04.612403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'df70f553-f1d5-42bd-9de2-8e3144e920bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000139D5A5C800>]}
[0m00:53:04.615265 [info ] [MainThread]: 
[0m00:53:04.620276 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:53:04.623494 [info ] [MainThread]: 
[0m00:53:04.627075 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:53:04.634129 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m00:53:04.635693 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:53:05.168429 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_raw_staging'
[0m00:53:05.170859 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:53:05.487328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'df70f553-f1d5-42bd-9de2-8e3144e920bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000139CB8AFB90>]}
[0m00:53:05.489707 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:53:05.501785 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m00:53:05.502783 [info ] [Thread-1 (]: 1 of 1 START sql table model raw_staging.customer .............................. [RUN]
[0m00:53:05.507573 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m00:53:05.509574 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m00:53:05.557723 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m00:53:05.564499 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m00:53:05.668612 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m00:53:05.675373 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`raw_staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,CONCAT(first_name, ' ', last_name) AS customer_name
  ,email
  ,phone
FROM impression-digital.raw.Customer

)

SELECT *
FROM raw_cust
    );
  
[0m00:53:05.677374 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m00:53:07.046854 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:c6835ae9-76a4-410e-b2ac-5281b5913e30&page=queryresults
[0m00:53:10.635731 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df70f553-f1d5-42bd-9de2-8e3144e920bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000139D7D063C0>]}
[0m00:53:10.638268 [info ] [Thread-1 (]: 1 of 1 OK created sql table model raw_staging.customer ......................... [[32mCREATE TABLE (13.0 rows, 1.1 KiB processed)[0m in 5.12s]
[0m00:53:10.646435 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m00:53:10.654202 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:53:10.662018 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:53:10.663022 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m00:53:10.663022 [debug] [MainThread]: Connection 'list_impression-digital_raw_staging' was properly closed.
[0m00:53:10.667698 [debug] [MainThread]: Connection 'model.shopify.customer' was properly closed.
[0m00:53:10.672303 [info ] [MainThread]: 
[0m00:53:10.677793 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 6.05 seconds (6.05s).
[0m00:53:10.681174 [debug] [MainThread]: Command end result
[0m00:53:10.874581 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m00:53:10.882752 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m00:53:10.904971 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m00:53:10.907176 [info ] [MainThread]: 
[0m00:53:10.909768 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:53:10.910766 [info ] [MainThread]: 
[0m00:53:10.914905 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m00:53:10.922859 [debug] [MainThread]: Command `dbt run` succeeded at 00:53:10.922036 after 11.54 seconds
[0m00:53:10.925235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000139D6384350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000139D58F71D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000139D7A8C200>]}
[0m00:53:10.930870 [debug] [MainThread]: Flushing usage events
[0m00:53:11.624914 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:59:01.179840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000127B032F500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000127B032C440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000127B043BFE0>]}


============================== 00:59:01.188053 | a58b1256-0933-4dbd-b22b-7dede2016bab ==============================
[0m00:59:01.188053 [info ] [MainThread]: Running with dbt=1.9.1
[0m00:59:01.191648 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select staging.customer', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:59:04.139552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a58b1256-0933-4dbd-b22b-7dede2016bab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000127B9A2D520>]}
[0m00:59:04.269644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a58b1256-0933-4dbd-b22b-7dede2016bab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000127BAE52F30>]}
[0m00:59:04.274098 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m00:59:05.100963 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m00:59:05.207311 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m00:59:05.213352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a58b1256-0933-4dbd-b22b-7dede2016bab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000127BB543170>]}
[0m00:59:07.272755 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m00:59:07.278685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a58b1256-0933-4dbd-b22b-7dede2016bab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000127BB69BEC0>]}
[0m00:59:07.429181 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m00:59:07.440296 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m00:59:07.499066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a58b1256-0933-4dbd-b22b-7dede2016bab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000127BB69BF80>]}
[0m00:59:07.501067 [info ] [MainThread]: Found 1 model, 489 macros
[0m00:59:07.503589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a58b1256-0933-4dbd-b22b-7dede2016bab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000127BB5DB050>]}
[0m00:59:07.509198 [info ] [MainThread]: 
[0m00:59:07.510539 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m00:59:07.512532 [info ] [MainThread]: 
[0m00:59:07.517129 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:59:07.522417 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m00:59:07.526991 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:59:08.037078 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_impression-digital, now create_impression-digital_raw_staging)
[0m00:59:08.040511 [debug] [ThreadPool]: Creating schema "database: "impression-digital"
schema: "raw_staging"
"
[0m00:59:08.096105 [debug] [ThreadPool]: On create_impression-digital_raw_staging: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "connection_name": "create_impression-digital_raw_staging"} */
create schema if not exists `impression-digital`.`raw_staging`
  
[0m00:59:08.096105 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:59:08.573700 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:05b17750-4ca2-489a-a59b-1c1f81722446&page=queryresults
[0m00:59:10.397255 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_raw_staging'
[0m00:59:10.398005 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:59:11.023849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a58b1256-0933-4dbd-b22b-7dede2016bab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000127BB268CE0>]}
[0m00:59:11.027165 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:59:11.053736 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m00:59:11.055375 [info ] [Thread-1 (]: 1 of 1 START sql table model raw_staging.customer .............................. [RUN]
[0m00:59:11.058871 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m00:59:11.063365 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m00:59:11.098777 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m00:59:11.104091 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m00:59:11.244194 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m00:59:11.247722 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`raw_staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,CONCAT(first_name, ' ', last_name) AS customer_name
  ,email
  ,phone
FROM impression-digital.raw.Customer

)

SELECT *
FROM raw_cust
    );
  
[0m00:59:11.248724 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m00:59:12.793112 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:a120384e-b9c0-43be-a690-f1d602ef3bf0&page=queryresults
[0m00:59:15.908425 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a58b1256-0933-4dbd-b22b-7dede2016bab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000127B032DB50>]}
[0m00:59:15.914904 [info ] [Thread-1 (]: 1 of 1 OK created sql table model raw_staging.customer ......................... [[32mCREATE TABLE (13.0 rows, 1.1 KiB processed)[0m in 4.83s]
[0m00:59:15.936174 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m00:59:15.943436 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:59:15.954270 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:59:15.954270 [debug] [MainThread]: Connection 'create_impression-digital_raw_staging' was properly closed.
[0m00:59:15.954270 [debug] [MainThread]: Connection 'list_impression-digital_raw_staging' was properly closed.
[0m00:59:15.962832 [debug] [MainThread]: Connection 'model.shopify.customer' was properly closed.
[0m00:59:15.966123 [info ] [MainThread]: 
[0m00:59:15.997094 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 8.45 seconds (8.45s).
[0m00:59:16.014023 [debug] [MainThread]: Command end result
[0m00:59:16.132253 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m00:59:16.140458 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m00:59:16.165208 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m00:59:16.166192 [info ] [MainThread]: 
[0m00:59:16.169534 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:59:16.171066 [info ] [MainThread]: 
[0m00:59:16.173359 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m00:59:16.179930 [debug] [MainThread]: Command `dbt run` succeeded at 00:59:16.178926 after 15.33 seconds
[0m00:59:16.182356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000127B0D8C800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000127B093A750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000127B03F03E0>]}
[0m00:59:16.188982 [debug] [MainThread]: Flushing usage events
[0m00:59:16.635788 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:00:28.131745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B22F8B7920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B22F560860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B22F563BC0>]}


============================== 01:00:28.135943 | f095738d-01f2-460d-8ec1-4b678b730915 ==============================
[0m01:00:28.135943 [info ] [MainThread]: Running with dbt=1.9.1
[0m01:00:28.143466 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --select staging.customer', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:00:31.111624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f095738d-01f2-460d-8ec1-4b678b730915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B238314B30>]}
[0m01:00:31.209521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f095738d-01f2-460d-8ec1-4b678b730915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23A20D010>]}
[0m01:00:31.214296 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:00:32.116172 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m01:00:32.216952 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m01:00:32.223444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'f095738d-01f2-460d-8ec1-4b678b730915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23A244710>]}
[0m01:00:34.336886 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m01:00:34.343104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f095738d-01f2-460d-8ec1-4b678b730915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23A75A1E0>]}
[0m01:00:34.482213 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:00:34.493086 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:00:34.554921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f095738d-01f2-460d-8ec1-4b678b730915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23A7298E0>]}
[0m01:00:34.557511 [info ] [MainThread]: Found 1 model, 489 macros
[0m01:00:34.563248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f095738d-01f2-460d-8ec1-4b678b730915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23A64B3E0>]}
[0m01:00:34.570010 [info ] [MainThread]: 
[0m01:00:34.579766 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:00:34.581533 [info ] [MainThread]: 
[0m01:00:34.585142 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:00:34.605318 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m01:00:34.609144 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:00:35.193216 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_impression-digital, now create_impression-digital_staging_staging)
[0m01:00:35.194263 [debug] [ThreadPool]: Creating schema "database: "impression-digital"
schema: "staging_staging"
"
[0m01:00:35.270712 [debug] [ThreadPool]: On create_impression-digital_staging_staging: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "connection_name": "create_impression-digital_staging_staging"} */
create schema if not exists `impression-digital`.`staging_staging`
  
[0m01:00:35.270712 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:00:35.906825 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:b9da3814-f9ab-4b61-b039-d626d09eaea3&page=queryresults
[0m01:00:38.226365 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_staging_staging'
[0m01:00:38.228360 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:00:38.995654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f095738d-01f2-460d-8ec1-4b678b730915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B22FF21E20>]}
[0m01:00:39.000930 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:00:39.030519 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m01:00:39.036568 [info ] [Thread-1 (]: 1 of 1 START sql table model staging_staging.customer .......................... [RUN]
[0m01:00:39.040841 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m01:00:39.042698 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m01:00:39.071846 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m01:00:39.082064 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m01:00:39.171429 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m01:00:39.181579 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging_staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,CONCAT(first_name, ' ', last_name) AS customer_name
  ,email
  ,phone
FROM impression-digital.raw.Customer

)

SELECT *
FROM raw_cust
    );
  
[0m01:00:39.183969 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m01:00:40.424481 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:7949cbe3-b5b3-4eef-ae86-da00b73ad389&page=queryresults
[0m01:00:43.934762 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f095738d-01f2-460d-8ec1-4b678b730915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B22F3E19D0>]}
[0m01:00:43.935762 [info ] [Thread-1 (]: 1 of 1 OK created sql table model staging_staging.customer ..................... [[32mCREATE TABLE (13.0 rows, 1.1 KiB processed)[0m in 4.89s]
[0m01:00:43.939321 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m01:00:43.943023 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:00:43.947349 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:00:43.951277 [debug] [MainThread]: Connection 'create_impression-digital_staging_staging' was properly closed.
[0m01:00:43.952274 [debug] [MainThread]: Connection 'list_impression-digital_staging_staging' was properly closed.
[0m01:00:43.954915 [debug] [MainThread]: Connection 'model.shopify.customer' was properly closed.
[0m01:00:43.956915 [info ] [MainThread]: 
[0m01:00:43.961011 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 9.37 seconds (9.37s).
[0m01:00:43.964094 [debug] [MainThread]: Command end result
[0m01:00:44.055052 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:00:44.061864 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:00:44.079850 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m01:00:44.080849 [info ] [MainThread]: 
[0m01:00:44.083444 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:00:44.085100 [info ] [MainThread]: 
[0m01:00:44.088039 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:00:44.093405 [debug] [MainThread]: Command `dbt run` succeeded at 01:00:44.092399 after 16.27 seconds
[0m01:00:44.095661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23A30C620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B23A6B6FC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002B22F4A4470>]}
[0m01:00:44.095661 [debug] [MainThread]: Flushing usage events
[0m01:00:44.510601 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:05:39.437710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEB5120B30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEB5120BC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEB5123770>]}


============================== 01:05:39.444764 | 0680faac-25e7-4f51-bc09-aa34fe8be461 ==============================
[0m01:05:39.444764 [info ] [MainThread]: Running with dbt=1.9.1
[0m01:05:39.448612 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt debug', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:05:39.505037 [info ] [MainThread]: dbt version: 1.9.1
[0m01:05:39.512691 [info ] [MainThread]: python version: 3.12.4
[0m01:05:39.515521 [info ] [MainThread]: python path: C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\venv\Scripts\python.exe
[0m01:05:39.534100 [info ] [MainThread]: os info: Windows-10-10.0.19045-SP0
[0m01:05:42.216184 [info ] [MainThread]: Using profiles dir at C:\Users\amarh\.dbt
[0m01:05:42.219626 [info ] [MainThread]: Using profiles.yml file at C:\Users\amarh\.dbt\profiles.yml
[0m01:05:42.221308 [info ] [MainThread]: Using dbt_project.yml file at C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\dbt_project.yml
[0m01:05:42.223570 [info ] [MainThread]: adapter type: bigquery
[0m01:05:42.223570 [info ] [MainThread]: adapter version: 1.9.0
[0m01:05:42.471409 [info ] [MainThread]: Configuration:
[0m01:05:42.479073 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m01:05:42.484567 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m01:05:42.489353 [info ] [MainThread]: Required dependencies:
[0m01:05:42.491754 [debug] [MainThread]: Executing "git --help"
[0m01:05:42.657290 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone      Clone a repository into a new directory\n   init       Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add        Add file contents to the index\n   mv         Move or rename a file, a directory, or a symlink\n   restore    Restore working tree files\n   rm         Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect     Use binary search to find the commit that introduced a bug\n   diff       Show changes between commits, commit and working tree, etc\n   grep       Print lines matching a pattern\n   log        Show commit logs\n   show       Show various types of objects\n   status     Show the working tree status\n\ngrow, mark and tweak your common history\n   backfill   Download missing objects in a partial clone\n   branch     List, create, or delete branches\n   commit     Record changes to the repository\n   merge      Join two or more development histories together\n   rebase     Reapply commits on top of another base tip\n   reset      Reset current HEAD to the specified state\n   switch     Switch branches\n   tag        Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch      Download objects and refs from another repository\n   pull       Fetch from and integrate with another repository or a local branch\n   push       Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m01:05:42.658289 [debug] [MainThread]: STDERR: "b''"
[0m01:05:42.661236 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m01:05:42.663154 [info ] [MainThread]: Connection:
[0m01:05:42.667228 [info ] [MainThread]:   method: service-account
[0m01:05:42.672022 [info ] [MainThread]:   database: impression-digital
[0m01:05:42.675018 [info ] [MainThread]:   execution_project: impression-digital
[0m01:05:42.677295 [info ] [MainThread]:   schema: staging
[0m01:05:42.680304 [info ] [MainThread]:   location: EU
[0m01:05:42.689854 [info ] [MainThread]:   priority: interactive
[0m01:05:42.691652 [info ] [MainThread]:   maximum_bytes_billed: None
[0m01:05:42.695650 [info ] [MainThread]:   impersonate_service_account: None
[0m01:05:42.698098 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m01:05:42.701820 [info ] [MainThread]:   job_retries: 1
[0m01:05:42.704842 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m01:05:42.707741 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m01:05:42.710154 [info ] [MainThread]:   timeout_seconds: 300
[0m01:05:42.712909 [info ] [MainThread]:   client_id: None
[0m01:05:42.716585 [info ] [MainThread]:   token_uri: None
[0m01:05:42.722879 [info ] [MainThread]:   dataproc_region: None
[0m01:05:42.726419 [info ] [MainThread]:   dataproc_cluster_name: None
[0m01:05:42.729305 [info ] [MainThread]:   gcs_bucket: None
[0m01:05:42.731890 [info ] [MainThread]:   dataproc_batch: None
[0m01:05:42.739894 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:05:43.489083 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m01:05:43.497877 [debug] [MainThread]: On debug: select 1 as id
[0m01:05:43.499575 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:05:44.042650 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:086e92b2-c5b4-4aff-bd4c-0d2aa91e0369&page=queryresults
[0m01:05:44.468553 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m01:05:44.471706 [info ] [MainThread]: [32mAll checks passed![0m
[0m01:05:44.475199 [debug] [MainThread]: Command `dbt debug` succeeded at 01:05:44.475199 after 5.52 seconds
[0m01:05:44.476976 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m01:05:44.478690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEB457D2E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEBD496A50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FEBE437C20>]}
[0m01:05:44.480745 [debug] [MainThread]: Flushing usage events
[0m01:05:44.889269 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:05:57.586023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9E37B63F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9E6CA8EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9E67D8C20>]}


============================== 01:05:57.592734 | b86e28eb-bfad-4e29-9bd8-115cbfdac484 ==============================
[0m01:05:57.592734 [info ] [MainThread]: Running with dbt=1.9.1
[0m01:05:57.597068 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt ls --resource-type model --output json', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m01:06:00.424611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b86e28eb-bfad-4e29-9bd8-115cbfdac484', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9F11392E0>]}
[0m01:06:00.516989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b86e28eb-bfad-4e29-9bd8-115cbfdac484', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9E62AD100>]}
[0m01:06:00.520690 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:06:01.305549 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m01:06:01.598662 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:06:01.606718 [debug] [MainThread]: Partial parsing: updated file: shopify://models\staging\customer.sql
[0m01:06:02.088825 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m01:06:02.096193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b86e28eb-bfad-4e29-9bd8-115cbfdac484', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9F15658B0>]}
[0m01:06:02.246476 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:06:02.256120 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:06:02.311764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b86e28eb-bfad-4e29-9bd8-115cbfdac484', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9F140D2B0>]}
[0m01:06:02.313435 [info ] [MainThread]: Found 1 model, 489 macros
[0m01:06:02.315762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b86e28eb-bfad-4e29-9bd8-115cbfdac484', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9F16D2C30>]}
[0m01:06:02.319351 [info ] [MainThread]: {"name": "customer", "resource_type": "model", "package_name": "shopify", "original_file_path": "models\\staging\\customer.sql", "unique_id": "model.shopify.customer", "alias": "customer", "config": {"enabled": true, "alias": null, "schema": "staging", "database": null, "tags": [], "meta": {}, "group": null, "materialized": "table", "incremental_strategy": null, "batch_size": null, "lookback": 1, "begin": null, "persist_docs": {}, "post-hook": [], "pre-hook": [], "quoting": {}, "column_types": {}, "full_refresh": null, "unique_key": null, "on_schema_change": "ignore", "on_configuration_change": "apply", "grants": {}, "packages": [], "docs": {"show": true, "node_color": null}, "contract": {"enforced": false, "alias_types": true}, "event_time": null, "concurrent_batches": null, "access": "protected"}, "tags": [], "depends_on": {"macros": [], "nodes": []}}
[0m01:06:02.325480 [debug] [MainThread]: Command `dbt ls` succeeded at 01:06:02.324478 after 4.96 seconds
[0m01:06:02.326837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9E6C41A90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9F15B4740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9E4546060>]}
[0m01:06:02.330833 [debug] [MainThread]: Flushing usage events
[0m01:06:02.726067 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:07:49.279490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F855C01280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F855C03BF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F855C001D0>]}


============================== 01:07:49.289620 | 50849ace-0165-4091-80ce-aab2301c5260 ==============================
[0m01:07:49.289620 [info ] [MainThread]: Running with dbt=1.9.1
[0m01:07:49.292829 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --select staging.customer', 'send_anonymous_usage_stats': 'True'}
[0m01:07:52.120132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '50849ace-0165-4091-80ce-aab2301c5260', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F85EB13110>]}
[0m01:07:52.215368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '50849ace-0165-4091-80ce-aab2301c5260', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F855B984D0>]}
[0m01:07:52.219981 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:07:52.939995 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m01:07:53.038522 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m01:07:53.048450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '50849ace-0165-4091-80ce-aab2301c5260', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F855C31670>]}
[0m01:07:55.126059 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m01:07:55.131819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '50849ace-0165-4091-80ce-aab2301c5260', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F8608B86E0>]}
[0m01:07:55.302686 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:07:55.309085 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:07:55.364891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '50849ace-0165-4091-80ce-aab2301c5260', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F86087E2A0>]}
[0m01:07:55.365893 [info ] [MainThread]: Found 1 model, 489 macros
[0m01:07:55.368046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '50849ace-0165-4091-80ce-aab2301c5260', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F860823050>]}
[0m01:07:55.369046 [info ] [MainThread]: 
[0m01:07:55.375527 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:07:55.379071 [info ] [MainThread]: 
[0m01:07:55.387252 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:07:55.392405 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m01:07:55.395095 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:07:55.854136 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_staging_staging'
[0m01:07:55.859692 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:07:56.168447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '50849ace-0165-4091-80ce-aab2301c5260', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F86049AF30>]}
[0m01:07:56.170060 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:07:56.178123 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m01:07:56.179947 [info ] [Thread-1 (]: 1 of 1 START sql table model staging_staging.customer .......................... [RUN]
[0m01:07:56.182698 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m01:07:56.185030 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m01:07:56.207320 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m01:07:56.219594 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m01:07:56.286263 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m01:07:56.632747 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m01:07:56.638593 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging_staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,CONCAT(first_name, ' ', last_name) AS customer_name
  ,email
  ,phone
FROM impression-digital.raw.Customer

)

SELECT *
FROM raw_cust
    );
  
[0m01:07:57.058722 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:66c11d9e-7269-4971-b489-4e6ee390e865&page=queryresults
[0m01:08:00.339608 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '50849ace-0165-4091-80ce-aab2301c5260', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F8602166C0>]}
[0m01:08:00.341642 [info ] [Thread-1 (]: 1 of 1 OK created sql table model staging_staging.customer ..................... [[32mCREATE TABLE (13.0 rows, 1.1 KiB processed)[0m in 4.15s]
[0m01:08:00.348772 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m01:08:00.356290 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:08:00.368088 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:08:00.369093 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m01:08:00.372188 [debug] [MainThread]: Connection 'list_impression-digital_staging_staging' was properly closed.
[0m01:08:00.373183 [debug] [MainThread]: Connection 'model.shopify.customer' was properly closed.
[0m01:08:00.381104 [info ] [MainThread]: 
[0m01:08:00.384307 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 5.00 seconds (5.00s).
[0m01:08:00.390406 [debug] [MainThread]: Command end result
[0m01:08:00.479885 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:08:00.486732 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:08:00.500172 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m01:08:00.502213 [info ] [MainThread]: 
[0m01:08:00.504300 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:08:00.506697 [info ] [MainThread]: 
[0m01:08:00.510340 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:08:00.516489 [debug] [MainThread]: Command `dbt run` succeeded at 01:08:00.516489 after 11.55 seconds
[0m01:08:00.522766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F853778560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F853DBBEF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F86071C7D0>]}
[0m01:08:00.525056 [debug] [MainThread]: Flushing usage events
[0m01:08:00.942516 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:09:43.740031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028066EC0C20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028066D5B140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002806648E1B0>]}


============================== 01:09:43.747080 | 43dfdd86-8789-463d-b567-3e735f78c3ff ==============================
[0m01:09:43.747080 [info ] [MainThread]: Running with dbt=1.9.1
[0m01:09:43.750368 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select staging.customer', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:09:46.685465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '43dfdd86-8789-463d-b567-3e735f78c3ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028070E7E4E0>]}
[0m01:09:46.804356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '43dfdd86-8789-463d-b567-3e735f78c3ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002806FA15B50>]}
[0m01:09:46.808644 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:09:47.629408 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m01:09:47.775505 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m01:09:47.778208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '43dfdd86-8789-463d-b567-3e735f78c3ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002807109C710>]}
[0m01:09:49.828388 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.shopify.staging
- models.shopify.raw
[0m01:09:49.847834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '43dfdd86-8789-463d-b567-3e735f78c3ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000280717CBC20>]}
[0m01:09:50.061535 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:09:50.073766 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:09:50.139289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '43dfdd86-8789-463d-b567-3e735f78c3ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028071716570>]}
[0m01:09:50.140310 [info ] [MainThread]: Found 1 model, 489 macros
[0m01:09:50.143345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '43dfdd86-8789-463d-b567-3e735f78c3ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002807171B050>]}
[0m01:09:50.144346 [warn ] [MainThread]: The selection criterion 'staging.customer' does not match any enabled nodes
[0m01:09:50.149322 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m01:09:50.152380 [debug] [MainThread]: Command end result
[0m01:09:50.217787 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:09:50.222170 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:09:50.238817 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m01:09:50.241207 [debug] [MainThread]: Command `dbt run` succeeded at 01:09:50.241207 after 6.84 seconds
[0m01:09:50.241207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028066D02630>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028066463560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002806675DAF0>]}
[0m01:09:50.245460 [debug] [MainThread]: Flushing usage events
[0m01:09:50.718184 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:14:13.491953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB8C10C530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB8CB28E00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB8E9DA780>]}


============================== 01:14:13.499393 | d1a9f097-7b10-4b74-b053-ca2c8f1f0df2 ==============================
[0m01:14:13.499393 [info ] [MainThread]: Running with dbt=1.9.1
[0m01:14:13.502748 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --select staging.customer', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:14:16.375629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd1a9f097-7b10-4b74-b053-ca2c8f1f0df2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB8E9DA3C0>]}
[0m01:14:16.479864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd1a9f097-7b10-4b74-b053-ca2c8f1f0df2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB97CAFCE0>]}
[0m01:14:16.481834 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:14:17.240401 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m01:14:17.345723 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m01:14:17.350731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'd1a9f097-7b10-4b74-b053-ca2c8f1f0df2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB8E9D9220>]}
[0m01:14:19.219579 [error] [MainThread]: Encountered an error:
Parsing Error
  at path ['schema']: Undefined is not valid under any of the given schemas
[0m01:14:19.227160 [debug] [MainThread]: Command `dbt run` failed at 01:14:19.227160 after 6.04 seconds
[0m01:14:19.228208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB8C10C530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB994FE750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001EB9956B980>]}
[0m01:14:19.230209 [debug] [MainThread]: Flushing usage events
[0m01:14:19.679576 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:14:46.127542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D8ED9EC770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D8F02B8A70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D8F02BADB0>]}


============================== 01:14:46.129749 | f92d3f74-f1a4-4435-b9bb-e1d3d20e8dce ==============================
[0m01:14:46.129749 [info ] [MainThread]: Running with dbt=1.9.1
[0m01:14:46.138335 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'debug': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select staging.customer', 'send_anonymous_usage_stats': 'True'}
[0m01:14:49.113622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f92d3f74-f1a4-4435-b9bb-e1d3d20e8dce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D8F9573B60>]}
[0m01:14:49.333323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f92d3f74-f1a4-4435-b9bb-e1d3d20e8dce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D8F88EF890>]}
[0m01:14:49.336323 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:14:50.045316 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m01:14:50.160471 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m01:14:50.162472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'f92d3f74-f1a4-4435-b9bb-e1d3d20e8dce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D8FADFB350>]}
[0m01:14:52.113679 [error] [MainThread]: Encountered an error:
Parsing Error
  at path ['schema']: Undefined is not valid under any of the given schemas
[0m01:14:52.116778 [debug] [MainThread]: Command `dbt run` failed at 01:14:52.115779 after 6.22 seconds
[0m01:14:52.117646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D8ED0F6660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D8FAB050A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D8FADF8D70>]}
[0m01:14:52.118647 [debug] [MainThread]: Flushing usage events
[0m01:14:52.502875 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:15:19.900383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FE2B21CEC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FE2DCB3980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FE2DCB3410>]}


============================== 01:15:19.902896 | 2bc9f672-7b2b-4493-a97d-07e4cd0666e1 ==============================
[0m01:15:19.902896 [info ] [MainThread]: Running with dbt=1.9.1
[0m01:15:19.910418 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select staging.customer', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:15:22.752775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2bc9f672-7b2b-4493-a97d-07e4cd0666e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FE3763CEF0>]}
[0m01:15:22.854683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2bc9f672-7b2b-4493-a97d-07e4cd0666e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FE2E3C3F80>]}
[0m01:15:22.856070 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:15:23.610420 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m01:15:23.723001 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m01:15:23.725574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '2bc9f672-7b2b-4493-a97d-07e4cd0666e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FE2E3C13A0>]}
[0m01:15:25.761511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2bc9f672-7b2b-4493-a97d-07e4cd0666e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FE39094920>]}
[0m01:15:25.894094 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:15:25.903444 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:15:25.963981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2bc9f672-7b2b-4493-a97d-07e4cd0666e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FE38ACA690>]}
[0m01:15:25.965139 [info ] [MainThread]: Found 1 model, 489 macros
[0m01:15:25.968833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2bc9f672-7b2b-4493-a97d-07e4cd0666e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FE38FF7DA0>]}
[0m01:15:25.975504 [info ] [MainThread]: 
[0m01:15:25.976326 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:15:25.981257 [info ] [MainThread]: 
[0m01:15:26.035368 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:15:26.107655 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m01:15:26.109656 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:15:26.691447 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_impression-digital, now create_impression-digital_raw_staging)
[0m01:15:26.695011 [debug] [ThreadPool]: Creating schema "database: "impression-digital"
schema: "raw_staging"
"
[0m01:15:26.751180 [debug] [ThreadPool]: On create_impression-digital_raw_staging: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "connection_name": "create_impression-digital_raw_staging"} */
create schema if not exists `impression-digital`.`raw_staging`
  
[0m01:15:26.754823 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:15:27.107025 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:0aab1e1f-085f-4a81-805a-78039f89268f&page=queryresults
[0m01:15:30.743811 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_raw_staging'
[0m01:15:30.744829 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:15:31.506452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2bc9f672-7b2b-4493-a97d-07e4cd0666e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FE390372C0>]}
[0m01:15:31.512512 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:15:31.547798 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m01:15:31.551907 [info ] [Thread-1 (]: 1 of 1 START sql table model raw_staging.customer .............................. [RUN]
[0m01:15:31.557625 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m01:15:31.557625 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m01:15:31.626042 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m01:15:31.640948 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m01:15:31.819453 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m01:15:31.827917 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`raw_staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,CONCAT(first_name, ' ', last_name) AS customer_name
  ,email
  ,phone
FROM impression-digital.raw.Customer

)

SELECT *
FROM raw_cust
    );
  
[0m01:15:31.831062 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m01:15:32.949863 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:e0d4a9c4-ce6b-403b-9427-9b7a053b13ea&page=queryresults
[0m01:15:35.766988 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2bc9f672-7b2b-4493-a97d-07e4cd0666e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FE38F039B0>]}
[0m01:15:35.767987 [info ] [Thread-1 (]: 1 of 1 OK created sql table model raw_staging.customer ......................... [[32mCREATE TABLE (13.0 rows, 1.1 KiB processed)[0m in 4.21s]
[0m01:15:35.771909 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m01:15:35.776094 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:15:35.781331 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:15:35.782332 [debug] [MainThread]: Connection 'create_impression-digital_raw_staging' was properly closed.
[0m01:15:35.782332 [debug] [MainThread]: Connection 'list_impression-digital_raw_staging' was properly closed.
[0m01:15:35.785979 [debug] [MainThread]: Connection 'model.shopify.customer' was properly closed.
[0m01:15:35.785979 [info ] [MainThread]: 
[0m01:15:35.791273 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 9.80 seconds (9.80s).
[0m01:15:35.793981 [debug] [MainThread]: Command end result
[0m01:15:35.881882 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:15:35.887666 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:15:35.906489 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m01:15:35.907489 [info ] [MainThread]: 
[0m01:15:35.911329 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:15:35.913785 [info ] [MainThread]: 
[0m01:15:35.915786 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:15:35.920894 [debug] [MainThread]: Command `dbt run` succeeded at 01:15:35.920894 after 16.26 seconds
[0m01:15:35.924894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FE2DCB3980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FE38ACA690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FE2E5F9550>]}
[0m01:15:35.931076 [debug] [MainThread]: Flushing usage events
[0m01:15:36.390143 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:18:38.294935 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025CB77A1F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025CB776EF90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025CB776ED80>]}


============================== 01:18:38.296995 | 4bdcf201-b8dc-4cfd-a303-8034f1dc4cf1 ==============================
[0m01:18:38.296995 [info ] [MainThread]: Running with dbt=1.9.1
[0m01:18:38.304731 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select staging.customer', 'send_anonymous_usage_stats': 'True'}
[0m01:18:40.816108 [error] [MainThread]: Encountered an error:
Runtime Error
  Credentials in profile "shopify", target "dev" invalid: Runtime Error
    Must specify schema
[0m01:18:40.819660 [debug] [MainThread]: Command `dbt run` failed at 01:18:40.819660 after 2.86 seconds
[0m01:18:40.821182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025CC012D8E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025CC22F93A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025CC0D478F0>]}
[0m01:18:40.822184 [debug] [MainThread]: Flushing usage events
[0m01:18:41.227274 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:29:53.468895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018C6523C6B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018C653FCEC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018C68640C20>]}


============================== 01:29:53.475763 | 53d92a67-1941-4fe2-a2c5-9b98355c80e7 ==============================
[0m01:29:53.475763 [info ] [MainThread]: Running with dbt=1.9.1
[0m01:29:53.479443 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:29:56.399892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '53d92a67-1941-4fe2-a2c5-9b98355c80e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018C72916AB0>]}
[0m01:29:56.498969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '53d92a67-1941-4fe2-a2c5-9b98355c80e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018C711E68D0>]}
[0m01:29:56.505611 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:29:57.196870 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m01:29:57.435499 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m01:29:57.437288 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m01:29:57.439914 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '53d92a67-1941-4fe2-a2c5-9b98355c80e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018C685692B0>]}
[0m01:29:59.346080 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m01:29:59.352081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '53d92a67-1941-4fe2-a2c5-9b98355c80e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018C73217B00>]}
[0m01:29:59.493377 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:29:59.505289 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:29:59.586707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '53d92a67-1941-4fe2-a2c5-9b98355c80e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018C73216F00>]}
[0m01:29:59.590749 [info ] [MainThread]: Found 1 model, 490 macros
[0m01:29:59.593749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '53d92a67-1941-4fe2-a2c5-9b98355c80e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018C730ADBE0>]}
[0m01:29:59.600709 [info ] [MainThread]: 
[0m01:29:59.604937 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:29:59.608200 [info ] [MainThread]: 
[0m01:29:59.615216 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:29:59.621948 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m01:29:59.624341 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:30:00.061135 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_staging'
[0m01:30:00.063236 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:30:00.363291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '53d92a67-1941-4fe2-a2c5-9b98355c80e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018C72AAD430>]}
[0m01:30:00.363922 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:30:00.372896 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m01:30:00.374893 [info ] [Thread-1 (]: 1 of 1 START sql table model staging.customer .................................. [RUN]
[0m01:30:00.376609 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m01:30:00.378487 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m01:30:00.409977 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m01:30:00.412432 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m01:30:00.539461 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m01:30:00.542898 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,CONCAT(first_name, ' ', last_name) AS customer_name
  ,email
  ,phone
FROM impression-digital.raw.Customer

)

SELECT *
FROM raw_cust
    );
  
[0m01:30:00.543896 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m01:30:01.270084 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:13dcc926-410d-4354-906b-f2a939a8f85b&page=queryresults
[0m01:30:04.102315 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '53d92a67-1941-4fe2-a2c5-9b98355c80e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018C72B66F00>]}
[0m01:30:04.104315 [info ] [Thread-1 (]: 1 of 1 OK created sql table model staging.customer ............................. [[32mCREATE TABLE (13.0 rows, 1.1 KiB processed)[0m in 3.72s]
[0m01:30:04.107407 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m01:30:04.111686 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:30:04.118559 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:30:04.119748 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m01:30:04.121759 [debug] [MainThread]: Connection 'list_impression-digital_staging' was properly closed.
[0m01:30:04.123840 [debug] [MainThread]: Connection 'model.shopify.customer' was properly closed.
[0m01:30:04.125288 [info ] [MainThread]: 
[0m01:30:04.131173 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.51 seconds (4.51s).
[0m01:30:04.135474 [debug] [MainThread]: Command end result
[0m01:30:04.250396 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:30:04.258458 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:30:04.288375 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m01:30:04.289376 [info ] [MainThread]: 
[0m01:30:04.300961 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:30:04.342946 [info ] [MainThread]: 
[0m01:30:04.369974 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m01:30:04.375817 [debug] [MainThread]: Command `dbt run` succeeded at 01:30:04.375817 after 11.22 seconds
[0m01:30:04.379495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018C653A65A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018C7175F710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000018C6834F680>]}
[0m01:30:04.381720 [debug] [MainThread]: Flushing usage events
[0m01:30:04.786945 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:46:19.583372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A811427F20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A8113904D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A813D6D3A0>]}


============================== 21:46:19.591718 | e5ee71fd-a847-463b-870a-3fd7e3c52fe9 ==============================
[0m21:46:19.591718 [info ] [MainThread]: Running with dbt=1.9.1
[0m21:46:19.593685 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt debug', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:46:19.653425 [info ] [MainThread]: dbt version: 1.9.1
[0m21:46:19.655416 [info ] [MainThread]: python version: 3.12.4
[0m21:46:19.656484 [info ] [MainThread]: python path: C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\venv\Scripts\python.exe
[0m21:46:19.659418 [info ] [MainThread]: os info: Windows-10-10.0.19045-SP0
[0m21:46:22.498884 [info ] [MainThread]: Using profiles dir at C:\Users\amarh\.dbt
[0m21:46:22.499892 [info ] [MainThread]: Using profiles.yml file at C:\Users\amarh\.dbt\profiles.yml
[0m21:46:22.501862 [info ] [MainThread]: Using dbt_project.yml file at C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\dbt_project.yml
[0m21:46:22.503859 [info ] [MainThread]: adapter type: bigquery
[0m21:46:22.505239 [info ] [MainThread]: adapter version: 1.9.0
[0m21:46:22.744861 [info ] [MainThread]: Configuration:
[0m21:46:22.746860 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m21:46:22.747927 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m21:46:22.749864 [info ] [MainThread]: Required dependencies:
[0m21:46:22.751856 [debug] [MainThread]: Executing "git --help"
[0m21:46:22.831857 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone      Clone a repository into a new directory\n   init       Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add        Add file contents to the index\n   mv         Move or rename a file, a directory, or a symlink\n   restore    Restore working tree files\n   rm         Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect     Use binary search to find the commit that introduced a bug\n   diff       Show changes between commits, commit and working tree, etc\n   grep       Print lines matching a pattern\n   log        Show commit logs\n   show       Show various types of objects\n   status     Show the working tree status\n\ngrow, mark and tweak your common history\n   backfill   Download missing objects in a partial clone\n   branch     List, create, or delete branches\n   commit     Record changes to the repository\n   merge      Join two or more development histories together\n   rebase     Reapply commits on top of another base tip\n   reset      Reset current HEAD to the specified state\n   switch     Switch branches\n   tag        Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch      Download objects and refs from another repository\n   pull       Fetch from and integrate with another repository or a local branch\n   push       Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m21:46:22.832866 [debug] [MainThread]: STDERR: "b''"
[0m21:46:22.833860 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m21:46:22.835859 [info ] [MainThread]: Connection:
[0m21:46:22.837860 [info ] [MainThread]:   method: service-account
[0m21:46:22.839862 [info ] [MainThread]:   database: impression-digital
[0m21:46:22.841859 [info ] [MainThread]:   execution_project: impression-digital
[0m21:46:22.844863 [info ] [MainThread]:   schema: staging
[0m21:46:22.847015 [info ] [MainThread]:   location: EU
[0m21:46:22.848857 [info ] [MainThread]:   priority: interactive
[0m21:46:22.851860 [info ] [MainThread]:   maximum_bytes_billed: None
[0m21:46:22.855008 [info ] [MainThread]:   impersonate_service_account: None
[0m21:46:22.858991 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m21:46:22.861976 [info ] [MainThread]:   job_retries: 1
[0m21:46:22.863965 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m21:46:22.867857 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m21:46:22.869859 [info ] [MainThread]:   timeout_seconds: 300
[0m21:46:22.872860 [info ] [MainThread]:   client_id: None
[0m21:46:22.876862 [info ] [MainThread]:   token_uri: None
[0m21:46:22.883903 [info ] [MainThread]:   dataproc_region: None
[0m21:46:22.886861 [info ] [MainThread]:   dataproc_cluster_name: None
[0m21:46:22.889861 [info ] [MainThread]:   gcs_bucket: None
[0m21:46:22.893318 [info ] [MainThread]:   dataproc_batch: None
[0m21:46:22.896858 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m21:46:23.710562 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m21:46:23.710562 [debug] [MainThread]: On debug: select 1 as id
[0m21:46:23.712563 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:46:24.286200 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:f3d4bf74-f97c-4622-86cf-1e0feb411f33&page=queryresults
[0m21:46:24.806423 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m21:46:24.811470 [info ] [MainThread]: [32mAll checks passed![0m
[0m21:46:24.825422 [debug] [MainThread]: Command `dbt debug` succeeded at 21:46:24.824424 after 5.48 seconds
[0m21:46:24.829422 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m21:46:24.834428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A813D6CC50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A81366A6F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001A81E53A5A0>]}
[0m21:46:24.841430 [debug] [MainThread]: Flushing usage events
[0m21:46:25.274361 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:46:49.372206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002686D100170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002686D1011F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002686D1019D0>]}


============================== 21:46:49.380205 | 67a0e8c9-77b4-4cc8-a618-34c028c880bd ==============================
[0m21:46:49.380205 [info ] [MainThread]: Running with dbt=1.9.1
[0m21:46:49.383207 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:46:52.407398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '67a0e8c9-77b4-4cc8-a618-34c028c880bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026876F57860>]}
[0m21:46:52.507396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '67a0e8c9-77b4-4cc8-a618-34c028c880bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002686CC82180>]}
[0m21:46:52.509498 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m21:46:53.322863 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m21:46:56.428963 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:46:56.429999 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:46:56.441971 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m21:46:56.509563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '67a0e8c9-77b4-4cc8-a618-34c028c880bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268774BC620>]}
[0m21:46:56.627564 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m21:46:56.686564 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m21:46:56.761563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '67a0e8c9-77b4-4cc8-a618-34c028c880bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268776AE7E0>]}
[0m21:46:56.763566 [info ] [MainThread]: Found 1 model, 490 macros
[0m21:46:56.766562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '67a0e8c9-77b4-4cc8-a618-34c028c880bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000268774E3470>]}
[0m21:46:56.773109 [info ] [MainThread]: 
[0m21:46:56.775108 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:46:56.777108 [info ] [MainThread]: 
[0m21:46:56.780210 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:46:56.788106 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m21:46:56.793110 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:46:57.274719 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_staging'
[0m21:46:57.276727 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:46:57.576745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '67a0e8c9-77b4-4cc8-a618-34c028c880bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026876F3A3C0>]}
[0m21:46:57.578160 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:46:57.586745 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m21:46:57.588844 [info ] [Thread-1 (]: 1 of 1 START sql table model staging.customer .................................. [RUN]
[0m21:46:57.592396 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m21:46:57.593982 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m21:46:57.631749 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m21:46:57.637748 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m21:46:57.695673 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m21:46:58.160579 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m21:46:58.163580 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,CONCAT(first_name, ' ', last_name) AS customer_name
  ,email
  ,phone
FROM impression-digital.raw.Customer

)

SELECT *
FROM raw_cust
    );
  
[0m21:46:58.502879 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:2318a10f-9c32-47c8-af0b-c922296504fa&page=queryresults
[0m21:47:01.148693 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '67a0e8c9-77b4-4cc8-a618-34c028c880bd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026877F71B50>]}
[0m21:47:01.155712 [info ] [Thread-1 (]: 1 of 1 OK created sql table model staging.customer ............................. [[32mCREATE TABLE (13.0 rows, 1.1 KiB processed)[0m in 3.55s]
[0m21:47:01.168616 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m21:47:01.175449 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:47:01.181507 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:47:01.183506 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m21:47:01.185436 [debug] [MainThread]: Connection 'list_impression-digital_staging' was properly closed.
[0m21:47:01.187895 [debug] [MainThread]: Connection 'model.shopify.customer' was properly closed.
[0m21:47:01.189998 [info ] [MainThread]: 
[0m21:47:01.213819 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.41 seconds (4.41s).
[0m21:47:01.225987 [debug] [MainThread]: Command end result
[0m21:47:01.441012 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m21:47:01.447648 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m21:47:01.500092 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m21:47:01.501076 [info ] [MainThread]: 
[0m21:47:01.508292 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:47:01.525057 [info ] [MainThread]: 
[0m21:47:01.548403 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:47:01.562388 [debug] [MainThread]: Command `dbt run` succeeded at 21:47:01.561071 after 12.52 seconds
[0m21:47:01.566249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002686A73B230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026866F04230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002686CA72000>]}
[0m21:47:01.575311 [debug] [MainThread]: Flushing usage events
[0m21:47:02.117141 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:47:49.401057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ADFF5D2270>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD82041460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ADFF4F4410>]}


============================== 21:47:49.409672 | bc320819-2a7d-42a5-8734-c3b697476f16 ==============================
[0m21:47:49.409672 [info ] [MainThread]: Running with dbt=1.9.1
[0m21:47:49.411412 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:47:52.486226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bc320819-2a7d-42a5-8734-c3b697476f16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD8C58F230>]}
[0m21:47:52.588228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bc320819-2a7d-42a5-8734-c3b697476f16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD8C61AF00>]}
[0m21:47:52.590227 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m21:47:53.365763 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m21:47:53.645767 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:47:53.646769 [debug] [MainThread]: Partial parsing: updated file: shopify://models\staging\customer.sql
[0m21:47:54.193454 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m21:47:54.211133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bc320819-2a7d-42a5-8734-c3b697476f16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD8C8EC4D0>]}
[0m21:47:54.388408 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m21:47:54.399340 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m21:47:54.475778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bc320819-2a7d-42a5-8734-c3b697476f16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD8CC0D0A0>]}
[0m21:47:54.477775 [info ] [MainThread]: Found 1 model, 490 macros
[0m21:47:54.479775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bc320819-2a7d-42a5-8734-c3b697476f16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD8C6F5A60>]}
[0m21:47:54.486779 [info ] [MainThread]: 
[0m21:47:54.488778 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:47:54.490778 [info ] [MainThread]: 
[0m21:47:54.493778 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:47:54.496775 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m21:47:54.503780 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:47:54.993745 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_staging'
[0m21:47:54.996888 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:47:55.433864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bc320819-2a7d-42a5-8734-c3b697476f16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD8C5FA930>]}
[0m21:47:55.435827 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:47:55.463201 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m21:47:55.464717 [info ] [Thread-1 (]: 1 of 1 START sql table model staging.customer .................................. [RUN]
[0m21:47:55.467732 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m21:47:55.469735 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m21:47:55.500749 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m21:47:55.522832 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m21:47:55.585614 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m21:47:55.930583 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m21:47:55.933581 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,email
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,first_name
  ,last_name
  ,CAST(orders_count AS INT64) AS orders_count
  ,state
  ,CAST(total_spent AS FLOAT64) AS total_spent
  ,CASE WHEN last_order_id = 'nan' THEN NULL ELSE CAST(last_order_id AS STRING) END AS last_order_id
  ,CASE WHEN note = 'None' THEN NULL ELSE note END AS note
  ,CAST(verified_email AS BOOL) AS verified_email
  ,multipass_identifier
  ,CAST(tax_exempt AS BOOL) AS tax_exempt
  ,tags
  ,CASE WHEN last_order_name = 'None' THEN NULL ELSE last_order_name END AS last_order_name
  ,currency
  ,phone
  ,STRUCT(addresses) AS addresses
  ,tax_exemptions
  ,STRUCT(email_marketing_consent) AS email_marketing_consent
  ,STRUCT(sms_marketing_consent) AS email_marketing_consent
  ,admin_graphql_api_id
  ,CASE WHEN default_address = 'nan' THEN NULL ELSE STRUCT(default_address) END AS default_address
FROM
  impression-digital.raw.Customer

)

SELECT *
FROM raw_cust
    );
  
[0m21:47:56.360834 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:60b16673-0550-48a5-ada6-c068e9eb7ae2&page=queryresults
[0m21:47:56.484830 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:60b16673-0550-48a5-ada6-c068e9eb7ae2&page=queryresults
[0m21:47:57.055418 [debug] [Thread-1 (]: Database Error in model customer (models\staging\customer.sql)
  CREATE TABLE has columns with duplicate name email_marketing_consent at [15:1]
  compiled code at target\run\shopify\models\staging\customer.sql
[0m21:47:57.064467 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc320819-2a7d-42a5-8734-c3b697476f16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD8CA056A0>]}
[0m21:47:57.068468 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model staging.customer ......................... [[31mERROR[0m in 1.59s]
[0m21:47:57.106542 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m21:47:57.108829 [debug] [Thread-4 (]: Marking all children of 'model.shopify.customer' to be skipped because of status 'error'.  Reason: Database Error in model customer (models\staging\customer.sql)
  CREATE TABLE has columns with duplicate name email_marketing_consent at [15:1]
  compiled code at target\run\shopify\models\staging\customer.sql.
[0m21:47:57.114539 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:47:57.119692 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:47:57.121694 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m21:47:57.122699 [debug] [MainThread]: Connection 'list_impression-digital_staging' was properly closed.
[0m21:47:57.124691 [debug] [MainThread]: Connection 'model.shopify.customer' was properly closed.
[0m21:47:57.126693 [info ] [MainThread]: 
[0m21:47:57.147746 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.63 seconds (2.63s).
[0m21:47:57.152576 [debug] [MainThread]: Command end result
[0m21:47:57.463413 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m21:47:57.473700 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m21:47:57.496743 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m21:47:57.498745 [info ] [MainThread]: 
[0m21:47:57.509595 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m21:47:57.513880 [info ] [MainThread]: 
[0m21:47:57.525918 [error] [MainThread]:   Database Error in model customer (models\staging\customer.sql)
  CREATE TABLE has columns with duplicate name email_marketing_consent at [15:1]
  compiled code at target\run\shopify\models\staging\customer.sql
[0m21:47:57.535364 [info ] [MainThread]: 
[0m21:47:57.543100 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m21:47:57.554167 [debug] [MainThread]: Command `dbt run` failed at 21:47:57.554129 after 8.43 seconds
[0m21:47:57.560342 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD8CB742F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001AD81C9C1A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001ADFF8442F0>]}
[0m21:47:57.563177 [debug] [MainThread]: Flushing usage events
[0m21:47:57.953965 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:48:37.182402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002106190E9C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021061056120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002106190EF00>]}


============================== 21:48:37.189549 | 03411bd2-ea96-4554-8271-8cc13c7b4b36 ==============================
[0m21:48:37.189549 [info ] [MainThread]: Running with dbt=1.9.1
[0m21:48:37.193366 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:48:40.144915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '03411bd2-ea96-4554-8271-8cc13c7b4b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002106190C320>]}
[0m21:48:40.249904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '03411bd2-ea96-4554-8271-8cc13c7b4b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000210610544A0>]}
[0m21:48:40.255528 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m21:48:41.114850 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m21:48:41.506936 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:48:41.506936 [debug] [MainThread]: Partial parsing: updated file: shopify://models\staging\customer.sql
[0m21:48:41.922278 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m21:48:41.931732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '03411bd2-ea96-4554-8271-8cc13c7b4b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002106C2477D0>]}
[0m21:48:42.091829 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m21:48:42.106017 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m21:48:42.190237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '03411bd2-ea96-4554-8271-8cc13c7b4b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002106C224FE0>]}
[0m21:48:42.192966 [info ] [MainThread]: Found 1 model, 490 macros
[0m21:48:42.195805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '03411bd2-ea96-4554-8271-8cc13c7b4b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000210696EE390>]}
[0m21:48:42.204672 [info ] [MainThread]: 
[0m21:48:42.205672 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:48:42.205672 [info ] [MainThread]: 
[0m21:48:42.214757 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:48:42.222424 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m21:48:42.223826 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:48:42.615824 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_staging'
[0m21:48:42.616925 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:48:42.883331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '03411bd2-ea96-4554-8271-8cc13c7b4b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002106BEFF8C0>]}
[0m21:48:42.884332 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:48:42.895554 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m21:48:42.897608 [info ] [Thread-1 (]: 1 of 1 START sql table model staging.customer .................................. [RUN]
[0m21:48:42.901029 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m21:48:42.903030 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m21:48:42.925252 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m21:48:42.934265 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m21:48:42.985437 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m21:48:43.358700 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m21:48:43.367217 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,email
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,first_name
  ,last_name
  ,CAST(orders_count AS INT64) AS orders_count
  ,state
  ,CAST(total_spent AS FLOAT64) AS total_spent
  ,CASE WHEN last_order_id = 'nan' THEN NULL ELSE CAST(last_order_id AS STRING) END AS last_order_id
  ,CASE WHEN note = 'None' THEN NULL ELSE note END AS note
  ,CAST(verified_email AS BOOL) AS verified_email
  ,multipass_identifier
  ,CAST(tax_exempt AS BOOL) AS tax_exempt
  ,tags
  ,CASE WHEN last_order_name = 'None' THEN NULL ELSE last_order_name END AS last_order_name
  ,currency
  ,phone
  ,STRUCT(addresses) AS addresses
  ,tax_exemptions
  ,STRUCT(email_marketing_consent) AS email_marketing_consent
  ,STRUCT(sms_marketing_consent) AS sms_marketing_consent
  ,admin_graphql_api_id
  ,CASE WHEN default_address = 'nan' THEN NULL ELSE STRUCT(default_address) END AS default_address
FROM
  impression-digital.raw.Customer

)

SELECT *
FROM raw_cust
    );
  
[0m21:48:43.833309 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:9c0b228c-8e7d-4ecc-b672-f5d98e4fb133&page=queryresults
[0m21:48:46.970705 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '03411bd2-ea96-4554-8271-8cc13c7b4b36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002106BA9CAD0>]}
[0m21:48:46.971903 [info ] [Thread-1 (]: 1 of 1 OK created sql table model staging.customer ............................. [[32mCREATE TABLE (13.0 rows, 15.2 KiB processed)[0m in 4.06s]
[0m21:48:46.976175 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m21:48:46.980260 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:48:46.984505 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:48:46.984505 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m21:48:46.984505 [debug] [MainThread]: Connection 'list_impression-digital_staging' was properly closed.
[0m21:48:46.993052 [debug] [MainThread]: Connection 'model.shopify.customer' was properly closed.
[0m21:48:46.995045 [info ] [MainThread]: 
[0m21:48:46.998340 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.78 seconds (4.78s).
[0m21:48:47.002191 [debug] [MainThread]: Command end result
[0m21:48:47.204445 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m21:48:47.207828 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m21:48:47.229999 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m21:48:47.231453 [info ] [MainThread]: 
[0m21:48:47.233497 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:48:47.234619 [info ] [MainThread]: 
[0m21:48:47.236620 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:48:47.241018 [debug] [MainThread]: Command `dbt run` succeeded at 21:48:47.240015 after 10.31 seconds
[0m21:48:47.241992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021061056120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002106C0CB2C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002106C0C9CA0>]}
[0m21:48:47.244904 [debug] [MainThread]: Flushing usage events
[0m21:48:47.634256 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:41:16.482439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FBFC4E02F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FBFC4E03E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FBFC4E0200>]}


============================== 22:41:16.494021 | c5f7ce14-a154-423e-bbb2-7152d44b7b4c ==============================
[0m22:41:16.494021 [info ] [MainThread]: Running with dbt=1.9.1
[0m22:41:16.496092 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m22:41:20.312968 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c5f7ce14-a154-423e-bbb2-7152d44b7b4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB8429DBB0>]}
[0m22:41:20.471741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c5f7ce14-a154-423e-bbb2-7152d44b7b4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB85261B80>]}
[0m22:41:20.474304 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m22:41:21.301207 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m22:41:21.708060 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:41:21.708060 [debug] [MainThread]: Partial parsing: updated file: shopify://models\staging\customer.sql
[0m22:41:22.153045 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m22:41:22.167781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c5f7ce14-a154-423e-bbb2-7152d44b7b4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB86DF3770>]}
[0m22:41:22.329695 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m22:41:22.343269 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m22:41:22.429691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c5f7ce14-a154-423e-bbb2-7152d44b7b4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB86DD5130>]}
[0m22:41:22.430819 [info ] [MainThread]: Found 1 model, 490 macros
[0m22:41:22.433108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c5f7ce14-a154-423e-bbb2-7152d44b7b4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB863D03E0>]}
[0m22:41:22.435217 [info ] [MainThread]: 
[0m22:41:22.443864 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:41:22.445863 [info ] [MainThread]: 
[0m22:41:22.457045 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:41:22.460345 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m22:41:22.460345 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:41:22.997618 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_staging'
[0m22:41:23.001231 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:41:23.394025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c5f7ce14-a154-423e-bbb2-7152d44b7b4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB851F1FD0>]}
[0m22:41:23.395018 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:41:23.412887 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m22:41:23.413894 [info ] [Thread-1 (]: 1 of 1 START sql table model staging.customer .................................. [RUN]
[0m22:41:23.421888 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m22:41:23.423898 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m22:41:23.457765 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m22:41:23.464735 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m22:41:23.506391 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m22:41:23.949645 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m22:41:23.953746 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,email
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,first_name
  ,last_name
  ,CAST(orders_count AS INT64) AS orders_count
  ,state
  ,CAST(total_spent AS FLOAT64) AS total_spent
  ,CAST(last_order_id AS STRING) AS last_order_id
  ,note
  ,CAST(verified_email AS BOOL) AS verified_email
  ,multipass_identifier
  ,CAST(tax_exempt AS BOOL) AS tax_exempt
  ,tags
  ,last_order_name
  ,currency
  ,phone
  ,addresses
  ,tax_exemptions
  ,email_marketing_consent
  ,sms_marketing_consent
  ,admin_graphql_api_id
  ,default_address
FROM
  impression-digital.raw.Customer
)

SELECT *
FROM raw_cust
    );
  
[0m22:41:24.738490 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:50146381-d3b6-4c3b-95e9-7b105c12abdb&page=queryresults
[0m22:41:27.531061 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5f7ce14-a154-423e-bbb2-7152d44b7b4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB8664C740>]}
[0m22:41:27.532060 [info ] [Thread-1 (]: 1 of 1 OK created sql table model staging.customer ............................. [[32mCREATE TABLE (13.0 rows, 6.9 KiB processed)[0m in 4.10s]
[0m22:41:27.534784 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m22:41:27.538191 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:41:27.544030 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:41:27.545030 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m22:41:27.545030 [debug] [MainThread]: Connection 'list_impression-digital_staging' was properly closed.
[0m22:41:27.550890 [debug] [MainThread]: Connection 'model.shopify.customer' was properly closed.
[0m22:41:27.551892 [info ] [MainThread]: 
[0m22:41:27.558028 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 5.10 seconds (5.10s).
[0m22:41:27.561040 [debug] [MainThread]: Command end result
[0m22:41:27.755067 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m22:41:27.763261 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m22:41:27.782791 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m22:41:27.784079 [info ] [MainThread]: 
[0m22:41:27.786266 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:41:27.789272 [info ] [MainThread]: 
[0m22:41:27.791496 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m22:41:27.796526 [debug] [MainThread]: Command `dbt run` succeeded at 22:41:27.796526 after 11.64 seconds
[0m22:41:27.804077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FBFC4BFBC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FBFC4BF9E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FBFC4BFD70>]}
[0m22:41:27.806078 [debug] [MainThread]: Flushing usage events
[0m22:41:28.291569 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:30:30.185293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002351EC57D70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002351EA71D30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002351E4DC260>]}


============================== 22:30:30.194356 | 176d04c1-b4ea-4782-ab5d-f74f987456c1 ==============================
[0m22:30:30.194356 [info ] [MainThread]: Running with dbt=1.9.1
[0m22:30:30.199093 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m22:30:30.297981 [info ] [MainThread]: dbt version: 1.9.1
[0m22:30:30.300671 [info ] [MainThread]: python version: 3.12.4
[0m22:30:30.303915 [info ] [MainThread]: python path: C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\venv\Scripts\python.exe
[0m22:30:30.307980 [info ] [MainThread]: os info: Windows-10-10.0.19045-SP0
[0m22:30:35.754905 [info ] [MainThread]: Using profiles dir at C:\Users\amarh\.dbt
[0m22:30:35.757945 [info ] [MainThread]: Using profiles.yml file at C:\Users\amarh\.dbt\profiles.yml
[0m22:30:35.759417 [info ] [MainThread]: Using dbt_project.yml file at C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\dbt_project.yml
[0m22:30:35.761769 [info ] [MainThread]: adapter type: bigquery
[0m22:30:35.763852 [info ] [MainThread]: adapter version: 1.9.0
[0m22:30:36.026103 [info ] [MainThread]: Configuration:
[0m22:30:36.032079 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m22:30:36.041054 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m22:30:36.057304 [info ] [MainThread]: Required dependencies:
[0m22:30:36.083304 [debug] [MainThread]: Executing "git --help"
[0m22:30:36.198809 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone      Clone a repository into a new directory\n   init       Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add        Add file contents to the index\n   mv         Move or rename a file, a directory, or a symlink\n   restore    Restore working tree files\n   rm         Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect     Use binary search to find the commit that introduced a bug\n   diff       Show changes between commits, commit and working tree, etc\n   grep       Print lines matching a pattern\n   log        Show commit logs\n   show       Show various types of objects\n   status     Show the working tree status\n\ngrow, mark and tweak your common history\n   backfill   Download missing objects in a partial clone\n   branch     List, create, or delete branches\n   commit     Record changes to the repository\n   merge      Join two or more development histories together\n   rebase     Reapply commits on top of another base tip\n   reset      Reset current HEAD to the specified state\n   switch     Switch branches\n   tag        Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch      Download objects and refs from another repository\n   pull       Fetch from and integrate with another repository or a local branch\n   push       Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:30:36.199811 [debug] [MainThread]: STDERR: "b''"
[0m22:30:36.202623 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:30:36.204653 [info ] [MainThread]: Connection:
[0m22:30:36.206657 [info ] [MainThread]:   method: service-account
[0m22:30:36.208828 [info ] [MainThread]:   database: impression-digital
[0m22:30:36.212174 [info ] [MainThread]:   execution_project: impression-digital
[0m22:30:36.215339 [info ] [MainThread]:   schema: staging
[0m22:30:36.229015 [info ] [MainThread]:   location: EU
[0m22:30:36.241620 [info ] [MainThread]:   priority: interactive
[0m22:30:36.245729 [info ] [MainThread]:   maximum_bytes_billed: None
[0m22:30:36.249725 [info ] [MainThread]:   impersonate_service_account: None
[0m22:30:36.258188 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m22:30:36.263391 [info ] [MainThread]:   job_retries: 1
[0m22:30:36.265722 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m22:30:36.267724 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m22:30:36.271298 [info ] [MainThread]:   timeout_seconds: 300
[0m22:30:36.278316 [info ] [MainThread]:   client_id: None
[0m22:30:36.281580 [info ] [MainThread]:   token_uri: None
[0m22:30:36.284881 [info ] [MainThread]:   dataproc_region: None
[0m22:30:36.292018 [info ] [MainThread]:   dataproc_cluster_name: None
[0m22:30:36.295016 [info ] [MainThread]:   gcs_bucket: None
[0m22:30:36.298029 [info ] [MainThread]:   dataproc_batch: None
[0m22:30:36.300827 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m22:30:37.425991 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m22:30:37.434023 [debug] [MainThread]: On debug: select 1 as id
[0m22:30:37.434023 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:30:38.197661 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:1709eed6-5a76-44f3-937d-a4ed562ef32a&page=queryresults
[0m22:30:43.941536 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m22:30:43.949125 [info ] [MainThread]: [32mAll checks passed![0m
[0m22:30:43.968475 [debug] [MainThread]: Command `dbt debug` succeeded at 22:30:43.968475 after 14.14 seconds
[0m22:30:43.985836 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m22:30:44.008865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002351E9F8E60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002351EC57950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002351EC57F20>]}
[0m22:30:44.012448 [debug] [MainThread]: Flushing usage events
[0m22:30:44.484674 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:30:53.996200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022DB4C83E90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022DB4C83C80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022DB4C82DB0>]}


============================== 22:30:54.002592 | 0c0dbc36-57fd-4045-81e6-b7271b354153 ==============================
[0m22:30:54.002592 [info ] [MainThread]: Running with dbt=1.9.1
[0m22:30:54.006930 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'debug': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m22:30:57.301284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0c0dbc36-57fd-4045-81e6-b7271b354153', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022DBEF5BE00>]}
[0m22:30:57.404441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0c0dbc36-57fd-4045-81e6-b7271b354153', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022DBEF85E50>]}
[0m22:30:57.410951 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m22:30:58.333066 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m22:31:01.243085 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m22:31:01.243085 [debug] [MainThread]: Partial parsing: added file: shopify://models\staging\order.sql
[0m22:31:01.247696 [debug] [MainThread]: Partial parsing: updated file: shopify://models\staging\customer.sql
[0m22:31:01.734281 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m22:31:01.740106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0c0dbc36-57fd-4045-81e6-b7271b354153', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022DBF8AB1A0>]}
[0m22:31:01.891534 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m22:31:01.966598 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m22:31:02.039963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0c0dbc36-57fd-4045-81e6-b7271b354153', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022DBFA01370>]}
[0m22:31:02.042291 [info ] [MainThread]: Found 2 models, 490 macros
[0m22:31:02.044896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0c0dbc36-57fd-4045-81e6-b7271b354153', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022DBF907E60>]}
[0m22:31:02.051141 [info ] [MainThread]: 
[0m22:31:02.054556 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:31:02.056911 [info ] [MainThread]: 
[0m22:31:02.062078 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:31:02.077967 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m22:31:02.079713 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:31:02.673057 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_staging'
[0m22:31:02.674685 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:31:02.947939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0c0dbc36-57fd-4045-81e6-b7271b354153', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022DBDF4FE00>]}
[0m22:31:02.949946 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:31:02.965767 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m22:31:02.967366 [info ] [Thread-1 (]: 1 of 2 START sql table model staging.customer .................................. [RUN]
[0m22:31:02.971502 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m22:31:02.973504 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m22:31:03.006979 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m22:31:03.014576 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m22:31:03.050541 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m22:31:03.784252 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m22:31:03.793822 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,email
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,first_name
  ,last_name
  ,CAST(orders_count AS INT64) AS orders_count
  ,state
  ,CAST(total_spent AS FLOAT64) AS total_spent
  ,CAST(last_order_id AS STRING) AS last_order_id
  ,note
  ,CAST(verified_email AS BOOL) AS verified_email
  ,multipass_identifier
  ,CAST(tax_exempt AS BOOL) AS tax_exempt
  ,tags
  ,last_order_name
  ,currency
  ,phone
  ,addresses
  ,tax_exemptions
  ,email_marketing_consent
  ,sms_marketing_consent
  ,admin_graphql_api_id
  ,default_address
FROM
  raw.Customer
)

SELECT *
FROM raw_cust
    );
  
[0m22:31:04.266014 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:76c995d1-8f43-4db2-a36b-0450fb857fb4&page=queryresults
[0m22:31:07.617971 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c0dbc36-57fd-4045-81e6-b7271b354153', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022DBDF1DAC0>]}
[0m22:31:07.618972 [info ] [Thread-1 (]: 1 of 2 OK created sql table model staging.customer ............................. [[32mCREATE TABLE (13.0 rows, 6.9 KiB processed)[0m in 4.64s]
[0m22:31:07.621973 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m22:31:07.622971 [debug] [Thread-1 (]: Began running node model.shopify.order
[0m22:31:07.625022 [info ] [Thread-1 (]: 2 of 2 START sql table model staging.order ..................................... [RUN]
[0m22:31:07.628295 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.customer, now model.shopify.order)
[0m22:31:07.630706 [debug] [Thread-1 (]: Began compiling node model.shopify.order
[0m22:31:07.764533 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.order"
[0m22:31:07.764533 [debug] [Thread-1 (]: Began executing node model.shopify.order
[0m22:31:07.776282 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.order"
[0m22:31:07.782903 [debug] [Thread-1 (]: On model.shopify.order: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.order"} */

  
    

    create or replace table `impression-digital`.`staging`.`order`
      
    
    

    OPTIONS()
    as (
      

WITH raw_order AS (

SELECT 
  od.order_number
  ,od.financial_status AS payment_status
  ,od.line_items
FROM
  raw.Order AS od
)

SELECT *
FROM raw_order
    );
  
[0m22:31:07.782903 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:31:08.345469 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:9d2fe790-55e5-4eeb-842e-d51b5f0e345d&page=queryresults
[0m22:31:11.392808 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c0dbc36-57fd-4045-81e6-b7271b354153', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022DBF9D04D0>]}
[0m22:31:11.397272 [info ] [Thread-1 (]: 2 of 2 OK created sql table model staging.order ................................ [[32mCREATE TABLE (30.0 rows, 15.2 KiB processed)[0m in 3.76s]
[0m22:31:11.401193 [debug] [Thread-1 (]: Finished running node model.shopify.order
[0m22:31:11.406187 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:31:11.411176 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:31:11.411176 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m22:31:11.416144 [debug] [MainThread]: Connection 'list_impression-digital_staging' was properly closed.
[0m22:31:11.417494 [debug] [MainThread]: Connection 'model.shopify.order' was properly closed.
[0m22:31:11.419494 [info ] [MainThread]: 
[0m22:31:11.422675 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 9.36 seconds (9.36s).
[0m22:31:11.428533 [debug] [MainThread]: Command end result
[0m22:31:11.573520 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m22:31:11.581808 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m22:31:11.608923 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m22:31:11.610924 [info ] [MainThread]: 
[0m22:31:11.613857 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:31:11.615857 [info ] [MainThread]: 
[0m22:31:11.620070 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m22:31:11.626847 [debug] [MainThread]: Command `dbt run` succeeded at 22:31:11.626847 after 17.88 seconds
[0m22:31:11.635509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022DBFA23DD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022DB459D9A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022DBF904590>]}
[0m22:31:11.639483 [debug] [MainThread]: Flushing usage events
[0m22:31:12.089662 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:38:38.535621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D0432179E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D045B08D10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D045B08D70>]}


============================== 22:38:38.542346 | 6c81c22a-a6e4-4ef5-8c2d-3049169b226a ==============================
[0m22:38:38.542346 [info ] [MainThread]: Running with dbt=1.9.1
[0m22:38:38.546290 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m22:38:41.497128 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6c81c22a-a6e4-4ef5-8c2d-3049169b226a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D046025E50>]}
[0m22:38:41.599508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6c81c22a-a6e4-4ef5-8c2d-3049169b226a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D04ECCADE0>]}
[0m22:38:41.609364 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m22:38:42.455950 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m22:38:42.757861 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m22:38:42.757861 [debug] [MainThread]: Partial parsing: added file: shopify://models\processed\processed_product_sales_agg.sql
[0m22:38:43.230842 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m22:38:43.237823 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6c81c22a-a6e4-4ef5-8c2d-3049169b226a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D0508C7F20>]}
[0m22:38:43.399121 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m22:38:43.410175 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m22:38:43.503959 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6c81c22a-a6e4-4ef5-8c2d-3049169b226a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D0505D8410>]}
[0m22:38:43.505262 [info ] [MainThread]: Found 3 models, 490 macros
[0m22:38:43.507980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6c81c22a-a6e4-4ef5-8c2d-3049169b226a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D0508C3D40>]}
[0m22:38:43.513381 [info ] [MainThread]: 
[0m22:38:43.513381 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:38:43.516450 [info ] [MainThread]: 
[0m22:38:43.518933 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:38:43.530100 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m22:38:43.535101 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:38:44.219130 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_staging'
[0m22:38:44.220352 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:38:44.491842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6c81c22a-a6e4-4ef5-8c2d-3049169b226a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D050226DB0>]}
[0m22:38:44.492875 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:38:44.505121 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m22:38:44.505121 [info ] [Thread-1 (]: 1 of 3 START sql table model staging.customer .................................. [RUN]
[0m22:38:44.509255 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m22:38:44.512094 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m22:38:44.545888 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m22:38:44.550161 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m22:38:44.587858 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m22:38:44.929387 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m22:38:44.929387 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,email
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,first_name
  ,last_name
  ,CAST(orders_count AS INT64) AS orders_count
  ,state
  ,CAST(total_spent AS FLOAT64) AS total_spent
  ,CAST(last_order_id AS STRING) AS last_order_id
  ,note
  ,CAST(verified_email AS BOOL) AS verified_email
  ,multipass_identifier
  ,CAST(tax_exempt AS BOOL) AS tax_exempt
  ,tags
  ,last_order_name
  ,currency
  ,phone
  ,addresses
  ,tax_exemptions
  ,email_marketing_consent
  ,sms_marketing_consent
  ,admin_graphql_api_id
  ,default_address
FROM
  raw.Customer
)

SELECT *
FROM raw_cust
    );
  
[0m22:38:45.427545 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:9c4b3a5d-473f-41cf-adf2-4ae4fed1d968&page=queryresults
[0m22:38:48.592623 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c81c22a-a6e4-4ef5-8c2d-3049169b226a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D050892B70>]}
[0m22:38:48.593626 [info ] [Thread-1 (]: 1 of 3 OK created sql table model staging.customer ............................. [[32mCREATE TABLE (13.0 rows, 6.9 KiB processed)[0m in 4.08s]
[0m22:38:48.596823 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m22:38:48.598863 [debug] [Thread-1 (]: Began running node model.shopify.order
[0m22:38:48.600862 [info ] [Thread-1 (]: 2 of 3 START sql table model staging.order ..................................... [RUN]
[0m22:38:48.605397 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.customer, now model.shopify.order)
[0m22:38:48.607576 [debug] [Thread-1 (]: Began compiling node model.shopify.order
[0m22:38:48.622092 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.order"
[0m22:38:48.624090 [debug] [Thread-1 (]: Began executing node model.shopify.order
[0m22:38:48.803773 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:38:49.108094 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.order"
[0m22:38:49.109613 [debug] [Thread-1 (]: On model.shopify.order: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.order"} */

  
    

    create or replace table `impression-digital`.`staging`.`order`
      
    
    

    OPTIONS()
    as (
      

WITH raw_order AS (

SELECT 
  od.order_number
  ,od.financial_status AS payment_status
  ,od.line_items
FROM
  raw.Order AS od
)

SELECT *
FROM raw_order
    );
  
[0m22:38:49.504233 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:edec8dc7-12ad-47f0-abb8-1541dc511044&page=queryresults
[0m22:38:52.147375 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c81c22a-a6e4-4ef5-8c2d-3049169b226a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D050FCDA00>]}
[0m22:38:52.148411 [info ] [Thread-1 (]: 2 of 3 OK created sql table model staging.order ................................ [[32mCREATE TABLE (30.0 rows, 15.2 KiB processed)[0m in 3.54s]
[0m22:38:52.160039 [debug] [Thread-1 (]: Finished running node model.shopify.order
[0m22:38:52.165517 [debug] [Thread-1 (]: Began running node model.shopify.processed_product_sales_agg
[0m22:38:52.172946 [info ] [Thread-1 (]: 3 of 3 START sql table model staging.processed_product_sales_agg ............... [RUN]
[0m22:38:52.181237 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.order, now model.shopify.processed_product_sales_agg)
[0m22:38:52.181237 [debug] [Thread-1 (]: Began compiling node model.shopify.processed_product_sales_agg
[0m22:38:52.213230 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.processed_product_sales_agg"
[0m22:38:52.219665 [debug] [Thread-1 (]: Began executing node model.shopify.processed_product_sales_agg
[0m22:38:52.236939 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.processed_product_sales_agg"
[0m22:38:52.240571 [debug] [Thread-1 (]: On model.shopify.processed_product_sales_agg: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.processed_product_sales_agg"} */

  
    

    create or replace table `impression-digital`.`staging`.`processed_product_sales_agg`
      
    
    

    OPTIONS()
    as (
      


WITH all_lines AS (

SELECT 
  od.order_number
  ,line.product_id AS line_product_id
  ,line.variant_id AS line_variant_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,IFNULL(CAST(discount.amount AS NUMERIC), 0) AS discount
  ,od.total_discounts
  ,od.financial_status AS payment_status
FROM
  staging.order AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
  raw.Product AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
LEFT JOIN
  UNNEST(line.discount_allocations) AS discount
WHERE od.financial_status IN ('paid') -- only counting sales from paid orders
)

-- same product within an order can have different discounts applied. Need to group down to variant level and sum discounts
,discount_summed AS(
  SELECT
    order_number
    ,line_product_id
    ,line_variant_id
    ,quantity
    ,SUM(discount) AS discount
  FROM all_lines
  GROUP BY order_number, line_product_id, line_variant_id, quantity
)

-- add the summed discount back to respective row in all_lines via a join
,subtotals AS(
SELECT DISTINCT
  d.order_number
  ,d.line_product_id
  ,d.line_variant_id
  ,l.price
  ,d.quantity
  ,d.discount
  ,(price*d.quantity) - d.discount AS subtotal
FROM discount_summed AS d
LEFT JOIN all_lines AS l
  ON 
    l.order_number = d.order_number AND
    l.line_product_id = d.line_product_id AND 
    l.line_variant_id = d.line_variant_id
)

,agg AS (

SELECT
  line_product_id AS product_id
  ,SUM(quantity) AS product_quantity
  ,SUM(subtotal) AS product_rev
FROM subtotals
GROUP BY line_product_id
)

SELECT * FROM agg
-- ORDER BY order_number
    );
  
[0m22:38:52.243369 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:38:52.666246 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:bd3697b6-209f-4411-bb49-ccf7ed844394&page=queryresults
[0m22:38:52.769124 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:bd3697b6-209f-4411-bb49-ccf7ed844394&page=queryresults
[0m22:38:53.125364 [debug] [Thread-1 (]: Database Error in model processed_product_sales_agg (models\processed\processed_product_sales_agg.sql)
  Name financial_status not found inside od at [39:10]
  compiled code at target\run\shopify\models\processed\processed_product_sales_agg.sql
[0m22:38:53.125364 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c81c22a-a6e4-4ef5-8c2d-3049169b226a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D0500CFB00>]}
[0m22:38:53.128982 [error] [Thread-1 (]: 3 of 3 ERROR creating sql table model staging.processed_product_sales_agg ...... [[31mERROR[0m in 0.94s]
[0m22:38:53.132051 [debug] [Thread-1 (]: Finished running node model.shopify.processed_product_sales_agg
[0m22:38:53.133855 [debug] [Thread-4 (]: Marking all children of 'model.shopify.processed_product_sales_agg' to be skipped because of status 'error'.  Reason: Database Error in model processed_product_sales_agg (models\processed\processed_product_sales_agg.sql)
  Name financial_status not found inside od at [39:10]
  compiled code at target\run\shopify\models\processed\processed_product_sales_agg.sql.
[0m22:38:53.139335 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:38:53.141987 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:38:53.141987 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m22:38:53.146759 [debug] [MainThread]: Connection 'list_impression-digital_staging' was properly closed.
[0m22:38:53.148818 [debug] [MainThread]: Connection 'model.shopify.processed_product_sales_agg' was properly closed.
[0m22:38:53.150818 [info ] [MainThread]: 
[0m22:38:53.153619 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 9.63 seconds (9.63s).
[0m22:38:53.161424 [debug] [MainThread]: Command end result
[0m22:38:53.311488 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m22:38:53.318129 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m22:38:53.339205 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m22:38:53.341223 [info ] [MainThread]: 
[0m22:38:53.372810 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:38:53.388211 [info ] [MainThread]: 
[0m22:38:53.401783 [error] [MainThread]:   Database Error in model processed_product_sales_agg (models\processed\processed_product_sales_agg.sql)
  Name financial_status not found inside od at [39:10]
  compiled code at target\run\shopify\models\processed\processed_product_sales_agg.sql
[0m22:38:53.408752 [info ] [MainThread]: 
[0m22:38:53.410756 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m22:38:53.420355 [debug] [MainThread]: Command `dbt run` failed at 22:38:53.419670 after 15.21 seconds
[0m22:38:53.421908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D045E30E30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D0508C5D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D045616180>]}
[0m22:38:53.424088 [debug] [MainThread]: Flushing usage events
[0m22:38:53.833090 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:40:28.508483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000276E9891280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000276E9891520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000276E9890800>]}


============================== 22:40:28.514877 | 08dfd8a0-d98e-4fb5-9881-254f0b98cb2b ==============================
[0m22:40:28.514877 [info ] [MainThread]: Running with dbt=1.9.1
[0m22:40:28.518426 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m22:40:31.560569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '08dfd8a0-d98e-4fb5-9881-254f0b98cb2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000276F3BAD6A0>]}
[0m22:40:31.715555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '08dfd8a0-d98e-4fb5-9881-254f0b98cb2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000276F36AB3B0>]}
[0m22:40:31.722039 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m22:40:32.495614 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m22:40:32.712631 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m22:40:32.714362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '08dfd8a0-d98e-4fb5-9881-254f0b98cb2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000276F3F45940>]}
[0m22:40:34.657085 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m22:40:34.667199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '08dfd8a0-d98e-4fb5-9881-254f0b98cb2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000276F408C8F0>]}
[0m22:40:34.822177 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m22:40:34.844158 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m22:40:34.953381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '08dfd8a0-d98e-4fb5-9881-254f0b98cb2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000276E75373E0>]}
[0m22:40:34.955801 [info ] [MainThread]: Found 3 models, 490 macros
[0m22:40:34.957971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '08dfd8a0-d98e-4fb5-9881-254f0b98cb2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000276E3A056D0>]}
[0m22:40:34.960417 [info ] [MainThread]: 
[0m22:40:34.967626 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:40:34.970633 [info ] [MainThread]: 
[0m22:40:34.977064 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:40:35.076943 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m22:40:35.078946 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:40:35.487931 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:40:35.850890 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_staging'
[0m22:40:35.850890 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:40:36.199159 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_impression-digital_staging, now list_impression-digital_processed)
[0m22:40:36.203249 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:40:36.513226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '08dfd8a0-d98e-4fb5-9881-254f0b98cb2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000276F3C3C200>]}
[0m22:40:36.518201 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:40:36.539171 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m22:40:36.539171 [info ] [Thread-1 (]: 1 of 3 START sql table model staging.customer .................................. [RUN]
[0m22:40:36.546053 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m22:40:36.549399 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m22:40:36.582781 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m22:40:36.587851 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m22:40:36.630788 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m22:40:37.052290 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m22:40:37.060283 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,email
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,first_name
  ,last_name
  ,CAST(orders_count AS INT64) AS orders_count
  ,state
  ,CAST(total_spent AS FLOAT64) AS total_spent
  ,CAST(last_order_id AS STRING) AS last_order_id
  ,note
  ,CAST(verified_email AS BOOL) AS verified_email
  ,multipass_identifier
  ,CAST(tax_exempt AS BOOL) AS tax_exempt
  ,tags
  ,last_order_name
  ,currency
  ,phone
  ,addresses
  ,tax_exemptions
  ,email_marketing_consent
  ,sms_marketing_consent
  ,admin_graphql_api_id
  ,default_address
FROM
  raw.Customer
)

SELECT *
FROM raw_cust
    );
  
[0m22:40:37.399561 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:16189390-d614-4dc9-a1d2-c8bc39c3b5b7&page=queryresults
[0m22:40:40.654546 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '08dfd8a0-d98e-4fb5-9881-254f0b98cb2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000276F39CC9E0>]}
[0m22:40:40.656547 [info ] [Thread-1 (]: 1 of 3 OK created sql table model staging.customer ............................. [[32mCREATE TABLE (13.0 rows, 6.9 KiB processed)[0m in 4.11s]
[0m22:40:40.658895 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m22:40:40.660920 [debug] [Thread-1 (]: Began running node model.shopify.order
[0m22:40:40.664102 [info ] [Thread-1 (]: 2 of 3 START sql table model staging.order ..................................... [RUN]
[0m22:40:40.669409 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.customer, now model.shopify.order)
[0m22:40:40.671147 [debug] [Thread-1 (]: Began compiling node model.shopify.order
[0m22:40:40.685490 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.order"
[0m22:40:40.686491 [debug] [Thread-1 (]: Began executing node model.shopify.order
[0m22:40:40.699558 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:40:41.067132 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.order"
[0m22:40:41.075129 [debug] [Thread-1 (]: On model.shopify.order: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.order"} */

  
    

    create or replace table `impression-digital`.`staging`.`order`
      
    
    

    OPTIONS()
    as (
      

WITH raw_order AS (

SELECT 
  od.order_number
  ,od.financial_status
  ,od.line_items
FROM
  raw.Order AS od
)

SELECT *
FROM raw_order
    );
  
[0m22:40:41.308243 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:5a984bef-1f04-4624-a180-a80af4901667&page=queryresults
[0m22:40:44.518077 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '08dfd8a0-d98e-4fb5-9881-254f0b98cb2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000276F4818080>]}
[0m22:40:44.526077 [info ] [Thread-1 (]: 2 of 3 OK created sql table model staging.order ................................ [[32mCREATE TABLE (30.0 rows, 15.2 KiB processed)[0m in 3.85s]
[0m22:40:44.540502 [debug] [Thread-1 (]: Finished running node model.shopify.order
[0m22:40:44.543747 [debug] [Thread-1 (]: Began running node model.shopify.processed_product_sales_agg
[0m22:40:44.547876 [info ] [Thread-1 (]: 3 of 3 START sql table model processed.processed_product_sales_agg ............. [RUN]
[0m22:40:44.555037 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.order, now model.shopify.processed_product_sales_agg)
[0m22:40:44.560519 [debug] [Thread-1 (]: Began compiling node model.shopify.processed_product_sales_agg
[0m22:40:44.577436 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.processed_product_sales_agg"
[0m22:40:44.582154 [debug] [Thread-1 (]: Began executing node model.shopify.processed_product_sales_agg
[0m22:40:44.597830 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.processed_product_sales_agg"
[0m22:40:44.601510 [debug] [Thread-1 (]: On model.shopify.processed_product_sales_agg: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.processed_product_sales_agg"} */

  
    

    create or replace table `impression-digital`.`processed`.`processed_product_sales_agg`
      
    
    

    OPTIONS()
    as (
      


WITH all_lines AS (

SELECT 
  od.order_number
  ,line.product_id AS line_product_id
  ,line.variant_id AS line_variant_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,IFNULL(CAST(discount.amount AS NUMERIC), 0) AS discount
  ,od.total_discounts
  ,od.financial_status AS payment_status
FROM
  staging.order AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
  raw.Product AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
LEFT JOIN
  UNNEST(line.discount_allocations) AS discount
WHERE od.financial_status IN ('paid') -- only counting sales from paid orders
)

-- same product within an order can have different discounts applied. Need to group down to variant level and sum discounts
,discount_summed AS(
  SELECT
    order_number
    ,line_product_id
    ,line_variant_id
    ,quantity
    ,SUM(discount) AS discount
  FROM all_lines
  GROUP BY order_number, line_product_id, line_variant_id, quantity
)

-- add the summed discount back to respective row in all_lines via a join
,subtotals AS(
SELECT DISTINCT
  d.order_number
  ,d.line_product_id
  ,d.line_variant_id
  ,l.price
  ,d.quantity
  ,d.discount
  ,(price*d.quantity) - d.discount AS subtotal
FROM discount_summed AS d
LEFT JOIN all_lines AS l
  ON 
    l.order_number = d.order_number AND
    l.line_product_id = d.line_product_id AND 
    l.line_variant_id = d.line_variant_id
)

,agg AS (

SELECT
  line_product_id AS product_id
  ,SUM(quantity) AS product_quantity
  ,SUM(subtotal) AS product_rev
FROM subtotals
GROUP BY line_product_id
)

SELECT * FROM agg
-- ORDER BY order_number
    );
  
[0m22:40:44.605391 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:40:45.104266 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:9b929e42-29da-46ff-9ccb-8acef1de0a83&page=queryresults
[0m22:40:45.181096 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:9b929e42-29da-46ff-9ccb-8acef1de0a83&page=queryresults
[0m22:40:45.196202 [debug] [Thread-1 (]: Database Error in model processed_product_sales_agg (models\processed\processed_product_sales_agg.sql)
  Name total_discounts not found inside od at [25:7]
  compiled code at target\run\shopify\models\processed\processed_product_sales_agg.sql
[0m22:40:45.196202 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '08dfd8a0-d98e-4fb5-9881-254f0b98cb2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000276F4890D40>]}
[0m22:40:45.196202 [error] [Thread-1 (]: 3 of 3 ERROR creating sql table model processed.processed_product_sales_agg .... [[31mERROR[0m in 0.64s]
[0m22:40:45.205749 [debug] [Thread-1 (]: Finished running node model.shopify.processed_product_sales_agg
[0m22:40:45.207782 [debug] [Thread-4 (]: Marking all children of 'model.shopify.processed_product_sales_agg' to be skipped because of status 'error'.  Reason: Database Error in model processed_product_sales_agg (models\processed\processed_product_sales_agg.sql)
  Name total_discounts not found inside od at [25:7]
  compiled code at target\run\shopify\models\processed\processed_product_sales_agg.sql.
[0m22:40:45.213250 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:40:45.217281 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:40:45.217281 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m22:40:45.217281 [debug] [MainThread]: Connection 'list_impression-digital_processed' was properly closed.
[0m22:40:45.220286 [debug] [MainThread]: Connection 'model.shopify.processed_product_sales_agg' was properly closed.
[0m22:40:45.222640 [info ] [MainThread]: 
[0m22:40:45.223770 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 10.25 seconds (10.25s).
[0m22:40:45.230573 [debug] [MainThread]: Command end result
[0m22:40:45.307614 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m22:40:45.320374 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m22:40:45.348808 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m22:40:45.350687 [info ] [MainThread]: 
[0m22:40:45.353127 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:40:45.356296 [info ] [MainThread]: 
[0m22:40:45.361423 [error] [MainThread]:   Database Error in model processed_product_sales_agg (models\processed\processed_product_sales_agg.sql)
  Name total_discounts not found inside od at [25:7]
  compiled code at target\run\shopify\models\processed\processed_product_sales_agg.sql
[0m22:40:45.373641 [info ] [MainThread]: 
[0m22:40:45.381866 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m22:40:45.394340 [debug] [MainThread]: Command `dbt run` failed at 22:40:45.394340 after 17.20 seconds
[0m22:40:45.396423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000276E986FDA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000276E75819D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000276F405D1C0>]}
[0m22:40:45.398373 [debug] [MainThread]: Flushing usage events
[0m22:40:45.830669 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:41:36.509030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000216A5C221B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000216A86C8950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000216A84F6DE0>]}


============================== 22:41:36.515796 | fae7f2fc-8939-4910-a5b9-f19f62aae32b ==============================
[0m22:41:36.515796 [info ] [MainThread]: Running with dbt=1.9.1
[0m22:41:36.519195 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m22:41:39.338636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fae7f2fc-8939-4910-a5b9-f19f62aae32b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000216B1745280>]}
[0m22:41:39.427312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fae7f2fc-8939-4910-a5b9-f19f62aae32b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000216B13FCEC0>]}
[0m22:41:39.434381 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m22:41:40.265427 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m22:41:40.518798 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:41:40.522166 [debug] [MainThread]: Partial parsing: updated file: shopify://models\staging\order.sql
[0m22:41:40.979475 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m22:41:40.983741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fae7f2fc-8939-4910-a5b9-f19f62aae32b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000216B3185100>]}
[0m22:41:41.139701 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m22:41:41.146871 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m22:41:41.243086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fae7f2fc-8939-4910-a5b9-f19f62aae32b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000216B326D430>]}
[0m22:41:41.245677 [info ] [MainThread]: Found 3 models, 490 macros
[0m22:41:41.250742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fae7f2fc-8939-4910-a5b9-f19f62aae32b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000216B310E0F0>]}
[0m22:41:41.258910 [info ] [MainThread]: 
[0m22:41:41.263290 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:41:41.270202 [info ] [MainThread]: 
[0m22:41:41.273491 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:41:41.289680 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m22:41:41.293404 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:41:41.712568 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:41:42.046477 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_processed'
[0m22:41:42.046477 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:41:42.373360 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_impression-digital_processed, now list_impression-digital_staging)
[0m22:41:42.376700 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:41:42.702177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fae7f2fc-8939-4910-a5b9-f19f62aae32b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000216A5DD8200>]}
[0m22:41:42.703176 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:41:42.713881 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m22:41:42.714879 [info ] [Thread-1 (]: 1 of 3 START sql table model staging.customer .................................. [RUN]
[0m22:41:42.718358 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m22:41:42.720352 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m22:41:42.742368 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m22:41:42.752387 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m22:41:42.801533 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m22:41:43.188176 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m22:41:43.191552 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,email
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,first_name
  ,last_name
  ,CAST(orders_count AS INT64) AS orders_count
  ,state
  ,CAST(total_spent AS FLOAT64) AS total_spent
  ,CAST(last_order_id AS STRING) AS last_order_id
  ,note
  ,CAST(verified_email AS BOOL) AS verified_email
  ,multipass_identifier
  ,CAST(tax_exempt AS BOOL) AS tax_exempt
  ,tags
  ,last_order_name
  ,currency
  ,phone
  ,addresses
  ,tax_exemptions
  ,email_marketing_consent
  ,sms_marketing_consent
  ,admin_graphql_api_id
  ,default_address
FROM
  raw.Customer
)

SELECT *
FROM raw_cust
    );
  
[0m22:41:43.584943 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:059ef924-07d3-431b-b287-e09388c291f4&page=queryresults
[0m22:41:46.808743 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fae7f2fc-8939-4910-a5b9-f19f62aae32b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000216B2B683E0>]}
[0m22:41:46.811270 [info ] [Thread-1 (]: 1 of 3 OK created sql table model staging.customer ............................. [[32mCREATE TABLE (13.0 rows, 6.9 KiB processed)[0m in 4.09s]
[0m22:41:46.813958 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m22:41:46.815841 [debug] [Thread-1 (]: Began running node model.shopify.order
[0m22:41:46.819061 [info ] [Thread-1 (]: 2 of 3 START sql table model staging.order ..................................... [RUN]
[0m22:41:46.822064 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.customer, now model.shopify.order)
[0m22:41:46.823064 [debug] [Thread-1 (]: Began compiling node model.shopify.order
[0m22:41:46.841036 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.order"
[0m22:41:46.847467 [debug] [Thread-1 (]: Began executing node model.shopify.order
[0m22:41:46.970321 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:41:47.307268 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.order"
[0m22:41:47.321743 [debug] [Thread-1 (]: On model.shopify.order: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.order"} */

  
    

    create or replace table `impression-digital`.`staging`.`order`
      
    
    

    OPTIONS()
    as (
      

WITH raw_order AS (

SELECT 
  od.order_number
  ,od.financial_status
  ,od.total_discounts
  ,od.line_items
FROM
  raw.Order AS od
)

SELECT *
FROM raw_order
    );
  
[0m22:41:47.883607 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:03f71761-9195-4a85-bc73-0eec9b5adf8d&page=queryresults
[0m22:41:50.581596 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fae7f2fc-8939-4910-a5b9-f19f62aae32b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000216B3323BF0>]}
[0m22:41:50.587593 [info ] [Thread-1 (]: 2 of 3 OK created sql table model staging.order ................................ [[32mCREATE TABLE (30.0 rows, 15.4 KiB processed)[0m in 3.76s]
[0m22:41:50.597950 [debug] [Thread-1 (]: Finished running node model.shopify.order
[0m22:41:50.602112 [debug] [Thread-1 (]: Began running node model.shopify.processed_product_sales_agg
[0m22:41:50.607449 [info ] [Thread-1 (]: 3 of 3 START sql table model processed.processed_product_sales_agg ............. [RUN]
[0m22:41:50.612596 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.order, now model.shopify.processed_product_sales_agg)
[0m22:41:50.615496 [debug] [Thread-1 (]: Began compiling node model.shopify.processed_product_sales_agg
[0m22:41:50.634779 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.processed_product_sales_agg"
[0m22:41:50.639142 [debug] [Thread-1 (]: Began executing node model.shopify.processed_product_sales_agg
[0m22:41:50.679270 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.processed_product_sales_agg"
[0m22:41:50.700326 [debug] [Thread-1 (]: On model.shopify.processed_product_sales_agg: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.processed_product_sales_agg"} */

  
    

    create or replace table `impression-digital`.`processed`.`processed_product_sales_agg`
      
    
    

    OPTIONS()
    as (
      


WITH all_lines AS (

SELECT 
  od.order_number
  ,line.product_id AS line_product_id
  ,line.variant_id AS line_variant_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,IFNULL(CAST(discount.amount AS NUMERIC), 0) AS discount
  ,od.total_discounts
  ,od.financial_status AS payment_status
FROM
  staging.order AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
  raw.Product AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
LEFT JOIN
  UNNEST(line.discount_allocations) AS discount
WHERE od.financial_status IN ('paid') -- only counting sales from paid orders
)

-- same product within an order can have different discounts applied. Need to group down to variant level and sum discounts
,discount_summed AS(
  SELECT
    order_number
    ,line_product_id
    ,line_variant_id
    ,quantity
    ,SUM(discount) AS discount
  FROM all_lines
  GROUP BY order_number, line_product_id, line_variant_id, quantity
)

-- add the summed discount back to respective row in all_lines via a join
,subtotals AS(
SELECT DISTINCT
  d.order_number
  ,d.line_product_id
  ,d.line_variant_id
  ,l.price
  ,d.quantity
  ,d.discount
  ,(price*d.quantity) - d.discount AS subtotal
FROM discount_summed AS d
LEFT JOIN all_lines AS l
  ON 
    l.order_number = d.order_number AND
    l.line_product_id = d.line_product_id AND 
    l.line_variant_id = d.line_variant_id
)

,agg AS (

SELECT
  line_product_id AS product_id
  ,SUM(quantity) AS product_quantity
  ,SUM(subtotal) AS product_rev
FROM subtotals
GROUP BY line_product_id
)

SELECT * FROM agg
-- ORDER BY order_number
    );
  
[0m22:41:50.707611 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:41:51.303850 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:36d63482-421b-423a-aa25-5c7cfb19887f&page=queryresults
[0m22:41:54.548252 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fae7f2fc-8939-4910-a5b9-f19f62aae32b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000216B083DD00>]}
[0m22:41:54.560883 [info ] [Thread-1 (]: 3 of 3 OK created sql table model processed.processed_product_sales_agg ........ [[32mCREATE TABLE (19.0 rows, 4.9 KiB processed)[0m in 3.94s]
[0m22:41:54.569457 [debug] [Thread-1 (]: Finished running node model.shopify.processed_product_sales_agg
[0m22:41:54.578008 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:41:54.594898 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:41:54.597286 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m22:41:54.600631 [debug] [MainThread]: Connection 'list_impression-digital_staging' was properly closed.
[0m22:41:54.603844 [debug] [MainThread]: Connection 'model.shopify.processed_product_sales_agg' was properly closed.
[0m22:41:54.603844 [info ] [MainThread]: 
[0m22:41:54.618334 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 13.33 seconds (13.33s).
[0m22:41:54.626891 [debug] [MainThread]: Command end result
[0m22:41:54.735405 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m22:41:54.743087 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m22:41:54.767871 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m22:41:54.769869 [info ] [MainThread]: 
[0m22:41:54.778047 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:41:54.802648 [info ] [MainThread]: 
[0m22:41:54.806223 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m22:41:54.815323 [debug] [MainThread]: Command `dbt run` succeeded at 22:41:54.814711 after 18.57 seconds
[0m22:41:54.820366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000216A66467E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000216A82951F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000216A815CD10>]}
[0m22:41:54.822667 [debug] [MainThread]: Flushing usage events
[0m22:41:55.253928 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:43:13.457888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B44F74AA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B44AF8440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B44FD1070>]}


============================== 22:43:13.464989 | 8c261819-3a0f-4f82-a6db-80e0b4f078ee ==============================
[0m22:43:13.464989 [info ] [MainThread]: Running with dbt=1.9.1
[0m22:43:13.467992 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m22:43:16.876234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8c261819-3a0f-4f82-a6db-80e0b4f078ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B4E253F50>]}
[0m22:43:17.065942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8c261819-3a0f-4f82-a6db-80e0b4f078ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B4D1ED7F0>]}
[0m22:43:17.069965 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m22:43:17.897540 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m22:43:18.193986 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m22:43:18.201986 [debug] [MainThread]: Partial parsing: added file: shopify://models\processed\product_sales_agg.sql
[0m22:43:18.201986 [debug] [MainThread]: Partial parsing: deleted file: shopify://models\processed\processed_product_sales_agg.sql
[0m22:43:18.676004 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m22:43:18.682007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8c261819-3a0f-4f82-a6db-80e0b4f078ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B4FD40260>]}
[0m22:43:18.835190 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m22:43:18.847240 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m22:43:18.933278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8c261819-3a0f-4f82-a6db-80e0b4f078ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B4FA5B9E0>]}
[0m22:43:18.934617 [info ] [MainThread]: Found 3 models, 490 macros
[0m22:43:18.937776 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c261819-3a0f-4f82-a6db-80e0b4f078ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B4FC141A0>]}
[0m22:43:18.944903 [info ] [MainThread]: 
[0m22:43:18.944903 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:43:18.953144 [info ] [MainThread]: 
[0m22:43:18.956915 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:43:18.971065 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m22:43:18.972830 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:43:19.355682 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:43:19.755915 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_processed'
[0m22:43:19.756948 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:43:20.036522 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_impression-digital_processed, now list_impression-digital_staging)
[0m22:43:20.042977 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:43:20.393747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c261819-3a0f-4f82-a6db-80e0b4f078ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B4FC17050>]}
[0m22:43:20.394795 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:43:20.416023 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m22:43:20.417034 [info ] [Thread-1 (]: 1 of 3 START sql table model staging.customer .................................. [RUN]
[0m22:43:20.424076 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m22:43:20.424076 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m22:43:20.477400 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m22:43:20.481483 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m22:43:20.543289 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m22:43:20.970863 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m22:43:20.975334 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,email
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,first_name
  ,last_name
  ,CAST(orders_count AS INT64) AS orders_count
  ,state
  ,CAST(total_spent AS FLOAT64) AS total_spent
  ,CAST(last_order_id AS STRING) AS last_order_id
  ,note
  ,CAST(verified_email AS BOOL) AS verified_email
  ,multipass_identifier
  ,CAST(tax_exempt AS BOOL) AS tax_exempt
  ,tags
  ,last_order_name
  ,currency
  ,phone
  ,addresses
  ,tax_exemptions
  ,email_marketing_consent
  ,sms_marketing_consent
  ,admin_graphql_api_id
  ,default_address
FROM
  raw.Customer
)

SELECT *
FROM raw_cust
    );
  
[0m22:43:21.283345 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:a07d2ea2-985c-4091-bb5e-bc56f98ffc9a&page=queryresults
[0m22:43:24.699049 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c261819-3a0f-4f82-a6db-80e0b4f078ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B4F59CEC0>]}
[0m22:43:24.700050 [info ] [Thread-1 (]: 1 of 3 OK created sql table model staging.customer ............................. [[32mCREATE TABLE (13.0 rows, 6.9 KiB processed)[0m in 4.27s]
[0m22:43:24.703719 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m22:43:24.704796 [debug] [Thread-1 (]: Began running node model.shopify.order
[0m22:43:24.707109 [info ] [Thread-1 (]: 2 of 3 START sql table model staging.order ..................................... [RUN]
[0m22:43:24.708612 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.customer, now model.shopify.order)
[0m22:43:24.708612 [debug] [Thread-1 (]: Began compiling node model.shopify.order
[0m22:43:24.724460 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.order"
[0m22:43:24.738213 [debug] [Thread-1 (]: Began executing node model.shopify.order
[0m22:43:24.868411 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:43:25.202474 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.order"
[0m22:43:25.206710 [debug] [Thread-1 (]: On model.shopify.order: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.order"} */

  
    

    create or replace table `impression-digital`.`staging`.`order`
      
    
    

    OPTIONS()
    as (
      

WITH raw_order AS (

SELECT 
  od.order_number
  ,od.financial_status
  ,od.total_discounts
  ,od.line_items
FROM
  raw.Order AS od
)

SELECT *
FROM raw_order
    );
  
[0m22:43:25.515547 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:710b09b1-e4bc-4563-bc22-069279d23106&page=queryresults
[0m22:43:28.456100 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c261819-3a0f-4f82-a6db-80e0b4f078ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B50455970>]}
[0m22:43:28.459498 [info ] [Thread-1 (]: 2 of 3 OK created sql table model staging.order ................................ [[32mCREATE TABLE (30.0 rows, 15.4 KiB processed)[0m in 3.75s]
[0m22:43:28.461862 [debug] [Thread-1 (]: Finished running node model.shopify.order
[0m22:43:28.463867 [debug] [Thread-1 (]: Began running node model.shopify.product_sales_agg
[0m22:43:28.466519 [info ] [Thread-1 (]: 3 of 3 START sql table model processed.product_sales_agg ....................... [RUN]
[0m22:43:28.469196 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.order, now model.shopify.product_sales_agg)
[0m22:43:28.471721 [debug] [Thread-1 (]: Began compiling node model.shopify.product_sales_agg
[0m22:43:28.480386 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product_sales_agg"
[0m22:43:28.484031 [debug] [Thread-1 (]: Began executing node model.shopify.product_sales_agg
[0m22:43:28.488808 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product_sales_agg"
[0m22:43:28.497269 [debug] [Thread-1 (]: On model.shopify.product_sales_agg: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product_sales_agg"} */

  
    

    create or replace table `impression-digital`.`processed`.`product_sales_agg`
      
    
    

    OPTIONS()
    as (
      


WITH all_lines AS (

SELECT 
  od.order_number
  ,line.product_id AS line_product_id
  ,line.variant_id AS line_variant_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,IFNULL(CAST(discount.amount AS NUMERIC), 0) AS discount
  ,od.total_discounts
  ,od.financial_status AS payment_status
FROM
  staging.order AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
  raw.Product AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
LEFT JOIN
  UNNEST(line.discount_allocations) AS discount
WHERE od.financial_status IN ('paid') -- only counting sales from paid orders
)

-- same product within an order can have different discounts applied. Need to group down to variant level and sum discounts
,discount_summed AS(
  SELECT
    order_number
    ,line_product_id
    ,line_variant_id
    ,quantity
    ,SUM(discount) AS discount
  FROM all_lines
  GROUP BY order_number, line_product_id, line_variant_id, quantity
)

-- add the summed discount back to respective row in all_lines via a join
,subtotals AS(
SELECT DISTINCT
  d.order_number
  ,d.line_product_id
  ,d.line_variant_id
  ,l.price
  ,d.quantity
  ,d.discount
  ,(price*d.quantity) - d.discount AS subtotal
FROM discount_summed AS d
LEFT JOIN all_lines AS l
  ON 
    l.order_number = d.order_number AND
    l.line_product_id = d.line_product_id AND 
    l.line_variant_id = d.line_variant_id
)

,agg AS (

SELECT
  line_product_id AS product_id
  ,SUM(quantity) AS product_quantity
  ,SUM(subtotal) AS product_rev
FROM subtotals
GROUP BY line_product_id
)

SELECT * FROM agg
-- ORDER BY order_number
    );
  
[0m22:43:28.500125 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:43:29.011285 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:d2a93c3b-b1cf-4b39-b1de-480c5aa4fa43&page=queryresults
[0m22:43:32.253313 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c261819-3a0f-4f82-a6db-80e0b4f078ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B50479CA0>]}
[0m22:43:32.267797 [info ] [Thread-1 (]: 3 of 3 OK created sql table model processed.product_sales_agg .................. [[32mCREATE TABLE (19.0 rows, 4.9 KiB processed)[0m in 3.78s]
[0m22:43:32.276276 [debug] [Thread-1 (]: Finished running node model.shopify.product_sales_agg
[0m22:43:32.285040 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:43:32.301884 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:43:32.309243 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m22:43:32.313289 [debug] [MainThread]: Connection 'list_impression-digital_staging' was properly closed.
[0m22:43:32.314718 [debug] [MainThread]: Connection 'model.shopify.product_sales_agg' was properly closed.
[0m22:43:32.320411 [info ] [MainThread]: 
[0m22:43:32.327848 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 13.36 seconds (13.36s).
[0m22:43:32.336151 [debug] [MainThread]: Command end result
[0m22:43:32.429877 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m22:43:32.438824 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m22:43:32.453660 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m22:43:32.455075 [info ] [MainThread]: 
[0m22:43:32.458445 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:43:32.461243 [info ] [MainThread]: 
[0m22:43:32.465707 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m22:43:32.473983 [debug] [MainThread]: Command `dbt run` succeeded at 22:43:32.473983 after 19.34 seconds
[0m22:43:32.477327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B44D9E3F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B45498260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023B4549B290>]}
[0m22:43:32.479133 [debug] [MainThread]: Flushing usage events
[0m22:43:32.882149 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:35:36.483030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023140D00650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023141101700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023141102180>]}


============================== 01:35:36.493527 | eccc73c9-56b6-4014-9c9a-9fb34d6c5f7a ==============================
[0m01:35:36.493527 [info ] [MainThread]: Running with dbt=1.9.1
[0m01:35:36.495503 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:35:44.055506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eccc73c9-56b6-4014-9c9a-9fb34d6c5f7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002314A36F2C0>]}
[0m01:35:44.202775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eccc73c9-56b6-4014-9c9a-9fb34d6c5f7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002314979CCE0>]}
[0m01:35:44.205380 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:35:45.533424 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m01:35:47.032645 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:35:47.033694 [debug] [MainThread]: Partial parsing: updated file: shopify://models\staging\order.sql
[0m01:35:47.460711 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m01:35:47.475171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eccc73c9-56b6-4014-9c9a-9fb34d6c5f7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002314C10ACF0>]}
[0m01:35:47.627900 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:35:47.668133 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:35:47.817935 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eccc73c9-56b6-4014-9c9a-9fb34d6c5f7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002314C1F5370>]}
[0m01:35:47.819934 [info ] [MainThread]: Found 3 models, 490 macros
[0m01:35:47.821932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eccc73c9-56b6-4014-9c9a-9fb34d6c5f7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002314BED5AC0>]}
[0m01:35:47.828930 [info ] [MainThread]: 
[0m01:35:47.830932 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:35:47.831931 [info ] [MainThread]: 
[0m01:35:47.834932 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:35:47.847933 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m01:35:47.848932 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:35:48.387653 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:35:48.780726 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_processed'
[0m01:35:48.783293 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:35:49.084183 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_impression-digital_processed, now list_impression-digital_staging)
[0m01:35:49.087260 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:35:49.402939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eccc73c9-56b6-4014-9c9a-9fb34d6c5f7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002314BD03650>]}
[0m01:35:49.405312 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:35:49.430809 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m01:35:49.433048 [info ] [Thread-1 (]: 1 of 3 START sql table model staging.customer .................................. [RUN]
[0m01:35:49.437050 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m01:35:49.439053 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m01:35:49.474267 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m01:35:49.478271 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m01:35:49.522760 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m01:35:49.869078 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m01:35:49.874930 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,email
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,first_name
  ,last_name
  ,CAST(orders_count AS INT64) AS orders_count
  ,state
  ,CAST(total_spent AS FLOAT64) AS total_spent
  ,CAST(last_order_id AS STRING) AS last_order_id
  ,note
  ,CAST(verified_email AS BOOL) AS verified_email
  ,multipass_identifier
  ,CAST(tax_exempt AS BOOL) AS tax_exempt
  ,tags
  ,last_order_name
  ,currency
  ,phone
  ,addresses
  ,tax_exemptions
  ,email_marketing_consent
  ,sms_marketing_consent
  ,admin_graphql_api_id
  ,default_address
FROM
  raw.Customer
)

SELECT *
FROM raw_cust
    );
  
[0m01:35:50.467355 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:cf172222-ba7d-49d1-8eb8-91a8a8359b87&page=queryresults
[0m01:35:56.902259 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eccc73c9-56b6-4014-9c9a-9fb34d6c5f7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002314C1D7F80>]}
[0m01:35:56.904270 [info ] [Thread-1 (]: 1 of 3 OK created sql table model staging.customer ............................. [[32mCREATE TABLE (13.0 rows, 6.9 KiB processed)[0m in 7.46s]
[0m01:35:56.907263 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m01:35:56.909261 [debug] [Thread-1 (]: Began running node model.shopify.order
[0m01:35:56.912264 [info ] [Thread-1 (]: 2 of 3 START sql table model staging.order ..................................... [RUN]
[0m01:35:56.920262 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.customer, now model.shopify.order)
[0m01:35:56.923269 [debug] [Thread-1 (]: Began compiling node model.shopify.order
[0m01:35:56.943176 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.order"
[0m01:35:56.948203 [debug] [Thread-1 (]: Began executing node model.shopify.order
[0m01:35:57.098029 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:35:57.498573 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.order"
[0m01:35:57.508127 [debug] [Thread-1 (]: On model.shopify.order: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.order"} */

  
    

    create or replace table `impression-digital`.`staging`.`order`
      
    
    

    OPTIONS()
    as (
      


WITH correct_prices AS 
(
SELECT
  od.order_number
  ,line.product_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,CAST(variant.price AS NUMERIC)*CAST(line.quantity AS NUMERIC) AS subtotal
FROM
  raw.Order AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
  raw.Product AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
)

,subtotals AS
(
SELECT 
  order_number
  ,SUM(subtotal) AS subtotal
FROM correct_prices
GROUP BY order_number
)

,stage_order AS
(
SELECT 
  o.order_number
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,phone
  ,contact_email
  ,po_number
  ,COALESCE(
    s.subtotal - CAST(o.total_discounts AS NUMERIC),
    CAST(o.current_subtotal_price AS NUMERIC)
  ) AS subtotal
  ,CAST(total_discounts AS NUMERIC) AS total_discounts
  ,s.subtotal - CAST(o.total_discounts AS NUMERIC) AS current_subtotal_price
  -- ,CAST(o.current_subtotal_price AS NUMERIC) AS shopify_total
  ,CAST(total_tax AS NUMERIC) AS total_tax
  ,financial_status
  ,fulfillment_status
  ,note
  ,customer
  ,line_items
  ,refunds
  ,shipping_address
FROM
  raw.Order AS o
LEFT JOIN subtotals AS s
  ON s.order_number = o.order_number

-- ORDER BY o.order_number
)


SELECT *
FROM stage_order
    );
  
[0m01:35:57.873699 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:3afac25b-b71f-4cdd-9dfd-59a78753311b&page=queryresults
[0m01:36:00.776852 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eccc73c9-56b6-4014-9c9a-9fb34d6c5f7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231411D2000>]}
[0m01:36:00.781844 [info ] [Thread-1 (]: 2 of 3 OK created sql table model staging.order ................................ [[32mCREATE TABLE (30.0 rows, 34.6 KiB processed)[0m in 3.86s]
[0m01:36:00.788155 [debug] [Thread-1 (]: Finished running node model.shopify.order
[0m01:36:00.792152 [debug] [Thread-1 (]: Began running node model.shopify.product_sales_agg
[0m01:36:00.796565 [info ] [Thread-1 (]: 3 of 3 START sql table model processed.product_sales_agg ....................... [RUN]
[0m01:36:00.800570 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.order, now model.shopify.product_sales_agg)
[0m01:36:00.802561 [debug] [Thread-1 (]: Began compiling node model.shopify.product_sales_agg
[0m01:36:00.818890 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product_sales_agg"
[0m01:36:00.823896 [debug] [Thread-1 (]: Began executing node model.shopify.product_sales_agg
[0m01:36:00.831893 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:36:01.109103 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product_sales_agg"
[0m01:36:01.115311 [debug] [Thread-1 (]: On model.shopify.product_sales_agg: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product_sales_agg"} */

  
    

    create or replace table `impression-digital`.`processed`.`product_sales_agg`
      
    
    

    OPTIONS()
    as (
      


WITH all_lines AS (

SELECT 
  od.order_number
  ,line.product_id AS line_product_id
  ,line.variant_id AS line_variant_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,IFNULL(CAST(discount.amount AS NUMERIC), 0) AS discount
  ,od.total_discounts
  ,od.financial_status AS payment_status
FROM
  staging.order AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
  raw.Product AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
LEFT JOIN
  UNNEST(line.discount_allocations) AS discount
WHERE od.financial_status IN ('paid') -- only counting sales from paid orders
)

-- same product within an order can have different discounts applied. Need to group down to variant level and sum discounts
,discount_summed AS(
  SELECT
    order_number
    ,line_product_id
    ,line_variant_id
    ,quantity
    ,SUM(discount) AS discount
  FROM all_lines
  GROUP BY order_number, line_product_id, line_variant_id, quantity
)

-- add the summed discount back to respective row in all_lines via a join
,subtotals AS(
SELECT DISTINCT
  d.order_number
  ,d.line_product_id
  ,d.line_variant_id
  ,l.price
  ,d.quantity
  ,d.discount
  ,(price*d.quantity) - d.discount AS subtotal
FROM discount_summed AS d
LEFT JOIN all_lines AS l
  ON 
    l.order_number = d.order_number AND
    l.line_product_id = d.line_product_id AND 
    l.line_variant_id = d.line_variant_id
)

,agg AS (

SELECT
  line_product_id AS product_id
  ,SUM(quantity) AS product_quantity
  ,SUM(subtotal) AS product_rev
FROM subtotals
GROUP BY line_product_id
)

SELECT * FROM agg
-- ORDER BY order_number
    );
  
[0m01:36:01.421828 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:e01eba67-09b4-454b-ad17-c57c5dae4a2d&page=queryresults
[0m01:36:04.359830 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eccc73c9-56b6-4014-9c9a-9fb34d6c5f7a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002314C140350>]}
[0m01:36:04.364368 [info ] [Thread-1 (]: 3 of 3 OK created sql table model processed.product_sales_agg .................. [[32mCREATE TABLE (19.0 rows, 4.9 KiB processed)[0m in 3.56s]
[0m01:36:04.372328 [debug] [Thread-1 (]: Finished running node model.shopify.product_sales_agg
[0m01:36:04.382740 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:36:04.400600 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:36:04.405160 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m01:36:04.405160 [debug] [MainThread]: Connection 'list_impression-digital_staging' was properly closed.
[0m01:36:04.405160 [debug] [MainThread]: Connection 'model.shopify.product_sales_agg' was properly closed.
[0m01:36:04.411916 [info ] [MainThread]: 
[0m01:36:04.416575 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 16.58 seconds (16.58s).
[0m01:36:04.422804 [debug] [MainThread]: Command end result
[0m01:36:04.515649 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:36:04.522651 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:36:04.539651 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m01:36:04.540652 [info ] [MainThread]: 
[0m01:36:04.543649 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:36:04.546658 [info ] [MainThread]: 
[0m01:36:04.547651 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m01:36:04.553651 [debug] [MainThread]: Command `dbt run` succeeded at 01:36:04.552649 after 28.53 seconds
[0m01:36:04.555651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023141477C20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231414779B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000231418FFC80>]}
[0m01:36:04.557651 [debug] [MainThread]: Flushing usage events
[0m01:36:04.953882 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:46:23.322429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1C040F950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1C040E330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1C040FDD0>]}


============================== 01:46:23.341546 | fb7840ba-3095-4725-b6c2-da05a814d48a ==============================
[0m01:46:23.341546 [info ] [MainThread]: Running with dbt=1.9.1
[0m01:46:23.345075 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m01:46:27.403482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fb7840ba-3095-4725-b6c2-da05a814d48a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1C040FD40>]}
[0m01:46:27.504117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fb7840ba-3095-4725-b6c2-da05a814d48a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1CA673E60>]}
[0m01:46:27.510153 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:46:28.585788 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m01:46:29.131302 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m01:46:29.135488 [debug] [MainThread]: Partial parsing: added file: shopify://models\staging\product.sql
[0m01:46:29.137483 [debug] [MainThread]: Partial parsing: updated file: shopify://models\staging\order.sql
[0m01:46:29.597181 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m01:46:29.604361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fb7840ba-3095-4725-b6c2-da05a814d48a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1CAC141A0>]}
[0m01:46:29.751380 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:46:29.764874 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:46:29.879308 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fb7840ba-3095-4725-b6c2-da05a814d48a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1CACE8B90>]}
[0m01:46:29.880349 [info ] [MainThread]: Found 4 models, 490 macros
[0m01:46:29.885147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb7840ba-3095-4725-b6c2-da05a814d48a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1CACD9EB0>]}
[0m01:46:29.892779 [info ] [MainThread]: 
[0m01:46:29.896298 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:46:29.904768 [info ] [MainThread]: 
[0m01:46:29.906384 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:46:30.086369 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m01:46:30.109567 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:46:30.665348 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:46:31.177330 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_staging'
[0m01:46:31.179401 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:46:31.449053 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_impression-digital_staging, now list_impression-digital_processed)
[0m01:46:31.451054 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:46:31.705688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb7840ba-3095-4725-b6c2-da05a814d48a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1CA672900>]}
[0m01:46:31.706684 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:46:31.731738 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m01:46:31.731738 [info ] [Thread-1 (]: 1 of 4 START sql table model staging.customer .................................. [RUN]
[0m01:46:31.741529 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m01:46:31.741529 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m01:46:31.802005 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m01:46:31.813227 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m01:46:31.861875 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m01:46:32.180267 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m01:46:32.180267 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,email
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,first_name
  ,last_name
  ,CAST(orders_count AS INT64) AS orders_count
  ,state
  ,CAST(total_spent AS FLOAT64) AS total_spent
  ,CAST(last_order_id AS STRING) AS last_order_id
  ,note
  ,CAST(verified_email AS BOOL) AS verified_email
  ,multipass_identifier
  ,CAST(tax_exempt AS BOOL) AS tax_exempt
  ,tags
  ,last_order_name
  ,currency
  ,phone
  ,addresses
  ,tax_exemptions
  ,email_marketing_consent
  ,sms_marketing_consent
  ,admin_graphql_api_id
  ,default_address
FROM
  raw.Customer
)

SELECT *
FROM raw_cust
    );
  
[0m01:46:32.602536 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:200127f9-d698-4d47-bc46-bba0337b7c20&page=queryresults
[0m01:46:36.096456 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb7840ba-3095-4725-b6c2-da05a814d48a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1C920B290>]}
[0m01:46:36.099298 [info ] [Thread-1 (]: 1 of 4 OK created sql table model staging.customer ............................. [[32mCREATE TABLE (13.0 rows, 6.9 KiB processed)[0m in 4.35s]
[0m01:46:36.105859 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m01:46:36.110707 [debug] [Thread-1 (]: Began running node model.shopify.order
[0m01:46:36.139516 [info ] [Thread-1 (]: 2 of 4 START sql table model staging.order ..................................... [RUN]
[0m01:46:36.160039 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.customer, now model.shopify.order)
[0m01:46:36.160039 [debug] [Thread-1 (]: Began compiling node model.shopify.order
[0m01:46:36.183382 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.order"
[0m01:46:36.187548 [debug] [Thread-1 (]: Began executing node model.shopify.order
[0m01:46:36.200461 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:46:36.599494 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.order"
[0m01:46:36.607631 [debug] [Thread-1 (]: On model.shopify.order: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.order"} */

  
    

    create or replace table `impression-digital`.`staging`.`order`
      
    
    

    OPTIONS()
    as (
      


WITH correct_prices AS 
(
SELECT
  od.order_number
  ,line.product_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,CAST(variant.price AS NUMERIC)*CAST(line.quantity AS NUMERIC) AS subtotal
FROM
  raw.Order AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
  stage.Product AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
)

,subtotals AS
(
SELECT 
  order_number
  ,SUM(subtotal) AS subtotal
FROM correct_prices
GROUP BY order_number
)

,stage_order AS
(
SELECT 
  o.order_number
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,phone
  ,contact_email
  ,po_number
  ,COALESCE(
    s.subtotal - CAST(o.total_discounts AS NUMERIC),
    CAST(o.current_subtotal_price AS NUMERIC)
  ) AS subtotal
  ,CAST(total_discounts AS NUMERIC) AS total_discounts
  ,s.subtotal - CAST(o.total_discounts AS NUMERIC) AS current_subtotal_price
  -- ,CAST(o.current_subtotal_price AS NUMERIC) AS shopify_total
  ,CAST(total_tax AS NUMERIC) AS total_tax
  ,financial_status
  ,fulfillment_status
  ,note
  ,customer
  ,line_items
  ,refunds
  ,shipping_address
FROM
  raw.Order AS o
LEFT JOIN subtotals AS s
  ON s.order_number = o.order_number

-- ORDER BY o.order_number
)


SELECT *
FROM stage_order
    );
  
[0m01:46:37.211143 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:1e79e44d-8fa9-4ff9-9111-f3ab6dfa474d&page=queryresults
[0m01:46:37.211143 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:1e79e44d-8fa9-4ff9-9111-f3ab6dfa474d&page=queryresults
[0m01:46:37.506605 [debug] [Thread-1 (]: Database Error in model order (models\staging\order.sql)
  Not found: Dataset impression-digital:stage was not found in location EU
  compiled code at target\run\shopify\models\staging\order.sql
[0m01:46:37.506605 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb7840ba-3095-4725-b6c2-da05a814d48a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1CAA52390>]}
[0m01:46:37.514655 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model staging.order ............................ [[31mERROR[0m in 1.35s]
[0m01:46:37.517819 [debug] [Thread-1 (]: Finished running node model.shopify.order
[0m01:46:37.517819 [debug] [Thread-1 (]: Began running node model.shopify.product
[0m01:46:37.521428 [debug] [Thread-4 (]: Marking all children of 'model.shopify.order' to be skipped because of status 'error'.  Reason: Database Error in model order (models\staging\order.sql)
  Not found: Dataset impression-digital:stage was not found in location EU
  compiled code at target\run\shopify\models\staging\order.sql.
[0m01:46:37.524516 [info ] [Thread-1 (]: 3 of 4 START sql table model staging.product ................................... [RUN]
[0m01:46:37.527118 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.order, now model.shopify.product)
[0m01:46:37.530819 [debug] [Thread-1 (]: Began compiling node model.shopify.product
[0m01:46:37.535117 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product"
[0m01:46:37.541831 [debug] [Thread-1 (]: Began executing node model.shopify.product
[0m01:46:37.547625 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product"
[0m01:46:37.561218 [debug] [Thread-1 (]: On model.shopify.product: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product"} */

  
    

    create or replace table `impression-digital`.`staging`.`product`
      
    
    

    OPTIONS()
    as (
      

WITH stage_product AS
(
SELECT 
  title
  ,body_html
  ,vendor
  ,product_type
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,handle
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', published_at) AS published_at
  ,template_suffix
  ,published_scope
  ,tags
  ,status
  ,admin_graphql_api_id
  ,variants
  ,options
  ,images
  ,image
FROM raw.Product
)

SELECT * FROM stage_product
    );
  
[0m01:46:37.564552 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:46:38.144842 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:15e82eff-1b63-416e-b107-7f58d0131196&page=queryresults
[0m01:46:41.214645 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb7840ba-3095-4725-b6c2-da05a814d48a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1CA6DCEF0>]}
[0m01:46:41.214645 [info ] [Thread-1 (]: 3 of 4 OK created sql table model staging.product .............................. [[32mCREATE TABLE (47.0 rows, 119.2 KiB processed)[0m in 3.69s]
[0m01:46:41.223347 [debug] [Thread-1 (]: Finished running node model.shopify.product
[0m01:46:41.228107 [debug] [Thread-1 (]: Began running node model.shopify.product_sales_agg
[0m01:46:41.232678 [info ] [Thread-1 (]: 4 of 4 START sql table model processed.product_sales_agg ....................... [RUN]
[0m01:46:41.237794 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.product, now model.shopify.product_sales_agg)
[0m01:46:41.241471 [debug] [Thread-1 (]: Began compiling node model.shopify.product_sales_agg
[0m01:46:41.249965 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product_sales_agg"
[0m01:46:41.259534 [debug] [Thread-1 (]: Began executing node model.shopify.product_sales_agg
[0m01:46:41.273187 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:46:41.762467 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product_sales_agg"
[0m01:46:41.774802 [debug] [Thread-1 (]: On model.shopify.product_sales_agg: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product_sales_agg"} */

  
    

    create or replace table `impression-digital`.`processed`.`product_sales_agg`
      
    
    

    OPTIONS()
    as (
      


WITH all_lines AS (

SELECT 
  od.order_number
  ,line.product_id AS line_product_id
  ,line.variant_id AS line_variant_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,IFNULL(CAST(discount.amount AS NUMERIC), 0) AS discount
  ,od.total_discounts
  ,od.financial_status AS payment_status
FROM
  staging.order AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
  raw.Product AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
LEFT JOIN
  UNNEST(line.discount_allocations) AS discount
WHERE od.financial_status IN ('paid') -- only counting sales from paid orders
)

-- same product within an order can have different discounts applied. Need to group down to variant level and sum discounts
,discount_summed AS(
  SELECT
    order_number
    ,line_product_id
    ,line_variant_id
    ,quantity
    ,SUM(discount) AS discount
  FROM all_lines
  GROUP BY order_number, line_product_id, line_variant_id, quantity
)

-- add the summed discount back to respective row in all_lines via a join
,subtotals AS(
SELECT DISTINCT
  d.order_number
  ,d.line_product_id
  ,d.line_variant_id
  ,l.price
  ,d.quantity
  ,d.discount
  ,(price*d.quantity) - d.discount AS subtotal
FROM discount_summed AS d
LEFT JOIN all_lines AS l
  ON 
    l.order_number = d.order_number AND
    l.line_product_id = d.line_product_id AND 
    l.line_variant_id = d.line_variant_id
)

,agg AS (

SELECT
  line_product_id AS product_id
  ,SUM(quantity) AS product_quantity
  ,SUM(subtotal) AS product_rev
FROM subtotals
GROUP BY line_product_id
)

SELECT * FROM agg
-- ORDER BY order_number
    );
  
[0m01:46:42.230777 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:43a7d4c8-3cc9-4a0c-8273-bfa96a856568&page=queryresults
[0m01:46:45.452028 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb7840ba-3095-4725-b6c2-da05a814d48a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1CAD9AB10>]}
[0m01:46:45.454062 [info ] [Thread-1 (]: 4 of 4 OK created sql table model processed.product_sales_agg .................. [[32mCREATE TABLE (19.0 rows, 4.9 KiB processed)[0m in 4.21s]
[0m01:46:45.461142 [debug] [Thread-1 (]: Finished running node model.shopify.product_sales_agg
[0m01:46:45.468030 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:46:45.476507 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:46:45.478636 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m01:46:45.480631 [debug] [MainThread]: Connection 'list_impression-digital_processed' was properly closed.
[0m01:46:45.483275 [debug] [MainThread]: Connection 'model.shopify.product_sales_agg' was properly closed.
[0m01:46:45.484276 [info ] [MainThread]: 
[0m01:46:45.492557 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 15.58 seconds (15.58s).
[0m01:46:45.497441 [debug] [MainThread]: Command end result
[0m01:46:45.604975 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:46:45.618645 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:46:45.640979 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m01:46:45.642710 [info ] [MainThread]: 
[0m01:46:45.645078 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:46:45.646685 [info ] [MainThread]: 
[0m01:46:45.649950 [error] [MainThread]:   Database Error in model order (models\staging\order.sql)
  Not found: Dataset impression-digital:stage was not found in location EU
  compiled code at target\run\shopify\models\staging\order.sql
[0m01:46:45.652758 [info ] [MainThread]: 
[0m01:46:45.655603 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m01:46:45.662871 [debug] [MainThread]: Command `dbt run` failed at 01:46:45.662077 after 22.88 seconds
[0m01:46:45.664569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1C8C845C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1BF8F55B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001D1CB4F7200>]}
[0m01:46:45.666535 [debug] [MainThread]: Flushing usage events
[0m01:46:46.127762 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:47:23.765274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022225F348F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022225F34C20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022225F359D0>]}


============================== 01:47:23.774672 | 88f8945d-bf4e-49fa-a5c0-cc94618162fc ==============================
[0m01:47:23.774672 [info ] [MainThread]: Running with dbt=1.9.1
[0m01:47:23.777014 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m01:47:26.791424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '88f8945d-bf4e-49fa-a5c0-cc94618162fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002222FD64230>]}
[0m01:47:26.885129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '88f8945d-bf4e-49fa-a5c0-cc94618162fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002222ED3BCB0>]}
[0m01:47:26.893519 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:47:27.690441 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m01:47:27.961687 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:47:27.961687 [debug] [MainThread]: Partial parsing: updated file: shopify://models\staging\order.sql
[0m01:47:28.428875 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m01:47:28.453356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '88f8945d-bf4e-49fa-a5c0-cc94618162fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022230606660>]}
[0m01:47:28.638010 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:47:28.647601 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:47:28.720942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '88f8945d-bf4e-49fa-a5c0-cc94618162fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002223054BA40>]}
[0m01:47:28.722939 [info ] [MainThread]: Found 4 models, 490 macros
[0m01:47:28.725940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '88f8945d-bf4e-49fa-a5c0-cc94618162fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022230835F10>]}
[0m01:47:28.729695 [info ] [MainThread]: 
[0m01:47:28.732809 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:47:28.736574 [info ] [MainThread]: 
[0m01:47:28.741018 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:47:28.757606 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m01:47:28.759814 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:47:29.117236 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:47:29.647594 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_staging'
[0m01:47:29.649256 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:47:29.927019 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_impression-digital_staging, now list_impression-digital_processed)
[0m01:47:29.929054 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:47:30.252602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '88f8945d-bf4e-49fa-a5c0-cc94618162fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000222307FA960>]}
[0m01:47:30.256416 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:47:30.325938 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m01:47:30.328464 [info ] [Thread-1 (]: 1 of 4 START sql table model staging.customer .................................. [RUN]
[0m01:47:30.333289 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m01:47:30.334902 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m01:47:30.369690 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m01:47:30.374414 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m01:47:30.444422 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m01:47:31.051021 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m01:47:31.059139 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,email
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,first_name
  ,last_name
  ,CAST(orders_count AS INT64) AS orders_count
  ,state
  ,CAST(total_spent AS FLOAT64) AS total_spent
  ,CAST(last_order_id AS STRING) AS last_order_id
  ,note
  ,CAST(verified_email AS BOOL) AS verified_email
  ,multipass_identifier
  ,CAST(tax_exempt AS BOOL) AS tax_exempt
  ,tags
  ,last_order_name
  ,currency
  ,phone
  ,addresses
  ,tax_exemptions
  ,email_marketing_consent
  ,sms_marketing_consent
  ,admin_graphql_api_id
  ,default_address
FROM
  raw.Customer
)

SELECT *
FROM raw_cust
    );
  
[0m01:47:31.370873 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:438d0f85-f7b1-4697-bc34-e1115dcebbf1&page=queryresults
[0m01:47:34.233734 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '88f8945d-bf4e-49fa-a5c0-cc94618162fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002223008C980>]}
[0m01:47:34.235150 [info ] [Thread-1 (]: 1 of 4 OK created sql table model staging.customer ............................. [[32mCREATE TABLE (13.0 rows, 6.9 KiB processed)[0m in 3.90s]
[0m01:47:34.240293 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m01:47:34.243528 [debug] [Thread-1 (]: Began running node model.shopify.order
[0m01:47:34.246824 [info ] [Thread-1 (]: 2 of 4 START sql table model staging.order ..................................... [RUN]
[0m01:47:34.249297 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.customer, now model.shopify.order)
[0m01:47:34.252294 [debug] [Thread-1 (]: Began compiling node model.shopify.order
[0m01:47:34.382038 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.order"
[0m01:47:34.392220 [debug] [Thread-1 (]: Began executing node model.shopify.order
[0m01:47:34.399585 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:47:35.011556 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.order"
[0m01:47:35.024747 [debug] [Thread-1 (]: On model.shopify.order: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.order"} */

  
    

    create or replace table `impression-digital`.`staging`.`order`
      
    
    

    OPTIONS()
    as (
      


WITH correct_prices AS 
(
SELECT
  od.order_number
  ,line.product_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,CAST(variant.price AS NUMERIC)*CAST(line.quantity AS NUMERIC) AS subtotal
FROM
  raw.Order AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
  staging.Product AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
)

,subtotals AS
(
SELECT 
  order_number
  ,SUM(subtotal) AS subtotal
FROM correct_prices
GROUP BY order_number
)

,stage_order AS
(
SELECT 
  o.order_number
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,phone
  ,contact_email
  ,po_number
  ,COALESCE(
    s.subtotal - CAST(o.total_discounts AS NUMERIC),
    CAST(o.current_subtotal_price AS NUMERIC)
  ) AS subtotal
  ,CAST(total_discounts AS NUMERIC) AS total_discounts
  ,s.subtotal - CAST(o.total_discounts AS NUMERIC) AS current_subtotal_price
  -- ,CAST(o.current_subtotal_price AS NUMERIC) AS shopify_total
  ,CAST(total_tax AS NUMERIC) AS total_tax
  ,financial_status
  ,fulfillment_status
  ,note
  ,customer
  ,line_items
  ,refunds
  ,shipping_address
FROM
  raw.Order AS o
LEFT JOIN subtotals AS s
  ON s.order_number = o.order_number

-- ORDER BY o.order_number
)


SELECT *
FROM stage_order
    );
  
[0m01:47:35.291011 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:0e1da520-a1af-4d0b-91d2-3c3b14785c36&page=queryresults
[0m01:47:35.292230 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:0e1da520-a1af-4d0b-91d2-3c3b14785c36&page=queryresults
[0m01:47:35.313370 [debug] [Thread-1 (]: Database Error in model order (models\staging\order.sql)
  Not found: Table impression-digital:staging.Product was not found in location EU
  compiled code at target\run\shopify\models\staging\order.sql
[0m01:47:35.313370 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '88f8945d-bf4e-49fa-a5c0-cc94618162fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022230F3A240>]}
[0m01:47:35.313370 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model staging.order ............................ [[31mERROR[0m in 1.06s]
[0m01:47:35.324981 [debug] [Thread-1 (]: Finished running node model.shopify.order
[0m01:47:35.326499 [debug] [Thread-1 (]: Began running node model.shopify.product
[0m01:47:35.330127 [debug] [Thread-4 (]: Marking all children of 'model.shopify.order' to be skipped because of status 'error'.  Reason: Database Error in model order (models\staging\order.sql)
  Not found: Table impression-digital:staging.Product was not found in location EU
  compiled code at target\run\shopify\models\staging\order.sql.
[0m01:47:35.332616 [info ] [Thread-1 (]: 3 of 4 START sql table model staging.product ................................... [RUN]
[0m01:47:35.336644 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.order, now model.shopify.product)
[0m01:47:35.339071 [debug] [Thread-1 (]: Began compiling node model.shopify.product
[0m01:47:35.349939 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product"
[0m01:47:35.352993 [debug] [Thread-1 (]: Began executing node model.shopify.product
[0m01:47:35.359804 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:47:35.712917 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product"
[0m01:47:35.713919 [debug] [Thread-1 (]: On model.shopify.product: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product"} */

  
    

    create or replace table `impression-digital`.`staging`.`product`
      
    
    

    OPTIONS()
    as (
      

WITH stage_product AS
(
SELECT 
  title
  ,body_html
  ,vendor
  ,product_type
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,handle
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', published_at) AS published_at
  ,template_suffix
  ,published_scope
  ,tags
  ,status
  ,admin_graphql_api_id
  ,variants
  ,options
  ,images
  ,image
FROM raw.Product
)

SELECT * FROM stage_product
    );
  
[0m01:47:36.118644 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:0e04f3dd-0f86-4905-abe3-669e5456cbac&page=queryresults
[0m01:47:38.862561 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '88f8945d-bf4e-49fa-a5c0-cc94618162fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022230320110>]}
[0m01:47:38.862561 [info ] [Thread-1 (]: 3 of 4 OK created sql table model staging.product .............................. [[32mCREATE TABLE (47.0 rows, 119.2 KiB processed)[0m in 3.53s]
[0m01:47:38.872999 [debug] [Thread-1 (]: Finished running node model.shopify.product
[0m01:47:38.874442 [debug] [Thread-1 (]: Began running node model.shopify.product_sales_agg
[0m01:47:38.876044 [info ] [Thread-1 (]: 4 of 4 START sql table model processed.product_sales_agg ....................... [RUN]
[0m01:47:38.879077 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.product, now model.shopify.product_sales_agg)
[0m01:47:38.879077 [debug] [Thread-1 (]: Began compiling node model.shopify.product_sales_agg
[0m01:47:38.891402 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product_sales_agg"
[0m01:47:38.898815 [debug] [Thread-1 (]: Began executing node model.shopify.product_sales_agg
[0m01:47:38.909424 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:47:39.238023 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product_sales_agg"
[0m01:47:39.249521 [debug] [Thread-1 (]: On model.shopify.product_sales_agg: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product_sales_agg"} */

  
    

    create or replace table `impression-digital`.`processed`.`product_sales_agg`
      
    
    

    OPTIONS()
    as (
      


WITH all_lines AS (

SELECT 
  od.order_number
  ,line.product_id AS line_product_id
  ,line.variant_id AS line_variant_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,IFNULL(CAST(discount.amount AS NUMERIC), 0) AS discount
  ,od.total_discounts
  ,od.financial_status AS payment_status
FROM
  staging.order AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
  raw.Product AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
LEFT JOIN
  UNNEST(line.discount_allocations) AS discount
WHERE od.financial_status IN ('paid') -- only counting sales from paid orders
)

-- same product within an order can have different discounts applied. Need to group down to variant level and sum discounts
,discount_summed AS(
  SELECT
    order_number
    ,line_product_id
    ,line_variant_id
    ,quantity
    ,SUM(discount) AS discount
  FROM all_lines
  GROUP BY order_number, line_product_id, line_variant_id, quantity
)

-- add the summed discount back to respective row in all_lines via a join
,subtotals AS(
SELECT DISTINCT
  d.order_number
  ,d.line_product_id
  ,d.line_variant_id
  ,l.price
  ,d.quantity
  ,d.discount
  ,(price*d.quantity) - d.discount AS subtotal
FROM discount_summed AS d
LEFT JOIN all_lines AS l
  ON 
    l.order_number = d.order_number AND
    l.line_product_id = d.line_product_id AND 
    l.line_variant_id = d.line_variant_id
)

,agg AS (

SELECT
  line_product_id AS product_id
  ,SUM(quantity) AS product_quantity
  ,SUM(subtotal) AS product_rev
FROM subtotals
GROUP BY line_product_id
)

SELECT * FROM agg
-- ORDER BY order_number
    );
  
[0m01:47:39.685145 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:ba0cbf4f-e57a-43d9-8ef3-6ea5fbfb6ea4&page=queryresults
[0m01:47:42.607767 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '88f8945d-bf4e-49fa-a5c0-cc94618162fc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000222301F8CB0>]}
[0m01:47:42.607767 [info ] [Thread-1 (]: 4 of 4 OK created sql table model processed.product_sales_agg .................. [[32mCREATE TABLE (19.0 rows, 4.9 KiB processed)[0m in 3.73s]
[0m01:47:42.615351 [debug] [Thread-1 (]: Finished running node model.shopify.product_sales_agg
[0m01:47:42.621349 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:47:42.630057 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:47:42.630057 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m01:47:42.638003 [debug] [MainThread]: Connection 'list_impression-digital_processed' was properly closed.
[0m01:47:42.641319 [debug] [MainThread]: Connection 'model.shopify.product_sales_agg' was properly closed.
[0m01:47:42.644251 [info ] [MainThread]: 
[0m01:47:42.647680 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 13.90 seconds (13.90s).
[0m01:47:42.660315 [debug] [MainThread]: Command end result
[0m01:47:42.774358 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:47:42.777319 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:47:42.797542 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m01:47:42.799541 [info ] [MainThread]: 
[0m01:47:42.802138 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:47:42.806264 [info ] [MainThread]: 
[0m01:47:42.810879 [error] [MainThread]:   Database Error in model order (models\staging\order.sql)
  Not found: Table impression-digital:staging.Product was not found in location EU
  compiled code at target\run\shopify\models\staging\order.sql
[0m01:47:42.817905 [info ] [MainThread]: 
[0m01:47:42.822030 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m01:47:42.831857 [debug] [MainThread]: Command `dbt run` failed at 01:47:42.831857 after 19.34 seconds
[0m01:47:42.835130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022225C03920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000222305D41A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022230F3A240>]}
[0m01:47:42.837944 [debug] [MainThread]: Flushing usage events
[0m01:47:43.315435 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:48:15.488168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19CD5DEB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19D1CE120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19F7D0C20>]}


============================== 01:48:15.494825 | c13f42e0-20a7-4970-b76a-f54bf5ff66b9 ==============================
[0m01:48:15.494825 [info ] [MainThread]: Running with dbt=1.9.1
[0m01:48:15.498096 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m01:48:18.331083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c13f42e0-20a7-4970-b76a-f54bf5ff66b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C1A76F6390>]}
[0m01:48:18.433054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c13f42e0-20a7-4970-b76a-f54bf5ff66b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C1A88D8830>]}
[0m01:48:18.435502 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:48:19.231476 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m01:48:19.505025 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:48:19.512903 [debug] [MainThread]: Partial parsing: updated file: shopify://models\staging\order.sql
[0m01:48:19.996455 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m01:48:20.005901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c13f42e0-20a7-4970-b76a-f54bf5ff66b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C1AA08C4D0>]}
[0m01:48:20.162040 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:48:20.170072 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:48:20.245794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c13f42e0-20a7-4970-b76a-f54bf5ff66b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C1AA0EBF50>]}
[0m01:48:20.246797 [info ] [MainThread]: Found 4 models, 490 macros
[0m01:48:20.249801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c13f42e0-20a7-4970-b76a-f54bf5ff66b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C1A9E8B260>]}
[0m01:48:20.251801 [info ] [MainThread]: 
[0m01:48:20.251801 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:48:20.259711 [info ] [MainThread]: 
[0m01:48:20.264215 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:48:20.280464 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m01:48:20.283462 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:48:20.634780 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:48:21.057174 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_staging'
[0m01:48:21.063222 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:48:21.373966 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_impression-digital_staging, now list_impression-digital_processed)
[0m01:48:21.377448 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:48:21.681251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c13f42e0-20a7-4970-b76a-f54bf5ff66b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C1AA269430>]}
[0m01:48:21.682301 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:48:21.705541 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m01:48:21.711246 [info ] [Thread-1 (]: 1 of 4 START sql table model staging.customer .................................. [RUN]
[0m01:48:21.715560 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m01:48:21.718727 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m01:48:21.769653 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m01:48:21.773791 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m01:48:21.843979 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m01:48:22.257230 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m01:48:22.259389 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,email
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,first_name
  ,last_name
  ,CAST(orders_count AS INT64) AS orders_count
  ,state
  ,CAST(total_spent AS FLOAT64) AS total_spent
  ,CAST(last_order_id AS STRING) AS last_order_id
  ,note
  ,CAST(verified_email AS BOOL) AS verified_email
  ,multipass_identifier
  ,CAST(tax_exempt AS BOOL) AS tax_exempt
  ,tags
  ,last_order_name
  ,currency
  ,phone
  ,addresses
  ,tax_exemptions
  ,email_marketing_consent
  ,sms_marketing_consent
  ,admin_graphql_api_id
  ,default_address
FROM
  raw.Customer
)

SELECT *
FROM raw_cust
    );
  
[0m01:48:22.540531 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:dfc0bb64-2bd3-4d14-9aae-527028e4bfa8&page=queryresults
[0m01:48:25.712122 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c13f42e0-20a7-4970-b76a-f54bf5ff66b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19EFA46E0>]}
[0m01:48:25.712122 [info ] [Thread-1 (]: 1 of 4 OK created sql table model staging.customer ............................. [[32mCREATE TABLE (13.0 rows, 6.9 KiB processed)[0m in 3.99s]
[0m01:48:25.717677 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m01:48:25.722267 [debug] [Thread-1 (]: Began running node model.shopify.order
[0m01:48:25.725045 [info ] [Thread-1 (]: 2 of 4 START sql table model staging.order ..................................... [RUN]
[0m01:48:25.730835 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.customer, now model.shopify.order)
[0m01:48:25.733749 [debug] [Thread-1 (]: Began compiling node model.shopify.order
[0m01:48:25.886722 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.order"
[0m01:48:25.893507 [debug] [Thread-1 (]: Began executing node model.shopify.order
[0m01:48:25.902682 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:48:26.373289 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.order"
[0m01:48:26.373289 [debug] [Thread-1 (]: On model.shopify.order: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.order"} */

  
    

    create or replace table `impression-digital`.`staging`.`order`
      
    
    

    OPTIONS()
    as (
      


WITH correct_prices AS 
(
SELECT
  od.order_number
  ,line.product_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,CAST(variant.price AS NUMERIC)*CAST(line.quantity AS NUMERIC) AS subtotal
FROM
  raw.Order AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
  staging.product AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
)

,subtotals AS
(
SELECT 
  order_number
  ,SUM(subtotal) AS subtotal
FROM correct_prices
GROUP BY order_number
)

,stage_order AS
(
SELECT 
  o.order_number
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,phone
  ,contact_email
  ,po_number
  ,COALESCE(
    s.subtotal - CAST(o.total_discounts AS NUMERIC),
    CAST(o.current_subtotal_price AS NUMERIC)
  ) AS subtotal
  ,CAST(total_discounts AS NUMERIC) AS total_discounts
  ,s.subtotal - CAST(o.total_discounts AS NUMERIC) AS current_subtotal_price
  -- ,CAST(o.current_subtotal_price AS NUMERIC) AS shopify_total
  ,CAST(total_tax AS NUMERIC) AS total_tax
  ,financial_status
  ,fulfillment_status
  ,note
  ,customer
  ,line_items
  ,refunds
  ,shipping_address
FROM
  raw.Order AS o
LEFT JOIN subtotals AS s
  ON s.order_number = o.order_number

-- ORDER BY o.order_number
)


SELECT *
FROM stage_order
    );
  
[0m01:48:26.984573 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:c8d7f9ac-7b70-421a-8246-22538e23b0a1&page=queryresults
[0m01:48:27.100853 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:c8d7f9ac-7b70-421a-8246-22538e23b0a1&page=queryresults
[0m01:48:27.144922 [debug] [Thread-1 (]: Database Error in model order (models\staging\order.sql)
  Name id not found inside pd at [30:27]
  compiled code at target\run\shopify\models\staging\order.sql
[0m01:48:27.145922 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c13f42e0-20a7-4970-b76a-f54bf5ff66b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19EAB5DC0>]}
[0m01:48:27.152626 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model staging.order ............................ [[31mERROR[0m in 1.42s]
[0m01:48:27.156023 [debug] [Thread-1 (]: Finished running node model.shopify.order
[0m01:48:27.156023 [debug] [Thread-1 (]: Began running node model.shopify.product
[0m01:48:27.160727 [debug] [Thread-4 (]: Marking all children of 'model.shopify.order' to be skipped because of status 'error'.  Reason: Database Error in model order (models\staging\order.sql)
  Name id not found inside pd at [30:27]
  compiled code at target\run\shopify\models\staging\order.sql.
[0m01:48:27.162631 [info ] [Thread-1 (]: 3 of 4 START sql table model staging.product ................................... [RUN]
[0m01:48:27.168201 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.order, now model.shopify.product)
[0m01:48:27.173447 [debug] [Thread-1 (]: Began compiling node model.shopify.product
[0m01:48:27.190958 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product"
[0m01:48:27.196067 [debug] [Thread-1 (]: Began executing node model.shopify.product
[0m01:48:27.206682 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:48:27.703730 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product"
[0m01:48:27.703730 [debug] [Thread-1 (]: On model.shopify.product: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product"} */

  
    

    create or replace table `impression-digital`.`staging`.`product`
      
    
    

    OPTIONS()
    as (
      

WITH stage_product AS
(
SELECT 
  title
  ,body_html
  ,vendor
  ,product_type
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,handle
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', published_at) AS published_at
  ,template_suffix
  ,published_scope
  ,tags
  ,status
  ,admin_graphql_api_id
  ,variants
  ,options
  ,images
  ,image
FROM raw.Product
)

SELECT * FROM stage_product
    );
  
[0m01:48:28.108333 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:67d8e240-3247-4345-9e8e-fb0a63c3c814&page=queryresults
[0m01:48:30.392704 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c13f42e0-20a7-4970-b76a-f54bf5ff66b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19EAB5DC0>]}
[0m01:48:30.394795 [info ] [Thread-1 (]: 3 of 4 OK created sql table model staging.product .............................. [[32mCREATE TABLE (47.0 rows, 119.2 KiB processed)[0m in 3.22s]
[0m01:48:30.398566 [debug] [Thread-1 (]: Finished running node model.shopify.product
[0m01:48:30.399857 [debug] [Thread-1 (]: Began running node model.shopify.product_sales_agg
[0m01:48:30.402858 [info ] [Thread-1 (]: 4 of 4 START sql table model processed.product_sales_agg ....................... [RUN]
[0m01:48:30.405132 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.product, now model.shopify.product_sales_agg)
[0m01:48:30.407831 [debug] [Thread-1 (]: Began compiling node model.shopify.product_sales_agg
[0m01:48:30.420427 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product_sales_agg"
[0m01:48:30.423981 [debug] [Thread-1 (]: Began executing node model.shopify.product_sales_agg
[0m01:48:30.431232 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:48:30.693303 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product_sales_agg"
[0m01:48:30.693303 [debug] [Thread-1 (]: On model.shopify.product_sales_agg: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product_sales_agg"} */

  
    

    create or replace table `impression-digital`.`processed`.`product_sales_agg`
      
    
    

    OPTIONS()
    as (
      


WITH all_lines AS (

SELECT 
  od.order_number
  ,line.product_id AS line_product_id
  ,line.variant_id AS line_variant_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,IFNULL(CAST(discount.amount AS NUMERIC), 0) AS discount
  ,od.total_discounts
  ,od.financial_status AS payment_status
FROM
  staging.order AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
  raw.Product AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
LEFT JOIN
  UNNEST(line.discount_allocations) AS discount
WHERE od.financial_status IN ('paid') -- only counting sales from paid orders
)

-- same product within an order can have different discounts applied. Need to group down to variant level and sum discounts
,discount_summed AS(
  SELECT
    order_number
    ,line_product_id
    ,line_variant_id
    ,quantity
    ,SUM(discount) AS discount
  FROM all_lines
  GROUP BY order_number, line_product_id, line_variant_id, quantity
)

-- add the summed discount back to respective row in all_lines via a join
,subtotals AS(
SELECT DISTINCT
  d.order_number
  ,d.line_product_id
  ,d.line_variant_id
  ,l.price
  ,d.quantity
  ,d.discount
  ,(price*d.quantity) - d.discount AS subtotal
FROM discount_summed AS d
LEFT JOIN all_lines AS l
  ON 
    l.order_number = d.order_number AND
    l.line_product_id = d.line_product_id AND 
    l.line_variant_id = d.line_variant_id
)

,agg AS (

SELECT
  line_product_id AS product_id
  ,SUM(quantity) AS product_quantity
  ,SUM(subtotal) AS product_rev
FROM subtotals
GROUP BY line_product_id
)

SELECT * FROM agg
-- ORDER BY order_number
    );
  
[0m01:48:30.994834 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:5b353cba-de17-4f5c-bdb7-af569ff6ee69&page=queryresults
[0m01:48:34.089160 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c13f42e0-20a7-4970-b76a-f54bf5ff66b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19FAE3590>]}
[0m01:48:34.089160 [info ] [Thread-1 (]: 4 of 4 OK created sql table model processed.product_sales_agg .................. [[32mCREATE TABLE (19.0 rows, 4.9 KiB processed)[0m in 3.69s]
[0m01:48:34.100601 [debug] [Thread-1 (]: Finished running node model.shopify.product_sales_agg
[0m01:48:34.108687 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:48:34.125854 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:48:34.133812 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m01:48:34.136590 [debug] [MainThread]: Connection 'list_impression-digital_processed' was properly closed.
[0m01:48:34.139142 [debug] [MainThread]: Connection 'model.shopify.product_sales_agg' was properly closed.
[0m01:48:34.141793 [info ] [MainThread]: 
[0m01:48:34.148584 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 13.88 seconds (13.88s).
[0m01:48:34.161109 [debug] [MainThread]: Command end result
[0m01:48:34.248653 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:48:34.255171 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:48:34.272994 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m01:48:34.276093 [info ] [MainThread]: 
[0m01:48:34.279454 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:48:34.282082 [info ] [MainThread]: 
[0m01:48:34.284746 [error] [MainThread]:   Database Error in model order (models\staging\order.sql)
  Name id not found inside pd at [30:27]
  compiled code at target\run\shopify\models\staging\order.sql
[0m01:48:34.287703 [info ] [MainThread]: 
[0m01:48:34.290441 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m01:48:34.295263 [debug] [MainThread]: Command `dbt run` failed at 01:48:34.294225 after 19.04 seconds
[0m01:48:34.297262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C19F96B3E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C1A783F440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C1AA3AE540>]}
[0m01:48:34.297262 [debug] [MainThread]: Flushing usage events
[0m01:48:34.682737 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:51:10.472442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002831B921280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002831E938A70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002831E93B170>]}


============================== 01:51:10.480153 | affc0a7e-109b-4808-9618-220dd8dc584d ==============================
[0m01:51:10.480153 [info ] [MainThread]: Running with dbt=1.9.1
[0m01:51:10.484770 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:51:14.367263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'affc0a7e-109b-4808-9618-220dd8dc584d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002832821F860>]}
[0m01:51:14.533396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'affc0a7e-109b-4808-9618-220dd8dc584d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028319311CD0>]}
[0m01:51:14.536417 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:51:15.544996 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m01:51:15.862634 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:51:15.862634 [debug] [MainThread]: Partial parsing: updated file: shopify://models\staging\product.sql
[0m01:51:16.307785 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m01:51:16.315185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'affc0a7e-109b-4808-9618-220dd8dc584d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028329CF4500>]}
[0m01:51:16.486441 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:51:16.508478 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:51:16.615278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'affc0a7e-109b-4808-9618-220dd8dc584d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028329A0BC50>]}
[0m01:51:16.616954 [info ] [MainThread]: Found 4 models, 490 macros
[0m01:51:16.620499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'affc0a7e-109b-4808-9618-220dd8dc584d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028329A5CFB0>]}
[0m01:51:16.626583 [info ] [MainThread]: 
[0m01:51:16.629018 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:51:16.631870 [info ] [MainThread]: 
[0m01:51:16.637560 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:51:16.665046 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m01:51:16.669750 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:51:17.099963 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:51:17.694144 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_processed'
[0m01:51:17.698035 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:51:17.986345 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_impression-digital_processed, now list_impression-digital_staging)
[0m01:51:17.987342 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:51:18.613323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'affc0a7e-109b-4808-9618-220dd8dc584d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028329B83F50>]}
[0m01:51:18.619544 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:51:18.644358 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m01:51:18.644358 [info ] [Thread-1 (]: 1 of 4 START sql table model staging.customer .................................. [RUN]
[0m01:51:18.652217 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m01:51:18.654218 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m01:51:18.696445 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m01:51:18.702464 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m01:51:18.745582 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m01:51:19.127232 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m01:51:19.130460 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,email
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,first_name
  ,last_name
  ,CAST(orders_count AS INT64) AS orders_count
  ,state
  ,CAST(total_spent AS FLOAT64) AS total_spent
  ,CAST(last_order_id AS STRING) AS last_order_id
  ,note
  ,CAST(verified_email AS BOOL) AS verified_email
  ,multipass_identifier
  ,CAST(tax_exempt AS BOOL) AS tax_exempt
  ,tags
  ,last_order_name
  ,currency
  ,phone
  ,addresses
  ,tax_exemptions
  ,email_marketing_consent
  ,sms_marketing_consent
  ,admin_graphql_api_id
  ,default_address
FROM
  raw.Customer
)

SELECT *
FROM raw_cust
    );
  
[0m01:51:19.541716 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:75a3c413-16f5-46a2-b7d8-8f9031fd184c&page=queryresults
[0m01:51:22.644248 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'affc0a7e-109b-4808-9618-220dd8dc584d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002832954C410>]}
[0m01:51:22.646478 [info ] [Thread-1 (]: 1 of 4 OK created sql table model staging.customer ............................. [[32mCREATE TABLE (13.0 rows, 6.9 KiB processed)[0m in 3.99s]
[0m01:51:22.652225 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m01:51:22.653787 [debug] [Thread-1 (]: Began running node model.shopify.order
[0m01:51:22.659342 [info ] [Thread-1 (]: 2 of 4 START sql table model staging.order ..................................... [RUN]
[0m01:51:22.664556 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.customer, now model.shopify.order)
[0m01:51:22.668369 [debug] [Thread-1 (]: Began compiling node model.shopify.order
[0m01:51:22.887933 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.order"
[0m01:51:22.891799 [debug] [Thread-1 (]: Began executing node model.shopify.order
[0m01:51:22.899955 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:51:23.518437 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.order"
[0m01:51:23.526476 [debug] [Thread-1 (]: On model.shopify.order: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.order"} */

  
    

    create or replace table `impression-digital`.`staging`.`order`
      
    
    

    OPTIONS()
    as (
      


WITH correct_prices AS 
(
SELECT
  od.order_number
  ,line.product_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,CAST(variant.price AS NUMERIC)*CAST(line.quantity AS NUMERIC) AS subtotal
FROM
  raw.Order AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
  staging.product AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
)

,subtotals AS
(
SELECT 
  order_number
  ,SUM(subtotal) AS subtotal
FROM correct_prices
GROUP BY order_number
)

,stage_order AS
(
SELECT 
  o.order_number
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,phone
  ,contact_email
  ,po_number
  ,COALESCE(
    s.subtotal - CAST(o.total_discounts AS NUMERIC),
    CAST(o.current_subtotal_price AS NUMERIC)
  ) AS subtotal
  ,CAST(total_discounts AS NUMERIC) AS total_discounts
  ,s.subtotal - CAST(o.total_discounts AS NUMERIC) AS current_subtotal_price
  -- ,CAST(o.current_subtotal_price AS NUMERIC) AS shopify_total
  ,CAST(total_tax AS NUMERIC) AS total_tax
  ,financial_status
  ,fulfillment_status
  ,note
  ,customer
  ,line_items
  ,refunds
  ,shipping_address
FROM
  raw.Order AS o
LEFT JOIN subtotals AS s
  ON s.order_number = o.order_number

-- ORDER BY o.order_number
)


SELECT *
FROM stage_order
    );
  
[0m01:51:23.824503 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:e025a19c-dde8-45cb-b558-1b07f68341a5&page=queryresults
[0m01:51:23.921915 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:e025a19c-dde8-45cb-b558-1b07f68341a5&page=queryresults
[0m01:51:23.989940 [debug] [Thread-1 (]: Database Error in model order (models\staging\order.sql)
  Name id not found inside pd at [30:27]
  compiled code at target\run\shopify\models\staging\order.sql
[0m01:51:23.992687 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'affc0a7e-109b-4808-9618-220dd8dc584d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028329B7C950>]}
[0m01:51:23.995785 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model staging.order ............................ [[31mERROR[0m in 1.33s]
[0m01:51:23.999071 [debug] [Thread-1 (]: Finished running node model.shopify.order
[0m01:51:24.000983 [debug] [Thread-1 (]: Began running node model.shopify.product
[0m01:51:24.001983 [debug] [Thread-4 (]: Marking all children of 'model.shopify.order' to be skipped because of status 'error'.  Reason: Database Error in model order (models\staging\order.sql)
  Name id not found inside pd at [30:27]
  compiled code at target\run\shopify\models\staging\order.sql.
[0m01:51:24.005382 [info ] [Thread-1 (]: 3 of 4 START sql table model staging.product ................................... [RUN]
[0m01:51:24.008853 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.order, now model.shopify.product)
[0m01:51:24.008853 [debug] [Thread-1 (]: Began compiling node model.shopify.product
[0m01:51:24.021055 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product"
[0m01:51:24.024076 [debug] [Thread-1 (]: Began executing node model.shopify.product
[0m01:51:24.035008 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:51:24.605874 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product"
[0m01:51:24.610049 [debug] [Thread-1 (]: On model.shopify.product: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product"} */

  
    

    create or replace table `impression-digital`.`staging`.`product`
      
    
    

    OPTIONS()
    as (
      

WITH stage_product AS
(
SELECT 
  id
  ,title
  ,body_html
  ,vendor
  ,product_type
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,handle
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', published_at) AS published_at
  ,template_suffix
  ,published_scope
  ,tags
  ,status
  ,admin_graphql_api_id
  ,variants
  ,options
  ,images
  ,image
FROM raw.Product
)

SELECT * FROM stage_product
    );
  
[0m01:51:24.999694 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:f0bf6af3-e7c6-438d-90a7-cabd5c902429&page=queryresults
[0m01:51:28.231062 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'affc0a7e-109b-4808-9618-220dd8dc584d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002832A43DA00>]}
[0m01:51:28.233523 [info ] [Thread-1 (]: 3 of 4 OK created sql table model staging.product .............................. [[32mCREATE TABLE (47.0 rows, 119.6 KiB processed)[0m in 4.22s]
[0m01:51:28.238824 [debug] [Thread-1 (]: Finished running node model.shopify.product
[0m01:51:28.241015 [debug] [Thread-1 (]: Began running node model.shopify.product_sales_agg
[0m01:51:28.243012 [info ] [Thread-1 (]: 4 of 4 START sql table model processed.product_sales_agg ....................... [RUN]
[0m01:51:28.249203 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.product, now model.shopify.product_sales_agg)
[0m01:51:28.250985 [debug] [Thread-1 (]: Began compiling node model.shopify.product_sales_agg
[0m01:51:28.260710 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product_sales_agg"
[0m01:51:28.264409 [debug] [Thread-1 (]: Began executing node model.shopify.product_sales_agg
[0m01:51:28.273105 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:51:28.765874 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product_sales_agg"
[0m01:51:28.771745 [debug] [Thread-1 (]: On model.shopify.product_sales_agg: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product_sales_agg"} */

  
    

    create or replace table `impression-digital`.`processed`.`product_sales_agg`
      
    
    

    OPTIONS()
    as (
      


WITH all_lines AS (

SELECT 
  od.order_number
  ,line.product_id AS line_product_id
  ,line.variant_id AS line_variant_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,IFNULL(CAST(discount.amount AS NUMERIC), 0) AS discount
  ,od.total_discounts
  ,od.financial_status AS payment_status
FROM
  staging.order AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
  raw.Product AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
LEFT JOIN
  UNNEST(line.discount_allocations) AS discount
WHERE od.financial_status IN ('paid') -- only counting sales from paid orders
)

-- same product within an order can have different discounts applied. Need to group down to variant level and sum discounts
,discount_summed AS(
  SELECT
    order_number
    ,line_product_id
    ,line_variant_id
    ,quantity
    ,SUM(discount) AS discount
  FROM all_lines
  GROUP BY order_number, line_product_id, line_variant_id, quantity
)

-- add the summed discount back to respective row in all_lines via a join
,subtotals AS(
SELECT DISTINCT
  d.order_number
  ,d.line_product_id
  ,d.line_variant_id
  ,l.price
  ,d.quantity
  ,d.discount
  ,(price*d.quantity) - d.discount AS subtotal
FROM discount_summed AS d
LEFT JOIN all_lines AS l
  ON 
    l.order_number = d.order_number AND
    l.line_product_id = d.line_product_id AND 
    l.line_variant_id = d.line_variant_id
)

,agg AS (

SELECT
  line_product_id AS product_id
  ,SUM(quantity) AS product_quantity
  ,SUM(subtotal) AS product_rev
FROM subtotals
GROUP BY line_product_id
)

SELECT * FROM agg
-- ORDER BY order_number
    );
  
[0m01:51:29.136279 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:937161aa-6d26-4980-8f29-80555b9779d1&page=queryresults
[0m01:51:32.045723 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'affc0a7e-109b-4808-9618-220dd8dc584d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028329688BC0>]}
[0m01:51:32.045723 [info ] [Thread-1 (]: 4 of 4 OK created sql table model processed.product_sales_agg .................. [[32mCREATE TABLE (19.0 rows, 4.9 KiB processed)[0m in 3.80s]
[0m01:51:32.056065 [debug] [Thread-1 (]: Finished running node model.shopify.product_sales_agg
[0m01:51:32.065448 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:51:32.077674 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:51:32.079683 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m01:51:32.079683 [debug] [MainThread]: Connection 'list_impression-digital_staging' was properly closed.
[0m01:51:32.086652 [debug] [MainThread]: Connection 'model.shopify.product_sales_agg' was properly closed.
[0m01:51:32.089792 [info ] [MainThread]: 
[0m01:51:32.091785 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 15.45 seconds (15.45s).
[0m01:51:32.098956 [debug] [MainThread]: Command end result
[0m01:51:32.199847 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:51:32.200849 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:51:32.222086 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m01:51:32.223085 [info ] [MainThread]: 
[0m01:51:32.225186 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:51:32.227724 [info ] [MainThread]: 
[0m01:51:32.233058 [error] [MainThread]:   Database Error in model order (models\staging\order.sql)
  Name id not found inside pd at [30:27]
  compiled code at target\run\shopify\models\staging\order.sql
[0m01:51:32.236007 [info ] [MainThread]: 
[0m01:51:32.238008 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m01:51:32.242930 [debug] [MainThread]: Command `dbt run` failed at 01:51:32.242930 after 22.13 seconds
[0m01:51:32.244613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002831B921280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028329CF7770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002832A430E60>]}
[0m01:51:32.246676 [debug] [MainThread]: Flushing usage events
[0m01:51:32.660022 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:56:04.014162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CBEE90FE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CBEE91220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CBEE914C0>]}


============================== 01:56:04.024813 | 3f95d887-f3b2-4c49-86d9-5c2c77987b9c ==============================
[0m01:56:04.024813 [info ] [MainThread]: Running with dbt=1.9.1
[0m01:56:04.027030 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:56:08.161184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3f95d887-f3b2-4c49-86d9-5c2c77987b9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CC7557860>]}
[0m01:56:08.323035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3f95d887-f3b2-4c49-86d9-5c2c77987b9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CC913B350>]}
[0m01:56:08.332228 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:56:09.256818 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m01:56:09.617387 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:56:09.617387 [debug] [MainThread]: Partial parsing: updated file: shopify://models\staging\order.sql
[0m01:56:09.983839 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.shopify.order' (models\staging\order.sql) depends on a node named 'staging_product' which was not found
[0m01:56:09.989032 [debug] [MainThread]: Command `dbt run` failed at 01:56:09.989032 after 6.32 seconds
[0m01:56:09.989032 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CBEAD1430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CBE2FF7A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021CC942C200>]}
[0m01:56:09.990710 [debug] [MainThread]: Flushing usage events
[0m01:56:10.422602 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:57:00.634626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025E281804A0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025E27EE6750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025E28180620>]}


============================== 01:57:00.640746 | 05d7b487-0a6b-48d7-b681-35238123ed2b ==============================
[0m01:57:00.640746 [info ] [MainThread]: Running with dbt=1.9.1
[0m01:57:00.640746 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'debug': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:57:04.068460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '05d7b487-0a6b-48d7-b681-35238123ed2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025E30F6BEC0>]}
[0m01:57:04.172274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '05d7b487-0a6b-48d7-b681-35238123ed2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025E276467B0>]}
[0m01:57:04.181806 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m01:57:04.979312 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m01:57:05.251700 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:57:05.251700 [debug] [MainThread]: Partial parsing: updated file: shopify://models\staging\order.sql
[0m01:57:05.689992 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m01:57:05.711394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '05d7b487-0a6b-48d7-b681-35238123ed2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025E32A5C380>]}
[0m01:57:05.849398 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:57:05.862570 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:57:05.962758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '05d7b487-0a6b-48d7-b681-35238123ed2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025E32726E10>]}
[0m01:57:05.964393 [info ] [MainThread]: Found 4 models, 490 macros
[0m01:57:05.966597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '05d7b487-0a6b-48d7-b681-35238123ed2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025E3295ED20>]}
[0m01:57:05.972014 [info ] [MainThread]: 
[0m01:57:05.974010 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m01:57:05.975061 [info ] [MainThread]: 
[0m01:57:05.978080 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:57:05.988056 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m01:57:05.991734 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:57:06.559236 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:57:07.271137 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_staging'
[0m01:57:07.273181 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:57:07.767380 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_impression-digital_staging, now list_impression-digital_processed)
[0m01:57:07.774599 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:57:08.060733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '05d7b487-0a6b-48d7-b681-35238123ed2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025E25E7DA30>]}
[0m01:57:08.061779 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:57:08.087529 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m01:57:08.087529 [info ] [Thread-1 (]: 1 of 4 START sql table model staging.customer .................................. [RUN]
[0m01:57:08.098454 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m01:57:08.102579 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m01:57:08.157518 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m01:57:08.160244 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m01:57:08.198469 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m01:57:08.547871 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m01:57:08.551695 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,email
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,first_name
  ,last_name
  ,CAST(orders_count AS INT64) AS orders_count
  ,state
  ,CAST(total_spent AS FLOAT64) AS total_spent
  ,CAST(last_order_id AS STRING) AS last_order_id
  ,note
  ,CAST(verified_email AS BOOL) AS verified_email
  ,multipass_identifier
  ,CAST(tax_exempt AS BOOL) AS tax_exempt
  ,tags
  ,last_order_name
  ,currency
  ,phone
  ,addresses
  ,tax_exemptions
  ,email_marketing_consent
  ,sms_marketing_consent
  ,admin_graphql_api_id
  ,default_address
FROM
  raw.Customer
)

SELECT *
FROM raw_cust
    );
  
[0m01:57:08.934251 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:5372171c-a389-4774-b0b9-17f95208570e&page=queryresults
[0m01:57:12.483639 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05d7b487-0a6b-48d7-b681-35238123ed2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025E327DC860>]}
[0m01:57:12.486498 [info ] [Thread-1 (]: 1 of 4 OK created sql table model staging.customer ............................. [[32mCREATE TABLE (13.0 rows, 6.9 KiB processed)[0m in 4.38s]
[0m01:57:12.492896 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m01:57:12.492896 [debug] [Thread-1 (]: Began running node model.shopify.product
[0m01:57:12.492896 [info ] [Thread-1 (]: 2 of 4 START sql table model staging.product ................................... [RUN]
[0m01:57:12.505856 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.customer, now model.shopify.product)
[0m01:57:12.509046 [debug] [Thread-1 (]: Began compiling node model.shopify.product
[0m01:57:12.693608 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product"
[0m01:57:12.698187 [debug] [Thread-1 (]: Began executing node model.shopify.product
[0m01:57:12.704182 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:57:13.006009 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product"
[0m01:57:13.009482 [debug] [Thread-1 (]: On model.shopify.product: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product"} */

  
    

    create or replace table `impression-digital`.`staging`.`product`
      
    
    

    OPTIONS()
    as (
      

WITH stage_product AS
(
SELECT 
  id
  ,title
  ,body_html
  ,vendor
  ,product_type
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,handle
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', published_at) AS published_at
  ,template_suffix
  ,published_scope
  ,tags
  ,status
  ,admin_graphql_api_id
  ,variants
  ,options
  ,images
  ,image
FROM raw.Product
)

SELECT * FROM stage_product
    );
  
[0m01:57:13.505039 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:004c8444-96af-4107-bd55-c15ac27181eb&page=queryresults
[0m01:57:16.792726 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05d7b487-0a6b-48d7-b681-35238123ed2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025E328F1010>]}
[0m01:57:16.793761 [info ] [Thread-1 (]: 2 of 4 OK created sql table model staging.product .............................. [[32mCREATE TABLE (47.0 rows, 119.6 KiB processed)[0m in 4.29s]
[0m01:57:16.796443 [debug] [Thread-1 (]: Finished running node model.shopify.product
[0m01:57:16.799276 [debug] [Thread-1 (]: Began running node model.shopify.product_sales_agg
[0m01:57:16.801737 [info ] [Thread-1 (]: 3 of 4 START sql table model processed.product_sales_agg ....................... [RUN]
[0m01:57:16.804178 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.product, now model.shopify.product_sales_agg)
[0m01:57:16.806011 [debug] [Thread-1 (]: Began compiling node model.shopify.product_sales_agg
[0m01:57:16.815207 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product_sales_agg"
[0m01:57:16.816661 [debug] [Thread-1 (]: Began executing node model.shopify.product_sales_agg
[0m01:57:16.827116 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:57:17.096561 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product_sales_agg"
[0m01:57:17.107605 [debug] [Thread-1 (]: On model.shopify.product_sales_agg: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product_sales_agg"} */

  
    

    create or replace table `impression-digital`.`processed`.`product_sales_agg`
      
    
    

    OPTIONS()
    as (
      


WITH all_lines AS (

SELECT 
  od.order_number
  ,line.product_id AS line_product_id
  ,line.variant_id AS line_variant_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,IFNULL(CAST(discount.amount AS NUMERIC), 0) AS discount
  ,od.total_discounts
  ,od.financial_status AS payment_status
FROM
  staging.order AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
  raw.Product AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
LEFT JOIN
  UNNEST(line.discount_allocations) AS discount
WHERE od.financial_status IN ('paid') -- only counting sales from paid orders
)

-- same product within an order can have different discounts applied. Need to group down to variant level and sum discounts
,discount_summed AS(
  SELECT
    order_number
    ,line_product_id
    ,line_variant_id
    ,quantity
    ,SUM(discount) AS discount
  FROM all_lines
  GROUP BY order_number, line_product_id, line_variant_id, quantity
)

-- add the summed discount back to respective row in all_lines via a join
,subtotals AS(
SELECT DISTINCT
  d.order_number
  ,d.line_product_id
  ,d.line_variant_id
  ,l.price
  ,d.quantity
  ,d.discount
  ,(price*d.quantity) - d.discount AS subtotal
FROM discount_summed AS d
LEFT JOIN all_lines AS l
  ON 
    l.order_number = d.order_number AND
    l.line_product_id = d.line_product_id AND 
    l.line_variant_id = d.line_variant_id
)

,agg AS (

SELECT
  line_product_id AS product_id
  ,SUM(quantity) AS product_quantity
  ,SUM(subtotal) AS product_rev
FROM subtotals
GROUP BY line_product_id
)

SELECT * FROM agg
-- ORDER BY order_number
    );
  
[0m01:57:17.512890 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:5f44b111-e3a3-47a7-8ccd-0ca2e5366799&page=queryresults
[0m01:57:21.116349 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05d7b487-0a6b-48d7-b681-35238123ed2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025E3054C410>]}
[0m01:57:21.126890 [info ] [Thread-1 (]: 3 of 4 OK created sql table model processed.product_sales_agg .................. [[32mCREATE TABLE (19.0 rows, 4.9 KiB processed)[0m in 4.31s]
[0m01:57:21.134959 [debug] [Thread-1 (]: Finished running node model.shopify.product_sales_agg
[0m01:57:21.140058 [debug] [Thread-1 (]: Began running node model.shopify.order
[0m01:57:21.145063 [info ] [Thread-1 (]: 4 of 4 START sql table model staging.order ..................................... [RUN]
[0m01:57:21.152432 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.product_sales_agg, now model.shopify.order)
[0m01:57:21.154438 [debug] [Thread-1 (]: Began compiling node model.shopify.order
[0m01:57:21.169905 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.order"
[0m01:57:21.181646 [debug] [Thread-1 (]: Began executing node model.shopify.order
[0m01:57:21.191325 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:57:21.900769 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.order"
[0m01:57:21.910218 [debug] [Thread-1 (]: On model.shopify.order: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.order"} */

  
    

    create or replace table `impression-digital`.`staging`.`order`
      
    
    

    OPTIONS()
    as (
      


WITH correct_prices AS 
(
SELECT
  od.order_number
  ,line.product_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,CAST(variant.price AS NUMERIC)*CAST(line.quantity AS NUMERIC) AS subtotal
FROM
  raw.Order AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
  `impression-digital`.`staging`.`product` AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
)

,subtotals AS
(
SELECT 
  order_number
  ,SUM(subtotal) AS subtotal
FROM correct_prices
GROUP BY order_number
)

,stage_order AS
(
SELECT 
  o.order_number
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,phone
  ,contact_email
  ,po_number
  ,COALESCE(
    s.subtotal - CAST(o.total_discounts AS NUMERIC),
    CAST(o.current_subtotal_price AS NUMERIC)
  ) AS subtotal
  ,CAST(total_discounts AS NUMERIC) AS total_discounts
  ,s.subtotal - CAST(o.total_discounts AS NUMERIC) AS current_subtotal_price
  -- ,CAST(o.current_subtotal_price AS NUMERIC) AS shopify_total
  ,CAST(total_tax AS NUMERIC) AS total_tax
  ,financial_status
  ,fulfillment_status
  ,note
  ,customer
  ,line_items
  ,refunds
  ,shipping_address
FROM
  raw.Order AS o
LEFT JOIN subtotals AS s
  ON s.order_number = o.order_number

-- ORDER BY o.order_number
)


SELECT *
FROM stage_order
    );
  
[0m01:57:22.212815 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:f5df8853-d1b1-42bb-84da-ae08183a9302&page=queryresults
[0m01:57:25.503453 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05d7b487-0a6b-48d7-b681-35238123ed2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025E323FB680>]}
[0m01:57:25.503453 [info ] [Thread-1 (]: 4 of 4 OK created sql table model staging.order ................................ [[32mCREATE TABLE (30.0 rows, 34.6 KiB processed)[0m in 4.35s]
[0m01:57:25.516261 [debug] [Thread-1 (]: Finished running node model.shopify.order
[0m01:57:25.525676 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:57:25.537149 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:57:25.538148 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m01:57:25.543470 [debug] [MainThread]: Connection 'list_impression-digital_processed' was properly closed.
[0m01:57:25.547983 [debug] [MainThread]: Connection 'model.shopify.order' was properly closed.
[0m01:57:25.551234 [info ] [MainThread]: 
[0m01:57:25.553954 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 19.57 seconds (19.57s).
[0m01:57:25.560369 [debug] [MainThread]: Command end result
[0m01:57:25.644424 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m01:57:25.650622 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m01:57:25.670289 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m01:57:25.671290 [info ] [MainThread]: 
[0m01:57:25.674969 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:57:25.677194 [info ] [MainThread]: 
[0m01:57:25.681084 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m01:57:25.687789 [debug] [MainThread]: Command `dbt run` succeeded at 01:57:25.687789 after 25.30 seconds
[0m01:57:25.687789 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025E32983620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025E32A29D90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025E32A29A90>]}
[0m01:57:25.696010 [debug] [MainThread]: Flushing usage events
[0m01:57:26.109705 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:42:23.624677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220C3685F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220C3B3E3C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220C58BDA60>]}


============================== 02:42:23.635536 | 67339507-abdb-4b56-8f06-21f10a1b4778 ==============================
[0m02:42:23.635536 [info ] [MainThread]: Running with dbt=1.9.1
[0m02:42:23.637352 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m02:42:27.827923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '67339507-abdb-4b56-8f06-21f10a1b4778', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220CF064EF0>]}
[0m02:42:27.925158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '67339507-abdb-4b56-8f06-21f10a1b4778', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220C38538C0>]}
[0m02:42:27.933523 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m02:42:28.907583 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m02:42:29.301048 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:42:29.302660 [debug] [MainThread]: Partial parsing: updated file: shopify://models\staging\order.sql
[0m02:42:29.889578 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m02:42:29.906974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '67339507-abdb-4b56-8f06-21f10a1b4778', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220D06BBB90>]}
[0m02:42:30.067773 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m02:42:30.080434 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m02:42:30.194712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '67339507-abdb-4b56-8f06-21f10a1b4778', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220D0A6AC60>]}
[0m02:42:30.196905 [info ] [MainThread]: Found 4 models, 490 macros
[0m02:42:30.198902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '67339507-abdb-4b56-8f06-21f10a1b4778', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220D0D3A750>]}
[0m02:42:30.210062 [info ] [MainThread]: 
[0m02:42:30.229512 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m02:42:30.239123 [info ] [MainThread]: 
[0m02:42:30.242817 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:42:30.260589 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m02:42:30.264965 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:42:30.860230 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:42:31.287589 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_processed'
[0m02:42:31.289523 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:42:31.884540 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_impression-digital_processed, now list_impression-digital_staging)
[0m02:42:31.887248 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:42:32.282956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '67339507-abdb-4b56-8f06-21f10a1b4778', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220CF28B230>]}
[0m02:42:32.284036 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:42:32.296505 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m02:42:32.299515 [info ] [Thread-1 (]: 1 of 4 START sql table model staging.customer .................................. [RUN]
[0m02:42:32.302791 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.customer'
[0m02:42:32.303784 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m02:42:32.340922 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m02:42:32.340922 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m02:42:32.386549 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m02:42:32.813115 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m02:42:32.819958 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH raw_cust AS (

SELECT
  id
  ,email
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,first_name
  ,last_name
  ,CAST(orders_count AS INT64) AS orders_count
  ,state
  ,CAST(total_spent AS FLOAT64) AS total_spent
  ,CAST(last_order_id AS STRING) AS last_order_id
  ,note
  ,CAST(verified_email AS BOOL) AS verified_email
  ,multipass_identifier
  ,CAST(tax_exempt AS BOOL) AS tax_exempt
  ,tags
  ,last_order_name
  ,currency
  ,phone
  ,addresses
  ,tax_exemptions
  ,email_marketing_consent
  ,sms_marketing_consent
  ,admin_graphql_api_id
  ,default_address
FROM
  raw.Customer
)

SELECT *
FROM raw_cust
    );
  
[0m02:42:33.429555 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:08ccf2db-2c7c-488d-802e-8d61e9259a17&page=queryresults
[0m02:42:37.083193 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '67339507-abdb-4b56-8f06-21f10a1b4778', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220C5914620>]}
[0m02:42:37.086191 [info ] [Thread-1 (]: 1 of 4 OK created sql table model staging.customer ............................. [[32mCREATE TABLE (13.0 rows, 6.9 KiB processed)[0m in 4.77s]
[0m02:42:37.091274 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m02:42:37.093311 [debug] [Thread-1 (]: Began running node model.shopify.product
[0m02:42:37.096274 [info ] [Thread-1 (]: 2 of 4 START sql table model staging.product ................................... [RUN]
[0m02:42:37.103357 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.customer, now model.shopify.product)
[0m02:42:37.108597 [debug] [Thread-1 (]: Began compiling node model.shopify.product
[0m02:42:37.251274 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product"
[0m02:42:37.256272 [debug] [Thread-1 (]: Began executing node model.shopify.product
[0m02:42:37.266272 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:42:37.909148 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product"
[0m02:42:37.917359 [debug] [Thread-1 (]: On model.shopify.product: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product"} */

  
    

    create or replace table `impression-digital`.`staging`.`product`
      
    
    

    OPTIONS()
    as (
      

WITH stage_product AS
(
SELECT 
  id
  ,title
  ,body_html
  ,vendor
  ,product_type
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,handle
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', published_at) AS published_at
  ,template_suffix
  ,published_scope
  ,tags
  ,status
  ,admin_graphql_api_id
  ,variants
  ,options
  ,images
  ,image
FROM raw.Product
)

SELECT * FROM stage_product
    );
  
[0m02:42:38.198432 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:daa4dbc8-272d-4fa5-a1a5-d26a824f8739&page=queryresults
[0m02:42:40.619394 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '67339507-abdb-4b56-8f06-21f10a1b4778', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220D0DFB0B0>]}
[0m02:42:40.619394 [info ] [Thread-1 (]: 2 of 4 OK created sql table model staging.product .............................. [[32mCREATE TABLE (47.0 rows, 119.6 KiB processed)[0m in 3.52s]
[0m02:42:40.631268 [debug] [Thread-1 (]: Finished running node model.shopify.product
[0m02:42:40.637879 [debug] [Thread-1 (]: Began running node model.shopify.product_sales_agg
[0m02:42:40.645130 [info ] [Thread-1 (]: 3 of 4 START sql table model processed.product_sales_agg ....................... [RUN]
[0m02:42:40.652482 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.product, now model.shopify.product_sales_agg)
[0m02:42:40.659892 [debug] [Thread-1 (]: Began compiling node model.shopify.product_sales_agg
[0m02:42:40.685117 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product_sales_agg"
[0m02:42:40.695259 [debug] [Thread-1 (]: Began executing node model.shopify.product_sales_agg
[0m02:42:40.704477 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:42:41.112966 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product_sales_agg"
[0m02:42:41.112966 [debug] [Thread-1 (]: On model.shopify.product_sales_agg: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product_sales_agg"} */

  
    

    create or replace table `impression-digital`.`processed`.`product_sales_agg`
      
    
    

    OPTIONS()
    as (
      


WITH all_lines AS (

SELECT 
  od.order_number
  ,line.product_id AS line_product_id
  ,line.variant_id AS line_variant_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,IFNULL(CAST(discount.amount AS NUMERIC), 0) AS discount
  ,od.total_discounts
  ,od.financial_status AS payment_status
FROM
  staging.order AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
  raw.Product AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
LEFT JOIN
  UNNEST(line.discount_allocations) AS discount
WHERE od.financial_status IN ('paid') -- only counting sales from paid orders
)

-- same product within an order can have different discounts applied. Need to group down to variant level and sum discounts
,discount_summed AS(
  SELECT
    order_number
    ,line_product_id
    ,line_variant_id
    ,quantity
    ,SUM(discount) AS discount
  FROM all_lines
  GROUP BY order_number, line_product_id, line_variant_id, quantity
)

-- add the summed discount back to respective row in all_lines via a join
,subtotals AS(
SELECT DISTINCT
  d.order_number
  ,d.line_product_id
  ,d.line_variant_id
  ,l.price
  ,d.quantity
  ,d.discount
  ,(price*d.quantity) - d.discount AS subtotal
FROM discount_summed AS d
LEFT JOIN all_lines AS l
  ON 
    l.order_number = d.order_number AND
    l.line_product_id = d.line_product_id AND 
    l.line_variant_id = d.line_variant_id
)

,agg AS (

SELECT
  line_product_id AS product_id
  ,SUM(quantity) AS product_quantity
  ,SUM(subtotal) AS product_rev
FROM subtotals
GROUP BY line_product_id
)

SELECT * FROM agg
-- ORDER BY order_number
    );
  
[0m02:42:41.445150 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:05889969-abea-44b8-9ec9-206b0d88e76a&page=queryresults
[0m02:42:44.687365 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '67339507-abdb-4b56-8f06-21f10a1b4778', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220C5914620>]}
[0m02:42:44.691013 [info ] [Thread-1 (]: 3 of 4 OK created sql table model processed.product_sales_agg .................. [[32mCREATE TABLE (19.0 rows, 4.9 KiB processed)[0m in 4.03s]
[0m02:42:44.699406 [debug] [Thread-1 (]: Finished running node model.shopify.product_sales_agg
[0m02:42:44.705238 [debug] [Thread-1 (]: Began running node model.shopify.order
[0m02:42:44.711826 [info ] [Thread-1 (]: 4 of 4 START sql table model staging.order ..................................... [RUN]
[0m02:42:44.720960 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.product_sales_agg, now model.shopify.order)
[0m02:42:44.724338 [debug] [Thread-1 (]: Began compiling node model.shopify.order
[0m02:42:44.748554 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.order"
[0m02:42:44.763877 [debug] [Thread-1 (]: Began executing node model.shopify.order
[0m02:42:44.773742 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:42:45.107282 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.order"
[0m02:42:45.116925 [debug] [Thread-1 (]: On model.shopify.order: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.order"} */

  
    

    create or replace table `impression-digital`.`staging`.`order`
      
    
    

    OPTIONS()
    as (
      


WITH correct_prices AS 
(
    SELECT
        od.order_number
        ,line.product_id
        ,CAST(variant.price AS NUMERIC) AS price
        ,CAST(line.quantity AS NUMERIC) AS quantity
        ,CAST(variant.price AS NUMERIC)*CAST(line.quantity AS NUMERIC) AS subtotal
    FROM raw.Order AS od
    LEFT JOIN UNNEST(od.line_items) AS line
    LEFT JOIN `impression-digital`.`staging`.`product` AS pd
        ON line.product_id = pd.id
    LEFT JOIN UNNEST(pd.variants) AS variant
        ON line.variant_id = variant.id
)

,shipping_price AS
(
    SELECT 
        order_number
        ,CAST(ship.price AS NUMERIC) AS price
    FROM raw.Order,
    UNNEST(shipping_lines) AS ship 
)

,subtotals AS
(
SELECT 
  order_number
  ,SUM(subtotal) AS subtotal
FROM correct_prices
GROUP BY order_number
)

,stage_order AS
(
SELECT 
  o.order_number
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,phone
  ,contact_email
  ,po_number
  ,COALESCE(s.subtotal, CAST(o.current_subtotal_price AS NUMERIC)) AS subtotal
  ,CAST(total_discounts AS NUMERIC) AS total_discounts
  ,COALESCE(s.subtotal, CAST(o.current_subtotal_price AS NUMERIC)) - CAST(o.total_discounts AS NUMERIC) AS current_subtotal_price
  ,IFNULL(sp.price,0) AS shipping_cost
  ,COALESCE(s.subtotal, CAST(o.current_subtotal_price AS NUMERIC)) - CAST(o.total_discounts AS NUMERIC) + IFNULL(sp.price,0) AS total_price 
  -- ,CAST(o.current_subtotal_price AS NUMERIC) AS shopify_total
  -- ,o.total_price
  ,CAST(total_tax AS NUMERIC) AS total_tax
  ,financial_status
  ,fulfillment_status
  ,note
  ,customer
  ,line_items
  ,refunds
  ,shipping_address
FROM
  raw.Order AS o
LEFT JOIN shipping_price AS sp
  ON o.order_number = sp.order_number
LEFT JOIN subtotals AS s
  ON s.order_number = o.order_number


-- ORDER BY o.order_number
)


SELECT *
FROM stage_order
    );
  
[0m02:42:45.410372 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:de11177d-a32e-4ade-af2d-5d25e913e44f&page=queryresults
[0m02:42:48.336019 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '67339507-abdb-4b56-8f06-21f10a1b4778', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220D0BD1970>]}
[0m02:42:48.339019 [info ] [Thread-1 (]: 4 of 4 OK created sql table model staging.order ................................ [[32mCREATE TABLE (30.0 rows, 34.7 KiB processed)[0m in 3.62s]
[0m02:42:48.352727 [debug] [Thread-1 (]: Finished running node model.shopify.order
[0m02:42:48.359097 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:42:48.370406 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:42:48.375151 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m02:42:48.378359 [debug] [MainThread]: Connection 'list_impression-digital_staging' was properly closed.
[0m02:42:48.379366 [debug] [MainThread]: Connection 'model.shopify.order' was properly closed.
[0m02:42:48.379366 [info ] [MainThread]: 
[0m02:42:48.386781 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 18.14 seconds (18.14s).
[0m02:42:48.394941 [debug] [MainThread]: Command end result
[0m02:42:48.496430 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m02:42:48.503669 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m02:42:48.534318 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m02:42:48.535602 [info ] [MainThread]: 
[0m02:42:48.538273 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:42:48.541490 [info ] [MainThread]: 
[0m02:42:48.543625 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m02:42:48.547994 [debug] [MainThread]: Command `dbt run` succeeded at 02:42:48.547994 after 25.28 seconds
[0m02:42:48.549515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220D0D19AF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220D1465E80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220D0E19B20>]}
[0m02:42:48.552083 [debug] [MainThread]: Flushing usage events
[0m02:42:48.982903 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m02:50:54.474810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C3AC5C60C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C3AEB4E1E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C3AEB4C770>]}


============================== 02:50:54.486410 | 8412a069-f856-438b-8506-0df2691e9e1c ==============================
[0m02:50:54.486410 [info ] [MainThread]: Running with dbt=1.9.1
[0m02:50:54.488839 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m02:50:58.051921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8412a069-f856-438b-8506-0df2691e9e1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C3B9612120>]}
[0m02:50:58.157408 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8412a069-f856-438b-8506-0df2691e9e1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C3B81AB740>]}
[0m02:50:58.160606 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m02:50:59.013408 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m02:50:59.361180 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m02:50:59.361180 [debug] [MainThread]: Partial parsing: updated file: shopify://models\staging\customer.sql
[0m02:50:59.782306 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m02:50:59.789505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8412a069-f856-438b-8506-0df2691e9e1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C3B9C808C0>]}
[0m02:50:59.945258 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m02:50:59.953618 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m02:51:00.060717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8412a069-f856-438b-8506-0df2691e9e1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C3B999BD70>]}
[0m02:51:00.062044 [info ] [MainThread]: Found 4 models, 490 macros
[0m02:51:00.064647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8412a069-f856-438b-8506-0df2691e9e1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C3B9C5CCB0>]}
[0m02:51:00.067968 [info ] [MainThread]: 
[0m02:51:00.074399 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m02:51:00.081450 [info ] [MainThread]: 
[0m02:51:00.090736 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m02:51:00.114447 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m02:51:00.116844 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:51:00.595693 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:51:00.934512 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_processed'
[0m02:51:00.934512 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m02:51:01.273649 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_impression-digital_processed, now list_impression-digital_staging)
[0m02:51:01.278112 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m02:51:01.594692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8412a069-f856-438b-8506-0df2691e9e1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C3B9A7CCB0>]}
[0m02:51:01.596692 [debug] [MainThread]: Opening a new connection, currently in state init
[0m02:51:01.604941 [debug] [Thread-1 (]: Began running node model.shopify.product
[0m02:51:01.605936 [info ] [Thread-1 (]: 1 of 4 START sql table model staging.product ................................... [RUN]
[0m02:51:01.609604 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.product'
[0m02:51:01.611603 [debug] [Thread-1 (]: Began compiling node model.shopify.product
[0m02:51:01.640106 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product"
[0m02:51:01.644969 [debug] [Thread-1 (]: Began executing node model.shopify.product
[0m02:51:01.687125 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m02:51:02.103477 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product"
[0m02:51:02.103477 [debug] [Thread-1 (]: On model.shopify.product: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product"} */

  
    

    create or replace table `impression-digital`.`staging`.`product`
      
    
    

    OPTIONS()
    as (
      

WITH stage_product AS
(
SELECT 
  id
  ,title
  ,body_html
  ,vendor
  ,product_type
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,handle
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', published_at) AS published_at
  ,template_suffix
  ,published_scope
  ,tags
  ,status
  ,admin_graphql_api_id
  ,variants
  ,options
  ,images
  ,image
FROM raw.Product
)

SELECT * FROM stage_product
    );
  
[0m02:51:02.420956 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:f8a103cb-62a6-4e42-9cdc-89d900159897&page=queryresults
[0m02:51:05.916515 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8412a069-f856-438b-8506-0df2691e9e1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C3AE84C710>]}
[0m02:51:05.918515 [info ] [Thread-1 (]: 1 of 4 OK created sql table model staging.product .............................. [[32mCREATE TABLE (47.0 rows, 119.6 KiB processed)[0m in 4.30s]
[0m02:51:05.922559 [debug] [Thread-1 (]: Finished running node model.shopify.product
[0m02:51:05.924513 [debug] [Thread-1 (]: Began running node model.shopify.product_sales_agg
[0m02:51:05.926515 [info ] [Thread-1 (]: 2 of 4 START sql table model processed.product_sales_agg ....................... [RUN]
[0m02:51:05.929513 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.product, now model.shopify.product_sales_agg)
[0m02:51:05.931516 [debug] [Thread-1 (]: Began compiling node model.shopify.product_sales_agg
[0m02:51:06.065068 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product_sales_agg"
[0m02:51:06.071028 [debug] [Thread-1 (]: Began executing node model.shopify.product_sales_agg
[0m02:51:06.074577 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:51:06.393763 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product_sales_agg"
[0m02:51:06.393763 [debug] [Thread-1 (]: On model.shopify.product_sales_agg: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product_sales_agg"} */

  
    

    create or replace table `impression-digital`.`processed`.`product_sales_agg`
      
    
    

    OPTIONS()
    as (
      


WITH all_lines AS (

SELECT 
  od.order_number
  ,line.product_id AS line_product_id
  ,line.variant_id AS line_variant_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,IFNULL(CAST(discount.amount AS NUMERIC), 0) AS discount
  ,od.total_discounts
  ,od.financial_status AS payment_status
FROM
  staging.order AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
  raw.Product AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
LEFT JOIN
  UNNEST(line.discount_allocations) AS discount
WHERE od.financial_status IN ('paid') -- only counting sales from paid orders
)

-- same product within an order can have different discounts applied. Need to group down to variant level and sum discounts
,discount_summed AS(
  SELECT
    order_number
    ,line_product_id
    ,line_variant_id
    ,quantity
    ,SUM(discount) AS discount
  FROM all_lines
  GROUP BY order_number, line_product_id, line_variant_id, quantity
)

-- add the summed discount back to respective row in all_lines via a join
,subtotals AS(
SELECT DISTINCT
  d.order_number
  ,d.line_product_id
  ,d.line_variant_id
  ,l.price
  ,d.quantity
  ,d.discount
  ,(price*d.quantity) - d.discount AS subtotal
FROM discount_summed AS d
LEFT JOIN all_lines AS l
  ON 
    l.order_number = d.order_number AND
    l.line_product_id = d.line_product_id AND 
    l.line_variant_id = d.line_variant_id
)

,agg AS (

SELECT
  line_product_id AS product_id
  ,SUM(quantity) AS product_quantity
  ,SUM(subtotal) AS product_rev
FROM subtotals
GROUP BY line_product_id
)

SELECT * FROM agg
-- ORDER BY order_number
    );
  
[0m02:51:06.735361 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:eae865ae-fdc1-4e9e-8b9b-120de6ab24ad&page=queryresults
[0m02:51:10.235463 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8412a069-f856-438b-8506-0df2691e9e1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C3BA3CD880>]}
[0m02:51:10.238112 [info ] [Thread-1 (]: 2 of 4 OK created sql table model processed.product_sales_agg .................. [[32mCREATE TABLE (19.0 rows, 4.9 KiB processed)[0m in 4.31s]
[0m02:51:10.242676 [debug] [Thread-1 (]: Finished running node model.shopify.product_sales_agg
[0m02:51:10.245760 [debug] [Thread-1 (]: Began running node model.shopify.order
[0m02:51:10.249452 [info ] [Thread-1 (]: 3 of 4 START sql table model staging.order ..................................... [RUN]
[0m02:51:10.253087 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.product_sales_agg, now model.shopify.order)
[0m02:51:10.254207 [debug] [Thread-1 (]: Began compiling node model.shopify.order
[0m02:51:10.270630 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.order"
[0m02:51:10.274234 [debug] [Thread-1 (]: Began executing node model.shopify.order
[0m02:51:10.283705 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:51:10.593172 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.order"
[0m02:51:10.593172 [debug] [Thread-1 (]: On model.shopify.order: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.order"} */

  
    

    create or replace table `impression-digital`.`staging`.`order`
      
    
    

    OPTIONS()
    as (
      


WITH correct_prices AS 
(
    SELECT
        od.order_number
        ,line.product_id
        ,CAST(variant.price AS NUMERIC) AS price
        ,CAST(line.quantity AS NUMERIC) AS quantity
        ,CAST(variant.price AS NUMERIC)*CAST(line.quantity AS NUMERIC) AS subtotal
    FROM raw.Order AS od
    LEFT JOIN UNNEST(od.line_items) AS line
    LEFT JOIN `impression-digital`.`staging`.`product` AS pd
        ON line.product_id = pd.id
    LEFT JOIN UNNEST(pd.variants) AS variant
        ON line.variant_id = variant.id
)

,shipping_price AS
(
    SELECT 
        order_number
        ,CAST(ship.price AS NUMERIC) AS price
    FROM raw.Order,
    UNNEST(shipping_lines) AS ship 
)

,subtotals AS
(
SELECT 
  order_number
  ,SUM(subtotal) AS subtotal
FROM correct_prices
GROUP BY order_number
)

,stage_order AS
(
SELECT 
  o.order_number
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,phone
  ,contact_email
  ,po_number
  ,COALESCE(s.subtotal, CAST(o.current_subtotal_price AS NUMERIC)) AS subtotal
  ,CAST(total_discounts AS NUMERIC) AS total_discounts
  ,COALESCE(s.subtotal, CAST(o.current_subtotal_price AS NUMERIC)) - CAST(o.total_discounts AS NUMERIC) AS current_subtotal_price
  ,IFNULL(sp.price,0) AS shipping_cost
  ,COALESCE(s.subtotal, CAST(o.current_subtotal_price AS NUMERIC)) - CAST(o.total_discounts AS NUMERIC) + IFNULL(sp.price,0) AS total_price 
  -- ,CAST(o.current_subtotal_price AS NUMERIC) AS shopify_total
  -- ,o.total_price
  ,CAST(total_tax AS NUMERIC) AS total_tax
  ,financial_status
  ,fulfillment_status
  ,note
  ,customer
  ,line_items
  ,refunds
  ,shipping_address
FROM
  raw.Order AS o
LEFT JOIN shipping_price AS sp
  ON o.order_number = sp.order_number
LEFT JOIN subtotals AS s
  ON s.order_number = o.order_number


-- ORDER BY o.order_number
)


SELECT *
FROM stage_order
    );
  
[0m02:51:10.870584 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:4a03d9a2-6e50-4fc0-abd6-91bb2ed58596&page=queryresults
[0m02:51:13.841719 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8412a069-f856-438b-8506-0df2691e9e1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C3B9737200>]}
[0m02:51:13.843295 [info ] [Thread-1 (]: 3 of 4 OK created sql table model staging.order ................................ [[32mCREATE TABLE (30.0 rows, 34.7 KiB processed)[0m in 3.58s]
[0m02:51:13.853565 [debug] [Thread-1 (]: Finished running node model.shopify.order
[0m02:51:13.860876 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m02:51:13.867053 [info ] [Thread-1 (]: 4 of 4 START sql table model staging.customer .................................. [RUN]
[0m02:51:13.878826 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.order, now model.shopify.customer)
[0m02:51:13.878826 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m02:51:13.910971 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m02:51:13.916296 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m02:51:13.926916 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m02:51:14.317456 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m02:51:14.317456 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH cust_spend AS
(
  SELECT
    customer.id
    ,SUM(current_subtotal_price) AS subtotal_spent
    ,SUM(total_price) AS total_spent
  FROM `impression-digital`.`staging`.`order`
  GROUP BY customer.id
)

,stage_cust AS
(
  SELECT
    c.id
    ,email
    ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
    ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
    ,first_name
    ,last_name
    ,CAST(orders_count AS INT64) AS orders_count
    ,state
    -- ,s.total_spent
    ,COALESCE(s.total_spent, CAST(c.total_spent AS FLOAT64), 0) AS total_spent
    ,CAST(last_order_id AS STRING) AS last_order_id
    ,note
    ,CAST(verified_email AS BOOL) AS verified_email
    ,multipass_identifier
    ,CAST(tax_exempt AS BOOL) AS tax_exempt
    ,tags
    ,last_order_name
    ,currency
    ,phone
    ,addresses
    ,tax_exemptions
    ,email_marketing_consent
    ,sms_marketing_consent
    ,admin_graphql_api_id
    ,default_address
  FROM
    raw.Customer AS c
  LEFT JOIN cust_spend AS s
  ON c.id = s.id
)

SELECT * FROM stage_cust
    );
  
[0m02:51:14.618423 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:d001b117-7650-4217-9989-2fdcf147ddd8&page=queryresults
[0m02:51:17.838813 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8412a069-f856-438b-8506-0df2691e9e1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C3BA358530>]}
[0m02:51:17.843388 [info ] [Thread-1 (]: 4 of 4 OK created sql table model staging.customer ............................. [[32mCREATE TABLE (13.0 rows, 7.5 KiB processed)[0m in 3.96s]
[0m02:51:17.851786 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m02:51:17.860306 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m02:51:17.877155 [debug] [MainThread]: Connection 'master' was properly closed.
[0m02:51:17.878872 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m02:51:17.884484 [debug] [MainThread]: Connection 'list_impression-digital_staging' was properly closed.
[0m02:51:17.888269 [debug] [MainThread]: Connection 'model.shopify.customer' was properly closed.
[0m02:51:17.895075 [info ] [MainThread]: 
[0m02:51:17.899108 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 17.80 seconds (17.80s).
[0m02:51:17.906095 [debug] [MainThread]: Command end result
[0m02:51:17.980952 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m02:51:17.989178 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m02:51:18.000821 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m02:51:18.007387 [info ] [MainThread]: 
[0m02:51:18.009619 [info ] [MainThread]: [32mCompleted successfully[0m
[0m02:51:18.012617 [info ] [MainThread]: 
[0m02:51:18.014704 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m02:51:18.022675 [debug] [MainThread]: Command `dbt run` succeeded at 02:51:18.021674 after 24.03 seconds
[0m02:51:18.024851 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C3AF1B33E0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C3B9BBB800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C3AF3FC200>]}
[0m02:51:18.026245 [debug] [MainThread]: Flushing usage events
[0m02:51:18.424465 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m03:00:52.630741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021FC7267A40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021FC9D41970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021FC9D43BF0>]}


============================== 03:00:52.639877 | 07e6d662-ebd1-4924-9cd2-7c11681fc39e ==============================
[0m03:00:52.639877 [info ] [MainThread]: Running with dbt=1.9.1
[0m03:00:52.642217 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'debug': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m03:00:56.621834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '07e6d662-ebd1-4924-9cd2-7c11681fc39e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021FD436D6A0>]}
[0m03:00:56.732428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '07e6d662-ebd1-4924-9cd2-7c11681fc39e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021FD2E2DDF0>]}
[0m03:00:56.739660 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m03:00:57.632188 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m03:00:57.955699 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m03:00:57.959711 [debug] [MainThread]: Partial parsing: updated file: shopify://models\staging\product.sql
[0m03:00:57.962188 [debug] [MainThread]: Partial parsing: updated file: shopify://models\staging\order.sql
[0m03:00:57.963471 [debug] [MainThread]: Partial parsing: updated file: shopify://models\staging\customer.sql
[0m03:00:58.434885 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m03:00:58.439852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '07e6d662-ebd1-4924-9cd2-7c11681fc39e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021FD4834560>]}
[0m03:00:58.584597 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m03:00:58.593310 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m03:00:58.685751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '07e6d662-ebd1-4924-9cd2-7c11681fc39e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021FD464B800>]}
[0m03:00:58.687457 [info ] [MainThread]: Found 4 models, 490 macros
[0m03:00:58.689457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07e6d662-ebd1-4924-9cd2-7c11681fc39e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021FD436DA60>]}
[0m03:00:58.693014 [info ] [MainThread]: 
[0m03:00:58.695260 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m03:00:58.697667 [info ] [MainThread]: 
[0m03:00:58.700560 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m03:00:58.717195 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m03:00:58.718289 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:00:59.117664 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:00:59.559325 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_processed'
[0m03:00:59.562866 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:00:59.878187 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_impression-digital_processed, now list_impression-digital_staging)
[0m03:00:59.887971 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:01:00.226273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07e6d662-ebd1-4924-9cd2-7c11681fc39e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021FD47CEA80>]}
[0m03:01:00.228756 [debug] [MainThread]: Opening a new connection, currently in state init
[0m03:01:00.253182 [debug] [Thread-1 (]: Began running node model.shopify.product
[0m03:01:00.253182 [info ] [Thread-1 (]: 1 of 4 START sql table model staging.product ................................... [RUN]
[0m03:01:00.268152 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.product'
[0m03:01:00.270657 [debug] [Thread-1 (]: Began compiling node model.shopify.product
[0m03:01:00.327875 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product"
[0m03:01:00.334518 [debug] [Thread-1 (]: Began executing node model.shopify.product
[0m03:01:00.375603 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m03:01:00.730196 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product"
[0m03:01:00.735199 [debug] [Thread-1 (]: On model.shopify.product: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product"} */

  
    

    create or replace table `impression-digital`.`staging`.`product`
      
    
    

    OPTIONS()
    as (
      

WITH stage_product AS
(
SELECT 
  id
  ,title
  ,body_html
  ,vendor
  ,product_type
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,handle
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', published_at) AS published_at
  ,template_suffix
  ,published_scope
  ,tags
  ,status
  ,admin_graphql_api_id
  ,variants
  ,options
  ,images
  ,image
FROM raw.product
)

SELECT * FROM stage_product
    );
  
[0m03:01:01.058377 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:6867c66f-f4d1-4e1c-9d50-4044a80eb6fc&page=queryresults
[0m03:01:04.493245 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07e6d662-ebd1-4924-9cd2-7c11681fc39e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021FD239F200>]}
[0m03:01:04.495119 [info ] [Thread-1 (]: 1 of 4 OK created sql table model staging.product .............................. [[32mCREATE TABLE (47.0 rows, 119.6 KiB processed)[0m in 4.22s]
[0m03:01:04.499154 [debug] [Thread-1 (]: Finished running node model.shopify.product
[0m03:01:04.504737 [debug] [Thread-1 (]: Began running node model.shopify.product_sales_agg
[0m03:01:04.508199 [info ] [Thread-1 (]: 2 of 4 START sql table model processed.product_sales_agg ....................... [RUN]
[0m03:01:04.512098 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.product, now model.shopify.product_sales_agg)
[0m03:01:04.514061 [debug] [Thread-1 (]: Began compiling node model.shopify.product_sales_agg
[0m03:01:04.527746 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product_sales_agg"
[0m03:01:04.532025 [debug] [Thread-1 (]: Began executing node model.shopify.product_sales_agg
[0m03:01:04.544164 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:01:04.924761 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product_sales_agg"
[0m03:01:04.938290 [debug] [Thread-1 (]: On model.shopify.product_sales_agg: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product_sales_agg"} */

  
    

    create or replace table `impression-digital`.`processed`.`product_sales_agg`
      
    
    

    OPTIONS()
    as (
      


WITH all_lines AS (

SELECT 
  od.order_number
  ,line.product_id AS line_product_id
  ,line.variant_id AS line_variant_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,IFNULL(CAST(discount.amount AS NUMERIC), 0) AS discount
  ,od.total_discounts
  ,od.financial_status AS payment_status
FROM
  staging.order AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
  raw.Product AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
LEFT JOIN
  UNNEST(line.discount_allocations) AS discount
WHERE od.financial_status IN ('paid') -- only counting sales from paid orders
)

-- same product within an order can have different discounts applied. Need to group down to variant level and sum discounts
,discount_summed AS(
  SELECT
    order_number
    ,line_product_id
    ,line_variant_id
    ,quantity
    ,SUM(discount) AS discount
  FROM all_lines
  GROUP BY order_number, line_product_id, line_variant_id, quantity
)

-- add the summed discount back to respective row in all_lines via a join
,subtotals AS(
SELECT DISTINCT
  d.order_number
  ,d.line_product_id
  ,d.line_variant_id
  ,l.price
  ,d.quantity
  ,d.discount
  ,(price*d.quantity) - d.discount AS subtotal
FROM discount_summed AS d
LEFT JOIN all_lines AS l
  ON 
    l.order_number = d.order_number AND
    l.line_product_id = d.line_product_id AND 
    l.line_variant_id = d.line_variant_id
)

,agg AS (

SELECT
  line_product_id AS product_id
  ,SUM(quantity) AS product_quantity
  ,SUM(subtotal) AS product_rev
FROM subtotals
GROUP BY line_product_id
)

SELECT * FROM agg
-- ORDER BY order_number
    );
  
[0m03:01:05.257074 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:a879db95-7032-46f5-8f38-1ca328a19eea&page=queryresults
[0m03:01:05.257074 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:a879db95-7032-46f5-8f38-1ca328a19eea&page=queryresults
[0m03:01:05.284098 [debug] [Thread-1 (]: Database Error in model product_sales_agg (models\processed\product_sales_agg.sql)
  Not found: Table impression-digital:raw.Product was not found in location EU
  compiled code at target\run\shopify\models\processed\product_sales_agg.sql
[0m03:01:05.289048 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07e6d662-ebd1-4924-9cd2-7c11681fc39e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021FD4F56F00>]}
[0m03:01:05.292546 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model processed.product_sales_agg .............. [[31mERROR[0m in 0.78s]
[0m03:01:05.295934 [debug] [Thread-1 (]: Finished running node model.shopify.product_sales_agg
[0m03:01:05.297939 [debug] [Thread-1 (]: Began running node model.shopify.order
[0m03:01:05.300031 [debug] [Thread-4 (]: Marking all children of 'model.shopify.product_sales_agg' to be skipped because of status 'error'.  Reason: Database Error in model product_sales_agg (models\processed\product_sales_agg.sql)
  Not found: Table impression-digital:raw.Product was not found in location EU
  compiled code at target\run\shopify\models\processed\product_sales_agg.sql.
[0m03:01:05.301776 [info ] [Thread-1 (]: 3 of 4 START sql table model staging.order ..................................... [RUN]
[0m03:01:05.309013 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.product_sales_agg, now model.shopify.order)
[0m03:01:05.309013 [debug] [Thread-1 (]: Began compiling node model.shopify.order
[0m03:01:05.329485 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.order"
[0m03:01:05.334066 [debug] [Thread-1 (]: Began executing node model.shopify.order
[0m03:01:05.342808 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:01:05.696515 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.order"
[0m03:01:05.710451 [debug] [Thread-1 (]: On model.shopify.order: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.order"} */

  
    

    create or replace table `impression-digital`.`staging`.`order`
      
    
    

    OPTIONS()
    as (
      


WITH correct_prices AS 
(
    SELECT
        od.order_number
        ,line.product_id
        ,CAST(variant.price AS NUMERIC) AS price
        ,CAST(line.quantity AS NUMERIC) AS quantity
        ,CAST(variant.price AS NUMERIC)*CAST(line.quantity AS NUMERIC) AS subtotal
    FROM raw.order AS od
    LEFT JOIN UNNEST(od.line_items) AS line
    LEFT JOIN `impression-digital`.`staging`.`product` AS pd
        ON line.product_id = pd.id
    LEFT JOIN UNNEST(pd.variants) AS variant
        ON line.variant_id = variant.id
)

,shipping_price AS
(
    SELECT 
        order_number
        ,CAST(ship.price AS NUMERIC) AS price
    FROM raw.order,
    UNNEST(shipping_lines) AS ship 
)

,subtotals AS
(
SELECT 
  order_number
  ,SUM(subtotal) AS subtotal
FROM correct_prices
GROUP BY order_number
)

,stage_order AS
(
SELECT 
  o.order_number
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,phone
  ,contact_email
  ,po_number
  ,COALESCE(s.subtotal, CAST(o.current_subtotal_price AS NUMERIC)) AS subtotal
  ,CAST(total_discounts AS NUMERIC) AS total_discounts
  ,COALESCE(s.subtotal, CAST(o.current_subtotal_price AS NUMERIC)) - CAST(o.total_discounts AS NUMERIC) AS current_subtotal_price
  ,IFNULL(sp.price,0) AS shipping_cost
  ,COALESCE(s.subtotal, CAST(o.current_subtotal_price AS NUMERIC)) - CAST(o.total_discounts AS NUMERIC) + IFNULL(sp.price,0) AS total_price 
  -- ,CAST(o.current_subtotal_price AS NUMERIC) AS shopify_total
  -- ,o.total_price
  ,CAST(total_tax AS NUMERIC) AS total_tax
  ,financial_status
  ,fulfillment_status
  ,note
  ,customer
  ,line_items
  ,refunds
  ,shipping_address
FROM
  raw.order AS o
LEFT JOIN shipping_price AS sp
  ON o.order_number = sp.order_number
LEFT JOIN subtotals AS s
  ON s.order_number = o.order_number


-- ORDER BY o.order_number
)


SELECT *
FROM stage_order
    );
  
[0m03:01:06.073277 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:976d7e58-d15a-480e-a51b-cea7e2e78b4e&page=queryresults
[0m03:01:09.026858 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07e6d662-ebd1-4924-9cd2-7c11681fc39e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021FD472C590>]}
[0m03:01:09.034937 [info ] [Thread-1 (]: 3 of 4 OK created sql table model staging.order ................................ [[32mCREATE TABLE (30.0 rows, 34.7 KiB processed)[0m in 3.72s]
[0m03:01:09.050201 [debug] [Thread-1 (]: Finished running node model.shopify.order
[0m03:01:09.055323 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m03:01:09.058032 [info ] [Thread-1 (]: 4 of 4 START sql table model staging.customer .................................. [RUN]
[0m03:01:09.063301 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.order, now model.shopify.customer)
[0m03:01:09.063301 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m03:01:09.091363 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m03:01:09.098923 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m03:01:09.115926 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:01:09.452377 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m03:01:09.466990 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH cust_spend AS
(
  SELECT
    customer.id
    ,SUM(current_subtotal_price) AS subtotal_spent
    ,SUM(total_price) AS total_spent
  FROM `impression-digital`.`staging`.`order`
  GROUP BY customer.id
)

,stage_cust AS
(
  SELECT
    c.id
    ,email
    ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
    ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
    ,first_name
    ,last_name
    ,CAST(orders_count AS INT64) AS orders_count
    ,state
    -- ,s.total_spent
    ,COALESCE(s.total_spent, CAST(c.total_spent AS FLOAT64), 0) AS total_spent
    ,CAST(last_order_id AS STRING) AS last_order_id
    ,note
    ,CAST(verified_email AS BOOL) AS verified_email
    ,multipass_identifier
    ,CAST(tax_exempt AS BOOL) AS tax_exempt
    ,tags
    ,last_order_name
    ,currency
    ,phone
    ,addresses
    ,tax_exemptions
    ,email_marketing_consent
    ,sms_marketing_consent
    ,admin_graphql_api_id
    ,default_address
  FROM
    raw.customer AS c
  LEFT JOIN cust_spend AS s
  ON c.id = s.id
)

SELECT * FROM stage_cust
    );
  
[0m03:01:09.861171 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:a7ef8023-a52c-439d-9406-dcb24ee9caed&page=queryresults
[0m03:01:12.480464 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07e6d662-ebd1-4924-9cd2-7c11681fc39e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021FD4F56F00>]}
[0m03:01:12.480464 [info ] [Thread-1 (]: 4 of 4 OK created sql table model staging.customer ............................. [[32mCREATE TABLE (13.0 rows, 7.5 KiB processed)[0m in 3.42s]
[0m03:01:12.492082 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m03:01:12.501186 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m03:01:12.512196 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:01:12.515500 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m03:01:12.519197 [debug] [MainThread]: Connection 'list_impression-digital_staging' was properly closed.
[0m03:01:12.522428 [debug] [MainThread]: Connection 'model.shopify.customer' was properly closed.
[0m03:01:12.523434 [info ] [MainThread]: 
[0m03:01:12.528746 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 13.82 seconds (13.82s).
[0m03:01:12.534594 [debug] [MainThread]: Command end result
[0m03:01:12.629087 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m03:01:12.634898 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m03:01:12.649490 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m03:01:12.650431 [info ] [MainThread]: 
[0m03:01:12.653108 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m03:01:12.656134 [info ] [MainThread]: 
[0m03:01:12.660501 [error] [MainThread]:   Database Error in model product_sales_agg (models\processed\product_sales_agg.sql)
  Not found: Table impression-digital:raw.Product was not found in location EU
  compiled code at target\run\shopify\models\processed\product_sales_agg.sql
[0m03:01:12.664557 [info ] [MainThread]: 
[0m03:01:12.669601 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m03:01:12.674863 [debug] [MainThread]: Command `dbt run` failed at 03:01:12.673859 after 20.41 seconds
[0m03:01:12.676219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021FC96F5BE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021FD4867CE0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021FD4866D20>]}
[0m03:01:12.678220 [debug] [MainThread]: Flushing usage events
[0m03:01:13.117396 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m03:02:36.364191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023059DC7770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002305C76EF00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002305C8DE120>]}


============================== 03:02:36.371357 | 14d4409c-8c0c-44e9-b796-e4961c83f34e ==============================
[0m03:02:36.371357 [info ] [MainThread]: Running with dbt=1.9.1
[0m03:02:36.373826 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'debug': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m03:02:39.383577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '14d4409c-8c0c-44e9-b796-e4961c83f34e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000230672F1130>]}
[0m03:02:39.475801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '14d4409c-8c0c-44e9-b796-e4961c83f34e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023065B37500>]}
[0m03:02:39.479859 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m03:02:40.253459 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m03:02:40.542669 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m03:02:40.543504 [debug] [MainThread]: Partial parsing: updated file: shopify://models\processed\product_sales_agg.sql
[0m03:02:41.009127 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m03:02:41.015530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '14d4409c-8c0c-44e9-b796-e4961c83f34e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023067C80380>]}
[0m03:02:41.167249 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m03:02:41.178657 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m03:02:41.248418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '14d4409c-8c0c-44e9-b796-e4961c83f34e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023067C69130>]}
[0m03:02:41.249696 [info ] [MainThread]: Found 4 models, 490 macros
[0m03:02:41.252432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '14d4409c-8c0c-44e9-b796-e4961c83f34e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002306774D8B0>]}
[0m03:02:41.257135 [info ] [MainThread]: 
[0m03:02:41.263742 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m03:02:41.267132 [info ] [MainThread]: 
[0m03:02:41.272521 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m03:02:41.292671 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m03:02:41.297455 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:02:41.701149 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:02:42.130858 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_processed'
[0m03:02:42.133768 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:02:42.447094 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_impression-digital_processed, now list_impression-digital_staging)
[0m03:02:42.448139 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:02:42.848786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '14d4409c-8c0c-44e9-b796-e4961c83f34e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023067BA6150>]}
[0m03:02:42.850435 [debug] [MainThread]: Opening a new connection, currently in state init
[0m03:02:42.884473 [debug] [Thread-1 (]: Began running node model.shopify.product
[0m03:02:42.891414 [info ] [Thread-1 (]: 1 of 4 START sql table model staging.product ................................... [RUN]
[0m03:02:42.899875 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.product'
[0m03:02:42.903470 [debug] [Thread-1 (]: Began compiling node model.shopify.product
[0m03:02:42.946010 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product"
[0m03:02:42.950110 [debug] [Thread-1 (]: Began executing node model.shopify.product
[0m03:02:43.002566 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m03:02:43.347809 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product"
[0m03:02:43.358665 [debug] [Thread-1 (]: On model.shopify.product: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product"} */

  
    

    create or replace table `impression-digital`.`staging`.`product`
      
    
    

    OPTIONS()
    as (
      

WITH stage_product AS
(
SELECT 
  id
  ,title
  ,body_html
  ,vendor
  ,product_type
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,handle
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', published_at) AS published_at
  ,template_suffix
  ,published_scope
  ,tags
  ,status
  ,admin_graphql_api_id
  ,variants
  ,options
  ,images
  ,image
FROM raw.product
)

SELECT * FROM stage_product
    );
  
[0m03:02:43.634611 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:bf74f07e-7f8e-4715-b189-ff1237ce6efc&page=queryresults
[0m03:02:46.661906 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14d4409c-8c0c-44e9-b796-e4961c83f34e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023068358B00>]}
[0m03:02:46.662938 [info ] [Thread-1 (]: 1 of 4 OK created sql table model staging.product .............................. [[32mCREATE TABLE (47.0 rows, 119.6 KiB processed)[0m in 3.76s]
[0m03:02:46.670147 [debug] [Thread-1 (]: Finished running node model.shopify.product
[0m03:02:46.673791 [debug] [Thread-1 (]: Began running node model.shopify.product_sales_agg
[0m03:02:46.676872 [info ] [Thread-1 (]: 2 of 4 START sql table model processed.product_sales_agg ....................... [RUN]
[0m03:02:46.679310 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.product, now model.shopify.product_sales_agg)
[0m03:02:46.679310 [debug] [Thread-1 (]: Began compiling node model.shopify.product_sales_agg
[0m03:02:46.815096 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product_sales_agg"
[0m03:02:46.823258 [debug] [Thread-1 (]: Began executing node model.shopify.product_sales_agg
[0m03:02:46.834500 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:02:47.245176 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product_sales_agg"
[0m03:02:47.257181 [debug] [Thread-1 (]: On model.shopify.product_sales_agg: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product_sales_agg"} */

  
    

    create or replace table `impression-digital`.`processed`.`product_sales_agg`
      
    
    

    OPTIONS()
    as (
      


WITH all_lines AS (

SELECT 
  od.order_number
  ,line.product_id AS line_product_id
  ,line.variant_id AS line_variant_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,IFNULL(CAST(discount.amount AS NUMERIC), 0) AS discount
  ,od.total_discounts
  ,od.financial_status AS payment_status
FROM
  staging.order AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
  raw.product AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
LEFT JOIN
  UNNEST(line.discount_allocations) AS discount
WHERE od.financial_status IN ('paid') -- only counting sales from paid orders
)

-- same product within an order can have different discounts applied. Need to group down to variant level and sum discounts
,discount_summed AS(
  SELECT
    order_number
    ,line_product_id
    ,line_variant_id
    ,quantity
    ,SUM(discount) AS discount
  FROM all_lines
  GROUP BY order_number, line_product_id, line_variant_id, quantity
)

-- add the summed discount back to respective row in all_lines via a join
,subtotals AS(
SELECT DISTINCT
  d.order_number
  ,d.line_product_id
  ,d.line_variant_id
  ,l.price
  ,d.quantity
  ,d.discount
  ,(price*d.quantity) - d.discount AS subtotal
FROM discount_summed AS d
LEFT JOIN all_lines AS l
  ON 
    l.order_number = d.order_number AND
    l.line_product_id = d.line_product_id AND 
    l.line_variant_id = d.line_variant_id
)

,agg AS (

SELECT
  line_product_id AS product_id
  ,SUM(quantity) AS product_quantity
  ,SUM(subtotal) AS product_rev
FROM subtotals
GROUP BY line_product_id
)

SELECT * FROM agg
-- ORDER BY order_number
    );
  
[0m03:02:47.986907 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:047c47dd-a2ab-49ad-b32f-b586f61eab3a&page=queryresults
[0m03:02:51.236124 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14d4409c-8c0c-44e9-b796-e4961c83f34e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000230683B5700>]}
[0m03:02:51.244268 [info ] [Thread-1 (]: 2 of 4 OK created sql table model processed.product_sales_agg .................. [[32mCREATE TABLE (19.0 rows, 4.9 KiB processed)[0m in 4.56s]
[0m03:02:51.255688 [debug] [Thread-1 (]: Finished running node model.shopify.product_sales_agg
[0m03:02:51.261323 [debug] [Thread-1 (]: Began running node model.shopify.order
[0m03:02:51.270274 [info ] [Thread-1 (]: 3 of 4 START sql table model staging.order ..................................... [RUN]
[0m03:02:51.279943 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.product_sales_agg, now model.shopify.order)
[0m03:02:51.287777 [debug] [Thread-1 (]: Began compiling node model.shopify.order
[0m03:02:51.322948 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.order"
[0m03:02:51.325942 [debug] [Thread-1 (]: Began executing node model.shopify.order
[0m03:02:51.335963 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:02:51.628687 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.order"
[0m03:02:51.638119 [debug] [Thread-1 (]: On model.shopify.order: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.order"} */

  
    

    create or replace table `impression-digital`.`staging`.`order`
      
    
    

    OPTIONS()
    as (
      


WITH correct_prices AS 
(
    SELECT
        od.order_number
        ,line.product_id
        ,CAST(variant.price AS NUMERIC) AS price
        ,CAST(line.quantity AS NUMERIC) AS quantity
        ,CAST(variant.price AS NUMERIC)*CAST(line.quantity AS NUMERIC) AS subtotal
    FROM raw.order AS od
    LEFT JOIN UNNEST(od.line_items) AS line
    LEFT JOIN `impression-digital`.`staging`.`product` AS pd
        ON line.product_id = pd.id
    LEFT JOIN UNNEST(pd.variants) AS variant
        ON line.variant_id = variant.id
)

,shipping_price AS
(
    SELECT 
        order_number
        ,CAST(ship.price AS NUMERIC) AS price
    FROM raw.order,
    UNNEST(shipping_lines) AS ship 
)

,subtotals AS
(
SELECT 
  order_number
  ,SUM(subtotal) AS subtotal
FROM correct_prices
GROUP BY order_number
)

,stage_order AS
(
SELECT 
  o.order_number
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,phone
  ,contact_email
  ,po_number
  ,COALESCE(s.subtotal, CAST(o.current_subtotal_price AS NUMERIC)) AS subtotal
  ,CAST(total_discounts AS NUMERIC) AS total_discounts
  ,COALESCE(s.subtotal, CAST(o.current_subtotal_price AS NUMERIC)) - CAST(o.total_discounts AS NUMERIC) AS current_subtotal_price
  ,IFNULL(sp.price,0) AS shipping_cost
  ,COALESCE(s.subtotal, CAST(o.current_subtotal_price AS NUMERIC)) - CAST(o.total_discounts AS NUMERIC) + IFNULL(sp.price,0) AS total_price 
  -- ,CAST(o.current_subtotal_price AS NUMERIC) AS shopify_total
  -- ,o.total_price
  ,CAST(total_tax AS NUMERIC) AS total_tax
  ,financial_status
  ,fulfillment_status
  ,note
  ,customer
  ,line_items
  ,refunds
  ,shipping_address
FROM
  raw.order AS o
LEFT JOIN shipping_price AS sp
  ON o.order_number = sp.order_number
LEFT JOIN subtotals AS s
  ON s.order_number = o.order_number


-- ORDER BY o.order_number
)


SELECT *
FROM stage_order
    );
  
[0m03:02:51.955209 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:c9ef1abd-e133-4f2f-bdd1-5f32f2366537&page=queryresults
[0m03:02:55.226653 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14d4409c-8c0c-44e9-b796-e4961c83f34e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000230683582F0>]}
[0m03:02:55.226653 [info ] [Thread-1 (]: 3 of 4 OK created sql table model staging.order ................................ [[32mCREATE TABLE (30.0 rows, 34.7 KiB processed)[0m in 3.95s]
[0m03:02:55.236305 [debug] [Thread-1 (]: Finished running node model.shopify.order
[0m03:02:55.239653 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m03:02:55.243001 [info ] [Thread-1 (]: 4 of 4 START sql table model staging.customer .................................. [RUN]
[0m03:02:55.249612 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.order, now model.shopify.customer)
[0m03:02:55.252847 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m03:02:55.268132 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m03:02:55.272091 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m03:02:55.281000 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:02:55.573496 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m03:02:55.573496 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH cust_spend AS
(
  SELECT
    customer.id
    ,SUM(current_subtotal_price) AS subtotal_spent
    ,SUM(total_price) AS total_spent
  FROM `impression-digital`.`staging`.`order`
  GROUP BY customer.id
)

,stage_cust AS
(
  SELECT
    c.id
    ,email
    ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
    ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
    ,first_name
    ,last_name
    ,CAST(orders_count AS INT64) AS orders_count
    ,state
    -- ,s.total_spent
    ,COALESCE(s.total_spent, CAST(c.total_spent AS FLOAT64), 0) AS total_spent
    ,CAST(last_order_id AS STRING) AS last_order_id
    ,note
    ,CAST(verified_email AS BOOL) AS verified_email
    ,multipass_identifier
    ,CAST(tax_exempt AS BOOL) AS tax_exempt
    ,tags
    ,last_order_name
    ,currency
    ,phone
    ,addresses
    ,tax_exemptions
    ,email_marketing_consent
    ,sms_marketing_consent
    ,admin_graphql_api_id
    ,default_address
  FROM
    raw.customer AS c
  LEFT JOIN cust_spend AS s
  ON c.id = s.id
)

SELECT * FROM stage_cust
    );
  
[0m03:02:55.874626 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:b7100fe4-8c03-4db9-b931-d1a72a7d01fd&page=queryresults
[0m03:02:58.615126 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14d4409c-8c0c-44e9-b796-e4961c83f34e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023067C84EF0>]}
[0m03:02:58.618033 [info ] [Thread-1 (]: 4 of 4 OK created sql table model staging.customer ............................. [[32mCREATE TABLE (13.0 rows, 7.5 KiB processed)[0m in 3.36s]
[0m03:02:58.623634 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m03:02:58.629502 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m03:02:58.640210 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:02:58.642859 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m03:02:58.645897 [debug] [MainThread]: Connection 'list_impression-digital_staging' was properly closed.
[0m03:02:58.647262 [debug] [MainThread]: Connection 'model.shopify.customer' was properly closed.
[0m03:02:58.650433 [info ] [MainThread]: 
[0m03:02:58.652432 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 17.38 seconds (17.38s).
[0m03:02:58.656920 [debug] [MainThread]: Command end result
[0m03:02:58.764858 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m03:02:58.773107 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m03:02:58.795381 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m03:02:58.798385 [info ] [MainThread]: 
[0m03:02:58.801384 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:02:58.806008 [info ] [MainThread]: 
[0m03:02:58.809363 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m03:02:58.817134 [debug] [MainThread]: Command `dbt run` succeeded at 03:02:58.817134 after 22.77 seconds
[0m03:02:58.819260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002305C9F4470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002305C791D00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023067C47D70>]}
[0m03:02:58.820955 [debug] [MainThread]: Flushing usage events
[0m03:02:59.225830 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m03:14:11.300885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002013F275DC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002013C647860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000020141CBA6C0>]}


============================== 03:14:11.313451 | 930bad8d-1100-4972-ad17-6839384e5bd3 ==============================
[0m03:14:11.313451 [info ] [MainThread]: Running with dbt=1.9.1
[0m03:14:11.314934 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m03:14:15.586796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '930bad8d-1100-4972-ad17-6839384e5bd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002014B0BEE40>]}
[0m03:14:15.684142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '930bad8d-1100-4972-ad17-6839384e5bd3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002014C98E630>]}
[0m03:14:15.690470 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m03:14:16.658885 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m03:14:17.028773 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m03:14:17.037260 [debug] [MainThread]: Partial parsing: updated file: shopify://models\processed\product_sales_agg.sql
[0m03:14:17.380121 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.shopify.product_sales_agg' (models\processed\product_sales_agg.sql) depends on a node named 'staging/order' which was not found
[0m03:14:17.390688 [debug] [MainThread]: Command `dbt run` failed at 03:14:17.390688 after 6.51 seconds
[0m03:14:17.392096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002013F275DC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002014B62B2F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002014CFB5670>]}
[0m03:14:17.394606 [debug] [MainThread]: Flushing usage events
[0m03:14:17.829834 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m03:15:02.076218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021247F06B70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021247E63A70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021247E63E30>]}


============================== 03:15:02.083723 | f32534c4-097c-47b2-8a25-4ba705eb6765 ==============================
[0m03:15:02.083723 [info ] [MainThread]: Running with dbt=1.9.1
[0m03:15:02.087529 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m03:15:04.896759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f32534c4-097c-47b2-8a25-4ba705eb6765', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212525CB050>]}
[0m03:15:04.995898 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f32534c4-097c-47b2-8a25-4ba705eb6765', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000212480383B0>]}
[0m03:15:04.999077 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m03:15:05.863436 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m03:15:06.161048 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m03:15:06.163724 [debug] [MainThread]: Partial parsing: updated file: shopify://models\processed\product_sales_agg.sql
[0m03:15:06.552769 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.shopify.product_sales_agg' (models\processed\product_sales_agg.sql) depends on a node named 'staging.order' which was not found
[0m03:15:06.562653 [debug] [MainThread]: Command `dbt run` failed at 03:15:06.561651 after 4.73 seconds
[0m03:15:06.563547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021247A82600>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000021252638E00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002124777F770>]}
[0m03:15:06.564545 [debug] [MainThread]: Flushing usage events
[0m03:15:07.006034 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m03:15:27.646285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000264C3480530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000264C3480440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000264C3480350>]}


============================== 03:15:27.653470 | 32a17f6c-547a-4cd2-92da-12c164fd28df ==============================
[0m03:15:27.653470 [info ] [MainThread]: Running with dbt=1.9.1
[0m03:15:27.656761 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m03:15:30.520292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '32a17f6c-547a-4cd2-92da-12c164fd28df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000264CD419910>]}
[0m03:15:30.685316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '32a17f6c-547a-4cd2-92da-12c164fd28df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000264CC29F2C0>]}
[0m03:15:30.688214 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m03:15:31.622983 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m03:15:31.929803 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m03:15:31.929803 [debug] [MainThread]: Partial parsing: updated file: shopify://models\processed\product_sales_agg.sql
[0m03:15:32.296521 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.shopify.product_sales_agg' (models\processed\product_sales_agg.sql) depends on a node named 'staging\order' which was not found
[0m03:15:32.301930 [debug] [MainThread]: Command `dbt run` failed at 03:15:32.300929 after 4.89 seconds
[0m03:15:32.301930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000264C3482C60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000264CD79DBB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000264CDB3B2F0>]}
[0m03:15:32.304163 [debug] [MainThread]: Flushing usage events
[0m03:15:32.762088 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m03:16:35.438792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000213D2905F10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000213D284FFB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000213D52D8C20>]}


============================== 03:16:35.446086 | c6a037f2-0137-4dc2-aa19-be3451f420a8 ==============================
[0m03:16:35.446086 [info ] [MainThread]: Running with dbt=1.9.1
[0m03:16:35.450118 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m03:16:38.572840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c6a037f2-0137-4dc2-aa19-be3451f420a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000213DE4D9460>]}
[0m03:16:38.680354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c6a037f2-0137-4dc2-aa19-be3451f420a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000213D46D73E0>]}
[0m03:16:38.682563 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m03:16:39.506758 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m03:16:39.765285 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m03:16:39.767666 [debug] [MainThread]: Partial parsing: updated file: shopify://models\processed\product_sales_agg.sql
[0m03:16:40.138242 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.shopify.product_sales_agg' (models\processed\product_sales_agg.sql) depends on a node named 'staging/order' which was not found
[0m03:16:40.147407 [debug] [MainThread]: Command `dbt run` failed at 03:16:40.147407 after 4.97 seconds
[0m03:16:40.147407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000213D4B1BE60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000213D3346000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000213D4B3FAA0>]}
[0m03:16:40.150024 [debug] [MainThread]: Flushing usage events
[0m03:16:40.632563 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m03:17:51.167582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B8081A0260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B8081A0200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B8081A0110>]}


============================== 03:17:51.174733 | e61e7e02-816f-429f-9f44-2dada926af44 ==============================
[0m03:17:51.174733 [info ] [MainThread]: Running with dbt=1.9.1
[0m03:17:51.178352 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': 'C:\\Users\\amarh\\Dropbox\\My_Stuff\\Progress File (Actual)\\Job Applications\\2024\\Data Engineer\\Impression Digital\\impression-digital-task\\01_code\\transform\\shopify\\logs', 'debug': 'False', 'profiles_dir': 'C:\\Users\\amarh\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m03:17:54.278105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e61e7e02-816f-429f-9f44-2dada926af44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B81246C710>]}
[0m03:17:54.504577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e61e7e02-816f-429f-9f44-2dada926af44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B807D229C0>]}
[0m03:17:54.506943 [info ] [MainThread]: Registered adapter: bigquery=1.9.0
[0m03:17:55.298330 [debug] [MainThread]: checksum: 5e8d1596cf4eae33c11286bbb248a722d21b9f00d8a7ced8137c642517055418, vars: {}, profile: , target: , version: 1.9.1
[0m03:17:55.580951 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m03:17:55.585717 [debug] [MainThread]: Partial parsing: updated file: shopify://models\processed\product_sales_agg.sql
[0m03:17:56.064524 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.shopify.raw
[0m03:17:56.073911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e61e7e02-816f-429f-9f44-2dada926af44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B81241C4D0>]}
[0m03:17:56.214722 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m03:17:56.230268 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m03:17:56.321347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e61e7e02-816f-429f-9f44-2dada926af44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B812742C30>]}
[0m03:17:56.323659 [info ] [MainThread]: Found 4 models, 490 macros
[0m03:17:56.327432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e61e7e02-816f-429f-9f44-2dada926af44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B81295DB20>]}
[0m03:17:56.330880 [info ] [MainThread]: 
[0m03:17:56.340973 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m03:17:56.346188 [info ] [MainThread]: 
[0m03:17:56.354840 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m03:17:56.372417 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital'
[0m03:17:56.375730 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:17:56.845857 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:17:57.198379 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_impression-digital_processed'
[0m03:17:57.201445 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m03:17:57.585576 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_impression-digital_processed, now list_impression-digital_staging)
[0m03:17:57.590027 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m03:17:57.895391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e61e7e02-816f-429f-9f44-2dada926af44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B8123735C0>]}
[0m03:17:57.896942 [debug] [MainThread]: Opening a new connection, currently in state init
[0m03:17:57.909251 [debug] [Thread-1 (]: Began running node model.shopify.product
[0m03:17:57.912187 [info ] [Thread-1 (]: 1 of 4 START sql table model staging.product ................................... [RUN]
[0m03:17:57.915419 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.shopify.product'
[0m03:17:57.916994 [debug] [Thread-1 (]: Began compiling node model.shopify.product
[0m03:17:57.954421 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product"
[0m03:17:57.961671 [debug] [Thread-1 (]: Began executing node model.shopify.product
[0m03:17:58.020079 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m03:17:58.437475 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product"
[0m03:17:58.443539 [debug] [Thread-1 (]: On model.shopify.product: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product"} */

  
    

    create or replace table `impression-digital`.`staging`.`product`
      
    
    

    OPTIONS()
    as (
      

WITH stage_product AS
(
SELECT 
  id
  ,title
  ,body_html
  ,vendor
  ,product_type
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,handle
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', published_at) AS published_at
  ,template_suffix
  ,published_scope
  ,tags
  ,status
  ,admin_graphql_api_id
  ,variants
  ,options
  ,images
  ,image
FROM raw.product
)

SELECT * FROM stage_product
    );
  
[0m03:17:58.951487 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:79d5b898-7953-4162-b709-381218d1a2ad&page=queryresults
[0m03:18:02.330892 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e61e7e02-816f-429f-9f44-2dada926af44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B8131CEB10>]}
[0m03:18:02.332718 [info ] [Thread-1 (]: 1 of 4 OK created sql table model staging.product .............................. [[32mCREATE TABLE (47.0 rows, 119.6 KiB processed)[0m in 4.41s]
[0m03:18:02.334914 [debug] [Thread-1 (]: Finished running node model.shopify.product
[0m03:18:02.337286 [debug] [Thread-1 (]: Began running node model.shopify.order
[0m03:18:02.340288 [info ] [Thread-1 (]: 2 of 4 START sql table model staging.order ..................................... [RUN]
[0m03:18:02.342286 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.product, now model.shopify.order)
[0m03:18:02.344077 [debug] [Thread-1 (]: Began compiling node model.shopify.order
[0m03:18:02.497560 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.order"
[0m03:18:02.503626 [debug] [Thread-1 (]: Began executing node model.shopify.order
[0m03:18:02.511303 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:18:02.886692 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.order"
[0m03:18:02.894085 [debug] [Thread-1 (]: On model.shopify.order: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.order"} */

  
    

    create or replace table `impression-digital`.`staging`.`order`
      
    
    

    OPTIONS()
    as (
      


WITH correct_prices AS 
(
    SELECT
        od.order_number
        ,line.product_id
        ,CAST(variant.price AS NUMERIC) AS price
        ,CAST(line.quantity AS NUMERIC) AS quantity
        ,CAST(variant.price AS NUMERIC)*CAST(line.quantity AS NUMERIC) AS subtotal
    FROM raw.order AS od
    LEFT JOIN UNNEST(od.line_items) AS line
    LEFT JOIN `impression-digital`.`staging`.`product` AS pd
        ON line.product_id = pd.id
    LEFT JOIN UNNEST(pd.variants) AS variant
        ON line.variant_id = variant.id
)

,shipping_price AS
(
    SELECT 
        order_number
        ,CAST(ship.price AS NUMERIC) AS price
    FROM raw.order,
    UNNEST(shipping_lines) AS ship 
)

,subtotals AS
(
SELECT 
  order_number
  ,SUM(subtotal) AS subtotal
FROM correct_prices
GROUP BY order_number
)

,stage_order AS
(
SELECT 
  o.order_number
  ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
  ,phone
  ,contact_email
  ,po_number
  ,COALESCE(s.subtotal, CAST(o.current_subtotal_price AS NUMERIC)) AS subtotal
  ,CAST(total_discounts AS NUMERIC) AS total_discounts
  ,COALESCE(s.subtotal, CAST(o.current_subtotal_price AS NUMERIC)) - CAST(o.total_discounts AS NUMERIC) AS current_subtotal_price
  ,IFNULL(sp.price,0) AS shipping_cost
  ,COALESCE(s.subtotal, CAST(o.current_subtotal_price AS NUMERIC)) - CAST(o.total_discounts AS NUMERIC) + IFNULL(sp.price,0) AS total_price 
  -- ,CAST(o.current_subtotal_price AS NUMERIC) AS shopify_total
  -- ,o.total_price
  ,CAST(total_tax AS NUMERIC) AS total_tax
  ,financial_status
  ,fulfillment_status
  ,note
  ,customer
  ,line_items
  ,refunds
  ,shipping_address
FROM
  raw.order AS o
LEFT JOIN shipping_price AS sp
  ON o.order_number = sp.order_number
LEFT JOIN subtotals AS s
  ON s.order_number = o.order_number


-- ORDER BY o.order_number
)


SELECT *
FROM stage_order
    );
  
[0m03:18:03.298388 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:21c5d246-fc4b-4919-9949-dce0a930378a&page=queryresults
[0m03:18:06.803572 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e61e7e02-816f-429f-9f44-2dada926af44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B81313BDD0>]}
[0m03:18:06.803572 [info ] [Thread-1 (]: 2 of 4 OK created sql table model staging.order ................................ [[32mCREATE TABLE (30.0 rows, 34.7 KiB processed)[0m in 4.46s]
[0m03:18:06.814341 [debug] [Thread-1 (]: Finished running node model.shopify.order
[0m03:18:06.821512 [debug] [Thread-1 (]: Began running node model.shopify.customer
[0m03:18:06.823532 [info ] [Thread-1 (]: 3 of 4 START sql table model staging.customer .................................. [RUN]
[0m03:18:06.825996 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.order, now model.shopify.customer)
[0m03:18:06.825996 [debug] [Thread-1 (]: Began compiling node model.shopify.customer
[0m03:18:06.833483 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.customer"
[0m03:18:06.841718 [debug] [Thread-1 (]: Began executing node model.shopify.customer
[0m03:18:06.851200 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:18:07.285873 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.customer"
[0m03:18:07.288399 [debug] [Thread-1 (]: On model.shopify.customer: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.customer"} */

  
    

    create or replace table `impression-digital`.`staging`.`customer`
      
    
    

    OPTIONS()
    as (
      

WITH cust_spend AS
(
  SELECT
    customer.id
    ,SUM(current_subtotal_price) AS subtotal_spent
    ,SUM(total_price) AS total_spent
  FROM `impression-digital`.`staging`.`order`
  GROUP BY customer.id
)

,stage_cust AS
(
  SELECT
    c.id
    ,email
    ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', created_at) AS created_at
    ,PARSE_TIMESTAMP('%Y-%m-%dT%H:%M:%S%Ez', updated_at) AS updated_at
    ,first_name
    ,last_name
    ,CAST(orders_count AS INT64) AS orders_count
    ,state
    -- ,s.total_spent
    ,COALESCE(s.total_spent, CAST(c.total_spent AS FLOAT64), 0) AS total_spent
    ,CAST(last_order_id AS STRING) AS last_order_id
    ,note
    ,CAST(verified_email AS BOOL) AS verified_email
    ,multipass_identifier
    ,CAST(tax_exempt AS BOOL) AS tax_exempt
    ,tags
    ,last_order_name
    ,currency
    ,phone
    ,addresses
    ,tax_exemptions
    ,email_marketing_consent
    ,sms_marketing_consent
    ,admin_graphql_api_id
    ,default_address
  FROM
    raw.customer AS c
  LEFT JOIN cust_spend AS s
  ON c.id = s.id
)

SELECT * FROM stage_cust
    );
  
[0m03:18:07.700009 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:105b4418-d1b1-43e8-ba1f-06a694af08b0&page=queryresults
[0m03:18:11.003475 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e61e7e02-816f-429f-9f44-2dada926af44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B81254ED80>]}
[0m03:18:11.008044 [info ] [Thread-1 (]: 3 of 4 OK created sql table model staging.customer ............................. [[32mCREATE TABLE (13.0 rows, 7.5 KiB processed)[0m in 4.18s]
[0m03:18:11.012654 [debug] [Thread-1 (]: Finished running node model.shopify.customer
[0m03:18:11.014146 [debug] [Thread-1 (]: Began running node model.shopify.product_sales_agg
[0m03:18:11.014146 [info ] [Thread-1 (]: 4 of 4 START sql table model processed.product_sales_agg ....................... [RUN]
[0m03:18:11.023574 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.shopify.customer, now model.shopify.product_sales_agg)
[0m03:18:11.029077 [debug] [Thread-1 (]: Began compiling node model.shopify.product_sales_agg
[0m03:18:11.041182 [debug] [Thread-1 (]: Writing injected SQL for node "model.shopify.product_sales_agg"
[0m03:18:11.047668 [debug] [Thread-1 (]: Began executing node model.shopify.product_sales_agg
[0m03:18:11.058345 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m03:18:11.347960 [debug] [Thread-1 (]: Writing runtime sql for node "model.shopify.product_sales_agg"
[0m03:18:11.357105 [debug] [Thread-1 (]: On model.shopify.product_sales_agg: /* {"app": "dbt", "dbt_version": "1.9.1", "profile_name": "shopify", "target_name": "dev", "node_id": "model.shopify.product_sales_agg"} */

  
    

    create or replace table `impression-digital`.`processed`.`product_sales_agg`
      
    
    

    OPTIONS()
    as (
      

WITH all_lines AS (

SELECT 
  od.order_number
  ,line.product_id AS line_product_id
  ,line.variant_id AS line_variant_id
  ,CAST(variant.price AS NUMERIC) AS price
  ,CAST(line.quantity AS NUMERIC) AS quantity
  ,IFNULL(CAST(discount.amount AS NUMERIC), 0) AS discount
  ,od.total_discounts
  ,od.financial_status AS payment_status
FROM
   `impression-digital`.`staging`.`order` AS od
LEFT JOIN
  UNNEST(od.line_items) AS line
LEFT JOIN
   `impression-digital`.`staging`.`product` AS pd
  ON line.product_id = pd.id
LEFT JOIN
  UNNEST(pd.variants) AS variant
  ON line.variant_id = variant.id
LEFT JOIN
  UNNEST(line.discount_allocations) AS discount
WHERE od.financial_status IN ('paid') -- only counting sales from paid orders
)

-- same product within an order can have different discounts applied. Need to group down to variant level and sum discounts
,discount_summed AS(
  SELECT
    order_number
    ,line_product_id
    ,line_variant_id
    ,quantity
    ,SUM(discount) AS discount
  FROM all_lines
  GROUP BY order_number, line_product_id, line_variant_id, quantity
)

-- add the summed discount back to respective row in all_lines via a join
,subtotals AS(
SELECT DISTINCT
  d.order_number
  ,d.line_product_id
  ,d.line_variant_id
  ,l.price
  ,d.quantity
  ,d.discount
  ,(price*d.quantity) - d.discount AS subtotal
FROM discount_summed AS d
LEFT JOIN all_lines AS l
  ON 
    l.order_number = d.order_number AND
    l.line_product_id = d.line_product_id AND 
    l.line_variant_id = d.line_variant_id
)

,agg AS (

SELECT
  line_product_id AS product_id
  ,SUM(quantity) AS product_quantity
  ,SUM(subtotal) AS product_rev
FROM subtotals
GROUP BY line_product_id
)

SELECT * FROM agg
-- ORDER BY order_number
    );
  
[0m03:18:11.644933 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=impression-digital&j=bq:EU:200eb593-8b21-445f-88bd-00a45a53820d&page=queryresults
[0m03:18:14.874952 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e61e7e02-816f-429f-9f44-2dada926af44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B81313BDD0>]}
[0m03:18:14.874952 [info ] [Thread-1 (]: 4 of 4 OK created sql table model processed.product_sales_agg .................. [[32mCREATE TABLE (19.0 rows, 4.9 KiB processed)[0m in 3.85s]
[0m03:18:14.887578 [debug] [Thread-1 (]: Finished running node model.shopify.product_sales_agg
[0m03:18:14.895040 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m03:18:14.902956 [debug] [MainThread]: Connection 'master' was properly closed.
[0m03:18:14.904813 [debug] [MainThread]: Connection 'list_impression-digital' was properly closed.
[0m03:18:14.906811 [debug] [MainThread]: Connection 'list_impression-digital_staging' was properly closed.
[0m03:18:14.907811 [debug] [MainThread]: Connection 'model.shopify.product_sales_agg' was properly closed.
[0m03:18:14.910316 [info ] [MainThread]: 
[0m03:18:14.913314 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 18.56 seconds (18.56s).
[0m03:18:14.937384 [debug] [MainThread]: Command end result
[0m03:18:15.119721 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\manifest.json
[0m03:18:15.127814 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\semantic_manifest.json
[0m03:18:15.152962 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\amarh\Dropbox\My_Stuff\Progress File (Actual)\Job Applications\2024\Data Engineer\Impression Digital\impression-digital-task\01_code\transform\shopify\target\run_results.json
[0m03:18:15.154541 [info ] [MainThread]: 
[0m03:18:15.157453 [info ] [MainThread]: [32mCompleted successfully[0m
[0m03:18:15.163509 [info ] [MainThread]: 
[0m03:18:15.167344 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m03:18:15.180775 [debug] [MainThread]: Command `dbt run` succeeded at 03:18:15.180775 after 24.28 seconds
[0m03:18:15.187907 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B807E90B60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B807AB1430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B8108E6150>]}
[0m03:18:15.190005 [debug] [MainThread]: Flushing usage events
[0m03:18:15.583630 [debug] [MainThread]: An error was encountered while trying to flush usage events
